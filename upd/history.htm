<HTML xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"
	xmlns:w="urn:schemas-microsoft-com:office:word">
	<HEAD>
		<title>040622 вт</title>
		<META http-equiv="Content-Type" content="text/html; charset=windows-1251">
	</HEAD>
	<BODY lang="RU" style="tab-interval: 35.4pt" bgColor="#ccffcc">
		÷№
		<meta content="http://schemas.microsoft.com/intellisense/ie5" name="vs_targetSchema">
		<meta content="True" name="vs_snapToGrid">
		<meta content="True" name="vs_showGrid">
		<meta content="Word.Document" name="ProgId">
		<meta content="Microsoft Word 10" name="Generator">
		<meta content="Microsoft Word 10" name="Originator">
		<LINK href="history_files/filelist.xml" rel="File-List"> <!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Anton L. Varfolomeev</o:Author>
  <o:LastAuthor>Anton L. Varfolomeev</o:LastAuthor>
  <o:Revision>3</o:Revision>
  <o:TotalTime>2</o:TotalTime>
  <o:Created>2004-06-25T09:07:00Z</o:Created>
  <o:LastSaved>2004-06-25T09:07:00Z</o:LastSaved>
  <o:Pages>2</o:Pages>
  <o:Words>352</o:Words>
  <o:Characters>2011</o:Characters>
  <o:Company>InFRAN</o:Company>
  <o:Lines>16</o:Lines>
  <o:Paragraphs>4</o:Paragraphs>
  <o:CharactersWithSpaces>2359</o:CharactersWithSpaces>
  <o:Version>10.4219</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->  <!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Print</w:View>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:FormsDesign/>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->
		<style> @page Section1 {size: 595.3pt 841.9pt; margin: 2.0cm 42.5pt 2.0cm 3.0cm; mso-header-margin: 35.4pt; mso-footer-margin: 35.4pt; mso-paper-source: 0; }
	P.MsoNormal { FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"; mso-style-parent: ""; mso-pagination: widow-orphan; mso-fareast-font-family: "Times New Roman" }
	LI.MsoNormal { FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"; mso-style-parent: ""; mso-pagination: widow-orphan; mso-fareast-font-family: "Times New Roman" }
	DIV.MsoNormal { FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"; mso-style-parent: ""; mso-pagination: widow-orphan; mso-fareast-font-family: "Times New Roman" }
	SPAN.SpellE { mso-style-name: ""; mso-spl-e: yes }
	SPAN.GramE { mso-style-name: ""; mso-gram-e: yes }
	DIV.Section1 { page: Section1 }
		</style>
		<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->  <!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1026"/>
</xml><![endif]-->  <!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
		<p class="MsoNormal"><b style="mso-bidi-font-weight: normal">040622 <span class="SpellE">вт</span><o:p></o:p></b></p>
		<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
		<p class="MsoNormal" align="left">- перенесены <span class="SpellE">хардовые</span> 
			фрагменты из Act2<o:p></o:p></p>
		<p class="MsoNormal">- изменен <span class="SpellE">тулбар</span><o:p></o:p></p>
		<p class="MsoNormal">- разрешение кнопок "новое окно" и "<span class="SpellE">Go</span>"</p>
		<p class="MsoNormal">- пересылка <span class="SpellE">рисовательных</span> команд<o:p></o:p></p>
		<p class="MsoNormal">- динамическое отображение изменени€ скоростных режимов<o:p></o:p></p>
		<p class="MsoNormal">- перва€ попытка рисовани€<o:p></o:p></p>
		<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
		<p class="MsoNormal"><span style="COLOR: #993300"><FONT color="#000099">TODO!<o:p></o:p></FONT></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"><FONT color="#000099">- правильный 
					перенос включенных каналов при изменении их количества<o:p></o:p></FONT></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"><FONT color="#000099">- разобратьс€ с <span class="SpellE">
						непересылкой</span> <span class="SpellE">рисовательных</span> сообщений <span class="GramE">
						множественным</span> <span class="SpellE">осциллам</span><o:p></o:p></FONT></span></p>
		<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
		<p class="MsoNormal">-------------------------------------------------------<o:p></o:p></p>
		<p class="MsoNormal"><b style="mso-bidi-font-weight: normal">040623 <span class="GramE">ср</span><o:p></o:p></b></p>
		<p class="MsoNormal">- первое решение проблемы с рассылкой сообщений: € пыталс€
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>обрабатывать их 
			в <span class="SpellE">PreTranslateMessage</span> - и происходило
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>следующее: 
			сообщение попадало в основной цикл, откуда - <span class="GramE">в</span>
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span><span class="SpellE">
				PreTranslateMessage</span> главного окна - а в нем вызывалась соотв.
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>функци€ лишь дл€ 
			"активного" вида. „тобы попасть в "нужное
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>окно", 
			необходимо дойти до <span class="SpellE">DispatchMessage</span> - то есть 
			избежать
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>"предобработки", 
			а затем обрабатывать сообщение в общей карте.<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>Ќо! Ётот метод 
			работает в однопоточной модели. ѕри переходе <span class="GramE">к</span>
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span><span class="SpellE">
				многопоточности</span> (что желательно) может <span class="SpellE">поднадобитьс€</span>
			и возврат
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>к <span class="SpellE">
				PreTranslate</span>...<o:p></o:p></p>
		<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>ј вообще день омрачен двум€ событи€ми: разговором с яј, <span class="GramE">в</span>
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>котором он сообщил о своем решении оставить мен€ <span class="GramE">на</span>
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>финансово-руковод€щем посту, а также <span class="GramE">безумно-бесполезным</span>
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>визитом в Ёльдорадо (попытка забрать оплаченные телефоны):
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>больше часа ожидани€ без какого-либо толку....<o:p></o:p></span></p>
		<p class="MsoNormal">----------------------------------------------------------<o:p></o:p></p>
		<p class="MsoNormal"><b style="mso-bidi-font-weight: normal">040624 <span class="SpellE">чт</span><o:p></o:p></b></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>ѕродолжение разговора с яј: сообщил ему о своем решении -
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>"зашарить" финансы с Ўестопаловой. ≈ще одна поездка <span class="GramE">в</span>
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>"Ёльдорадо" - телефоны получил.<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>
			<o:p></o:p></p>
		<p class="MsoNormal">- ѕопыталс€ покрасить <span class="SpellE">триггерные</span> полоски 
			в разные цвета -
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>получаетс€ <span class="GramE">
				р€бое</span> и некрасивое...<o:p></o:p></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp; </span>
			<o:p></o:p></p>
		<p class="MsoNormal">-------------------------------------------------------------<o:p></o:p></p>
		<p class="MsoNormal"><b style="mso-bidi-font-weight: normal">040625 <span class="SpellE">пт</span><o:p></o:p></b></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>ѕришла перва€ из ожидаемых трех <span class="SpellE">јмазоновских</span> 
				посылок -
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span><span class="SpellE">Bootstrap</span> <span class="SpellE">Methods</span>... 
				»нтересно, когда по€в€тс€ остальные
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>две - вроде как они более актуальны. <span class="GramE">’от€ и эта (даже 
					при </span>
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>беглом взгл€де в автобусе) - весьма <span class="GramE">полезна€</span>.<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: green"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;
				</span>«ашел в  абинет - выписал сейф, кресло KSI и пару вешалок<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>
			<o:p></o:p></p>
		<p class="MsoNormal"><span style="COLOR: #993300">TODO:<o:p></o:p></span></p>
		<p class="MsoNormal"><span class="GramE"><span style="COLOR: #993300"># не мешать <span class="SpellE">
						TouchProof</span> каналы с обычными (неправильное поведение при</span> </span>
			<span style="COLOR: #993300">
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"><span style="mso-spacerun: yes">&nbsp;</span><span class="GramE">изменении</span>
				количества каналов)<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"># плохо ведет себ€ при "ручных" 
				изменени€х - почему-то
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"><span style="mso-spacerun: yes">&nbsp;</span>сбрасывает 
				режим на "ноль"<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"># начать фрагмент сохранени€ 
				параметров-переменных<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"># хорошо бы добратьс€ до насто€щего 
				рисовани€... “огда €снее
				<o:p></o:p></span></p>
		<p class="MsoNormal"><span style="COLOR: #993300"><span style="mso-spacerun: yes">&nbsp;</span>будет...</span></p>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p></o:p></SPAN>&nbsp;</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">—делано:</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">- 13:55, с 
						режимами было запутано: в одном месте хранил как long (полную информацию), в 
						других - пыталс€ использовать как short (номер режима). „астично распутал.... </FONT>
				</o:p></SPAN></P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">- 17:20 - очень 
						долго провозилс€ с изначально неверной адресацией карты (там столько раз 
						перерасчитываютс€ размеры и количество р€дов...) ¬ итоге удалил пересчет из 
						OnSize, оставив только в Resize - в таком режиме вроде работает... </FONT>
				</o:p></SPAN></P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#ff0000">очередна€ 
						проблема: при создании нового файла в "дочернюю карту" передаетс€ нечто 
						запредельное.</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">Ёто очередное 
						"рассогласование": передаетс€ "максимально возможное" количество каналов (а не 
						заданное)</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">- 19:02 - однако, 
						"заданные" - это то, что реально присутствует. ј дл€ работы с даннными нужно 
						учитывать то количество каналов, которое соответствует данному режиму (именно 
						столько и передаетс€). «аведена нова€ переменна€ <FONT color="#003399">CMainFrame::m_nActChans</FONT>;</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000"></FONT></o:p></SPAN>&nbsp;</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">- 20:34 ƒл€ 
						отображени€ изменени€ длительности (как и дл€ всего другого) необходимой 
						оказалась "пр€ма€ св€зь" между диаловой закладкой и собственно осциллом. “огда 
						попробовал изменить и активацию (без выхода в главное окно), перепробовал 
						разные варианты (мигающее окно и проч.) - но остановилс€ на самом простом: 
						только дл€ правильного отображени€ активного не-дочернего окна и в нем тоже 
						titlebar нужно рисовать вручную.</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">&nbsp; Ќе 
						забывать, что соответствие между комбо-боксом длительности и самой 
						длительностью - списковое!!! “о есть нужен будет способ, которым можно из 
						длительности получать позицию списка... </FONT><FONT color="#009966">»ли 
						все-таки хранить именно позицию - и пересчетный массив???</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000">&nbsp;&nbsp; </FONT>
					<FONT color="#ff0000">ћысль!!! Ќадпись <U><STRONG>Trigger</STRONG></U> должна быть 
						кнопкой, и по этой кнопке выводить соотв. диалог.</FONT></o:p>
			</SPAN>
		</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#ff0000"></FONT></o:p></SPAN>&nbsp;</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000"></FONT></o:p></SPAN>&nbsp;-------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040628 пн</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">- —ообразив, что в диалогах мне понадобитс€ и парочка 
			фильтров, еще раз "подвинул" карты - и обнаржил, что отрисовка стала совсем 
			неправильной (карта не сразу измен€етс€ при изменении размера - пропадают 
			клетки). “ак что пришлось отменить с таким трудом найденный "выход" (отмену 
			изменени€ по OnSize() ). —оответственно, вернулась и стара€ проблема 
			(неправильное изначальное "масшабирование") - но на этот раз решил ее двойным 
			вызовом CStatMap::Resize из CLeftDlg::SetNofChans.</P>
		<P class="MsoNormal">- ѕлюс к тому, неправильно отрисовывалась свежезаведенна€ 
			рамочка дл€ фильтров - ей нужен стиль Transparent!!!</P>
		<P class="MsoNormal">- Ќу и пришлось изменить стартовый и минимальный размер 
			"диалогбара".</P>
		<P class="MsoNormal"><FONT color="#000099">todo!!!!</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">Ќе исправлено удаление дочерних окон (что-то 
				неправильно удал€етс€ из списка - остаютс€ ссылки на отсутствующие окна) !!!!</FONT></P>
		<P class="MsoNormal"><FONT color="#ff3300"></FONT>&nbsp;</P>
		<P class="MsoNormal"><SPAN style="COLOR: #993300"><o:p><FONT color="#000000"></FONT></o:p></SPAN>&nbsp;---------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040630 ср</STRONG></P>
		<P class="MsoNormal">- в принципе приготовилс€ перейти к рисованию, но сообразил, 
			что до того нужно проверить, что у мен€ с переменными и с пам€тью:</P>
		<P class="MsoNormal">- в CActDView нужны отдельные буфера дл€</P>
		<P class="MsoNormal">&nbsp; - триггерного канала (WORD* m_pTrigBuf)</P>
		<P class="MsoNormal">&nbsp; - референса (long* m_pRefBuf)</P>
		<P class="MsoNormal">&nbsp; - дл€ отдельных каналов (размер увеличиваетс€ на 
			количество отображаемых каналов)</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			(long* m_pChanBuf)</P>
		<P class="MsoNormal">ј вот с пам€тью оказалось не так просто: сначала довольно 
			долго соображал, каким же именно образом мне ее провер€ть (нужны не только 
			соответствующие "разрешени€", но и в определенном пор€дке - и
		</P>
		<P class="MsoNormal">_CrtSetDbgFlag ( _CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF 
			); дл€ того, чтобы пам€ть провер€лась при выходе, но и "локальные проверки" при 
			создании-удалении дочерних окон). Ќу а потом, естественно, оказалось что пам€ть 
			€ тер€ю в катастрофических количествах. ѕо очень простой причине: при открытии 
			нового окна соответствующие объекты создаютс€ (командой new) - а кто их удал€ть 
			будет? ѕервые попытки отследить логику удалени€ тоже успеха не принесли...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040701 чт</STRONG></P>
		<P class="MsoNormal">- —лава богу, с пам€тью разобралс€. ¬се удалени€ производ€тс€ 
			в соотв. функци€х CMainFrame (</P>
		<P class="MsoNormal">CMainFrame::OnViewClose и CMainFrame::OnDlgClose), и 
			заключаютс€ в выполнении команд</P>
		<P class="MsoNormal">delete m_arpView[idx]; delete m_arpDialog[idx]; - никакие 
			DestroyWindow и принудительные вызовы деструкторов при этом не нужны!!! ƒа, 
			было бы правильнее заводить вектора из мудрых указателей - но не до того, с 
			ними тоже будут проблемы (создание элемента вектора и проч.). ѕоэтому при 
			закрытии главного окна приходитс€ "вручную" сначала удал€ть все созданные 
			объекты-окна - а уже потом "чистить" сами вектора. ¬ итоге от утечек избавилс€</P>
		<P class="MsoNormal">- Ќемножко изменил рисование: после вс€ких там изменений 
			заливаю исходный битмэп серым...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">1825: —обственно, уже час (больше, если считать по 
			астрономическому времени и меньше, если выкинуть из него почти непрерывные 
			беседы с Ѕехтеревым о Ѕрюл€х и эпизодические воспоминани€ об ANOVA) размышл€ю 
			на тему организации CActDView::OnPlot. ќсновной вопрос таков: на входе € 
			получаю "массив каналов", включающий ¬—≈ ѕќ“≈Ќ÷»јЋ№Ќќ ¬ќ«ћќ∆Ќџ≈ (первым идет 
			статусный канал). ј вот разбиратьс€ с ними (из чего считать референт, какие 
			отбирать дл€ отображени€) € должен исход€ из "карт", имеющих иную структуру - 
			если бы € еще помнил, какую... Ѕуду пытатьс€ вспоминать....&nbsp;</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">----------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040703 сб</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕервое задание: карта точно должна отображать количество 
			установленных модулей (то есть работать и при нечетном количестве тоже) - и 
			строго возвращать нули дл€ отсутствующих, а также и выход€щих за рамки режима 
			модулей.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">–ешение проблемы:</P>
		<P class="MsoNormal">1.&nbsp;ѕри изменении числа модулей в главное окно 
			отправл€етс€ WM_DIZ_CHANGEMODE, где оно обрабатываетс€ в PreTranslateMessage - 
			и оттуда вызываютс€ методы SetNofChans(m_nChans,m_nTouch) дл€ картосодержащих 
			диалогов ("левого" и "баров")</P>
		<P class="MsoNormal">2. ќттуда вызвались m_Map.Resize(-1,N,nTouch); , где N = 
			nChans/32; ƒл€ более правильной обработки нужно вызывать не с N (числом строк), 
			а с реальным числом каналов.</P>
		<P class="MsoNormal">-1407: почти перешел на реальные каналы - но в "левом" диалоге 
			не работает отображение отсутствующих, а в "барах" отображение работает - но не 
			отключаетс€ функци€ включени€/выключени€.</P>
		<P class="MsoNormal">- 1412: с отображалкой разобралс€ (использовал неверное 
			логическое сочетание наличи€ родительской карты и количества каналов) - а вот 
			теперь хочу, чтобы не работали включение/выключение и тултип.</P>
		<P class="MsoNormal">- 1420: запрет на отрисовку и отлов сообщений дл€ 
			отсутствующих модулей сделан (в CStatMap::OnMouseMove)</P>
		<P class="MsoNormal">“еперь нужно, чтобы все это правильно передавалось в "рабочие 
			части" программы...</P>
		<P class="MsoNormal">.....</P>
		<P class="MsoNormal">- 1809 - ƒума€ (как бы) о дальнейших шагах в программе, сам 
			зан€лс€ апдейтом XP на ноутбуке (что-то он глючит - то ли сам сайт, то ли 
			пиратские номера чувствует). ѕроапдейтил, поставил ќфис, сейчас ставлю MSVC - а 
			мысли все же блуждают. ј именно: пользовать дл€ референтов и списка каналов 
			насто€щие динамические вектора (CSimpleArray&lt;int&gt;). ј где их нужно 
			создавать-мен€ть? ¬идимо, там, где мен€ютс€ карты. ј где они мен€ютс€? ѕохоже, 
			что все это происходит в CDlgView::RedrawMap (по крайней мере, туда направл€юсь 
			из главного окна после изменений в "родительской" карте.) “очно: туда же 
			попадаю и при перерисовке "своих" карт.</P>
		<P class="MsoNormal">- 1843 ¬ектора заведены в диалоге, добавлены функции доступа и 
			подсчета.</P>
		<P class="MsoNormal">-&nbsp;¬ очередной раз убеждаюсь в необходимости "двойной 
			св€зки" (диалог-вид). «авел в виде указатель на диалог, устанавливамый в той 
			самой функции (диалога), котора€ заполн€ем в нем m_pView;</P>
		<P class="MsoNormal">1850. ATAC! я где-то утер€л способность измен€ть размер карт 
			(как левой, так и остальных) при изменении числа установленных модулей....</P>
		<P class="MsoNormal">- 1908 - решил: не хватало скобочек вокруг "добавлени€ лишнего 
			модул€" в выражении</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">...замораживаю ноутбук, пакую сегодн€шние изменени€ и статьи - 
			пойду домой...</P>
		<P class="MsoNormal">--------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040705 пн</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ќчередные "проблемы" с бухгалтерией, выход на работу 
			Ўестопаловой - то есть оп€ть день заполнен непон€тно чем. Ћишь под вечер - 
			немного "программировани€" - все еще на подступах к рисованию. ƒл€ упрощени€ (и 
			ускорени€) доступа беру из векторов референсных и отображаемых каналов не <FONT color="#0000cc">
				CSimpleArray&lt;int&gt;*,</FONT> а собственно <FONT color="#0000cc">int*</FONT>
			(получаемый по <STRONG><FONT color="#3300cc">GetData())</FONT></STRONG></P>
		<P class="MsoNormal">------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040706 вт</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">Ќесмотр€ на продолжение диалогов с ремонтниками и проч., 
			программой удалось позаниматьс€ поплотнее - даже с замачиванием электродов.</P>
		<P class="MsoNormal">Ќелады оказались уже с этим - пока беседовал с ¬итой, система 
			перешла в состо€ние CMS out of range, и продолжала возвращатьс€ в оное при 
			попытке подключить одновременно 16 A-каналов, Ext после промывки заработали.</P>
		<P class="MsoNormal">¬ы€влены основные проблемы:</P>
		<P class="MsoNormal">- € неправильно определ€ю число каналов: при разрешении Ext 
			(Mode &gt;= 4) под них отводитс€ 32(!!!!) последних канала, в итоге уменьшаетс€ 
			число доступных пиновых - и соответствующим образом измен€етс€ и положение 
			Ext-каналов в реально получаемом массиве данных, то есть они начинаютс€ :</P>
		<P class="MsoNormal">режим&nbsp;&nbsp; начало Ext</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp; 
			4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 232</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp; 
			5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 104</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp; 
			6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			40</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp; 
			7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			8</P>
		<P class="MsoNormal">(числа - при подсчете с нул€:; реально им предшествует еще два 
			"канала" - синхро и режим)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">- ќчень долго мудрил с пор€дком каналов: ѕ≈–≈ƒјё“—я они в 
			исходном интерливинге</P>
		<P class="MsoNormal">- ѕо€вл€етс€ очень сильный вопрос: а нужна ли мне "двойна€ 
			буферизаци€": сейчас в таймерной функции € складываю все полученные данные в 
			"промежуточный буфер" (один и тот же - то есть без двойной буферизации) - а 
			потом в функци€х "видов" раскидываю его на каналы. ј что мне это дает, кроме 
			лишних операций пересылки?</P>
		<P class="MsoNormal">ћожно было бы еще пон€ть, если бы € пользовал действительно 
			двойную буферизацию - но даже в этом случае непон€тно преимущество оной перед 
			большим входным циклическим буфером. ≈динственное, что делаетс€ в этой 
			процедуре - так это "раскрутка цикличности" (независимо от перехода через 
			границу, получаю линейный буфер, и делаю это один раз дл€ "всех видов"). Ќо 
			разве так уж велики расходы на эту "раскрутку"? ¬едь можно: а) - провер€ть, 
			будет ли переход через границу в начале обработки, а потом идти по разным 
			веткам или б) ¬—≈√ƒј брать индекс по маске. похоже, что € буду пробовать второй 
			вариант...</P>
		<P class="MsoNormal">ѕри этом хочетс€ заложить "вторичное хранение" каналов в 
			неинтерливном виде - дл€ возможности иметь разные частоты дискретизации дл€ 
			разных каналов....</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><FONT color="#cc0033">»так TODO:</FONT></P>
		<P class="MsoNormal"><FONT color="#cc0033">- ѕравильна€ нумераци€ Ext-каналов при 
				изменении режимов</FONT></P>
		<P class="MsoNormal"><FONT color="#cc0033">- ѕопробовать обойтись без промежуточного 
				буфера, передава€ адрес исходного</FONT></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040707 ср</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ќбычное начало дн€: диалоги с ремонтниками (с ƒимой), ЌЌЅ и 
			проча€. ¬вел вчерашние "дневниковые" записи. 13:12 - после перекура буду в 
			очредной раз пробовать достать и подключить железо....</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">14:17 - первые же размышлени€ показали, что "так просто" не 
			получитс€: "дочерние окна" должны получать не пару (начало буфера - 
			количество), а три параметра: буфер, положение начала "текущего поступлени€" и 
			размер оного. ѕередава€ просто начало глобального буфера, € не буду знать, 
			откуда начинать отсчет; а при передаче "точки поступлени€" не смогу вычислить 
			момента разворота.  омпромиссное решение: главный буфер делать "максимально 
			глобальным" (либо вообще глобальным, либо в CMainFrame - но с функцией 
			получени€ адреса), а передавать - позицию начала свежих данных в буфере.</P>
		<P class="MsoNormal">&nbsp;&nbsp; Ёто выгл€дит вполне осуществимым: буфер 
			(CMainFrame::m_pBuf) создаетс€ в CMainFrame::OnCreate(), имеет фиксированный 
			размер и не измен€етс€. —оответственно, все дочерние окна (и будущий класс 
			"сохран€емого файла") могут при создании получать его адрес - и хранить у себ€ 
			(в локальной переменной, чтобы избежать лишней операции в часто повтор€щихс€ 
			вызовах).</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">  дес€ти вечера задача вроде бы реализована - но электроды 
			по-прежнему "барахл€т".</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕоздним вечером, уже дома - ввел в диалог edit-box 'Scale' - 
			но без какого-либо обслуживани€.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">---------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040710 сб</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕредыдущие два дн€ - полностью "вне программы": вынос мебели 
			из к. 102, получение товаров по счетам (в  ее - записна€ книжка и фотобумага, 
			из  абинета привезли сейф, кресло и вешалки), размышлени€ над курикулумами дл€ 
			CRDF. ¬ п€тницу - подписание счетов и прочие беседы с яј, раскидка смет по ќЅЌ 
			и проча€... Ћучшее из этого - вечер в ћариинском: —амсон и ƒалила.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><EM><U><FONT color="#009900">«ј–яƒ ј Ѕј“ј–≈» Act-2. ѕерешел на вторую 
						батарею</FONT></U></EM>.</P>
		<P class="MsoNormal"><EM>начало зар€дки - около 16:00</EM></P>
		<P class="MsoNormal"><EM>ѕерешла от full charge to the trickle charge at 18:12.</EM></P>
		<P class="MsoNormal"><EM>19:23 - зар€дка закончена.</EM></P>
		<P class="MsoNormal"><EM></EM>&nbsp;</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">“ак что к программе вернулс€ только сегодн€.
		</P>
		<P class="MsoNormal">- ќбслуживание "ћасштаба" (обработка Enter и UpDownCtrl). ”чет 
			полученного масшатаба при рисовании. ѕроба: два экрана по 40 каналов проход€т - 
			если только разрешение по времени не слишком велико (более 4 секунд - 
			нормально, меньше - тормозит довольно сильно). Ergo, разделение на потоки 
			понадобитс€...</P>
		<P class="MsoNormal">- изменен таймер: 250 мс в "стоп-режиме" (дл€ опроса текущего 
			режима и проч) - и 50 мс (20 герц) при запущенном вводе - дл€ более плавного 
			обновлени€...</P>
		<P class="MsoNormal">- отработка включени€-выключени€ триггера.</P>
		<P class="MsoNormal">- 18:30 - введена обработка бипол€рного чекбокса (с 
			запрещением, если каналы не заданы). !!!»м€ не запоминаетс€ и не передаетс€!!!</P>
		<P class="MsoNormal">- 19:18 - пробую отображать бипол€рные каналы. „то-то 
			отображаетс€... Ќо похоже, что оп€ть - что-то не то...</P>
		<P class="MsoNormal"> роме того, €<FONT color="#cc0000"></FONT><FONT color="#000099">во 
				всех дочерних окнах выдел€ю пам€ть под ¬—≈ ¬ќ«ћќ∆Ќџ≈  јЌјЋџ - а это не то, что 
				следовало бы делать. ѕравильнее - рассмотреть возможность передачи сообщений об 
				изменении отображаемых каналов и перераспредел€ть пам€ть</FONT>.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><FONT color="#660000">“акже не забыть, что € удумал (мес€ца 
				три-четыре назад) по поводу <STRONG><U>смещени€</U></STRONG>: отображать 
				цветами во ¬—≈’ окошках включени€ каналов (то есть - на картах). Ётих цветов 
				может быть три - а может и больше? Ќапример, заливать все зеленым, а по мере 
				увеличени€ смещени€ уменьшать количество зеленого и увеличивать - красного....</FONT></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"> ак ни обидно, но на сегодн€ надо завершать - проверить 
			наличие на всех возможных винтах нужных данных и прочего... и грести к дому...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">----------------------------------------------------</P>
		<P class="MsoNormal">040717 сб</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">Ќу вот, вс€ недел€ прошла в разнообразных хлопотах и заботах, 
			если и были среди них "более рабочие", то касались они матлаба, SPSS и прочих 
			более близких к "науке" вещей. ќб&nbsp; ActD вспоминал - но ничего не делал. 
			ћожет быть, оно и правильно: не стоит такие вещи делать второп€х. “ак что 
			сейчас начинать придетс€ с перечитывани€ этих записей - и определени€ того, что 
			же нужно сделать...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">»так, самые очевидные TODO:</P>
		<P class="MsoNormal"><FONT color="#006600">- "правильное" позиционирование Ext-каналов 
				(они не должны мешатьс€ с "обычными", но в то же врем€ количество доступных 
				"Ќормальных" должно уменьшатьс€)</FONT></P>
		<P class="MsoNormal"><FONT color="#009900">- обработка изменени€ включенных каналов в 
				BiPolar (выключать набор если хот€ бы один из каналов отсутствует)</FONT></P>
		<P class="MsoNormal"><FONT color="#0000ff">- —мещение (отображение смещени€ цветом)</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">- фильтраци€ (HP, LP - IIR) дл€ отображени€</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">- фильтраци€ (LP, FIR) с децимацией 
				непосредственно при вводе (задавать "итоговую" частоту с тем, чтобы при 
				изменении режима одна не измен€лась, мен€лс€ только коэффициент децимации; дл€ 
				этого:</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp; -- возможные значени€ 
				"итоговой" частоты не должны превышать 2048 √ц</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp; -- меньшие значени€ - тоже по 
				степен€м 2, то есть получаем возможные значени€:</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
				2048</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
				1024</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
				512</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;256</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
				128</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;64</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - такой 
				набор вполне можно загнать и в комбобокс листбокс-типа)</FONT></P>
		<P class="MsoNormal"><FONT color="#cc0000"></FONT>&nbsp;</P>
		<P class="MsoNormal"><FONT color="#000000">- 1343: дл€ обеспечени€ различени€ пин- и 
				тачпруф-каналов пришлось различать их и в структуре actMode</FONT></P>
		<P class="MsoNormal">- 1522: очень долго провозилс€ с нормальной обработкой разного 
			рода отключени€ каналов в CDlgView. “ам же сделана правильна€ (завис€ща€ от 
			установленного режима) поправка начала TouchProof.</P>
		<P class="MsoNormal">- 1616 - обнул€ю значение бипол€рного канала если хот€ бы один 
			из двух отсутствует.</P>
		<P class="MsoNormal">- 1723: в книжке (Numerical recipes) ничего хорошего про IIR 
			фильтры не написано. ƒескать, думай сам... Ѕросать все и заниматьс€ дизайном 
			фильтров... Ёто уж как-то... FIR € умею (должно быть в dUEn) - но дл€ HP такой 
			не подойдет. ƒа и дл€ LP нужен изр€дного пор€дка (по-моему, € пользовал около 
			50). Ergo, остаетс€ либо "домашн€€" книжка того же содержани€ - либо 
			пользоватьс€ библиотекой. Ќо в таком случае программа сразу станет не слишком 
			лицензионной - и не слишком транспортабельной.</P>
		<P class="MsoNormal">- 1938: «аработал первый вариант отображени€ смещени€ - 
			отображаю во всех окнах (хот€ можно только в активном). «аодно "решил" и 
			проблему с электрдами - € их просто не туда втыкал!!!
		</P>
		<P class="MsoNormal">¬ общем, хоть что-то - но сделано...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">---------------------------------------------------------------------------</P>
		<P class="MsoNormal">040722, четверг</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬ечером разбиралс€ с IIR-фильтрами. ¬ ActiView используютс€ 
			Ѕессел€ - 2 пор€дка дл€ LP и 1 пор€дка дл€ HP. ѕопробовал посчитать аналоги в 
			ћатлабе - но полностью неудачно... Ќемало времени ушло на то, чтобы пон€ть:</P>
		<P class="MsoNormal">√енерируемый ћатлабом фильтр Ѕессел€ принадлежит к аналоговым 
			- то есть получаютс€ какие-то совсем другие коэффициенты, и принадлежат они 
			S-плоскости (а не Z-плосокости, как у цифровых). ƒл€ преобразовани€ аналоговых 
			фильров к цифровым требуетс€ "билинейное преобразование", в котором третий 
			параметр - частота дискретизации делена€ на 2*PI. ѕравда, результат все равно 
			оказываетс€ не совсем точным.
		</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">-------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040723 п€тница</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">»так, в LavView:</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">//пор€док, частота среза, частота дискретизиции</P>
		<P class="MsoNormal">HP(1,0.16,2048) :&nbsp;a = [-0.9995092466 0]&nbsp;b = 
			[0.9997546233 -0.9997546233]</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬ ћатлабе:</P>
		<P class="MsoNormal">[bBh aBh] = besself(1,0.16,'high') b = [1 0] a = [1 0.16]</P>
		<P class="MsoNormal">[bN aN] = bilinear(bBh,aBh,2048/pi/2): b =&nbsp; 
			[0.99975462329844 -0.99975462329844]&nbsp; a = [1 -0.99950924659688]</P>
		<P class="MsoNormal">ћатлабовское a(1)&nbsp; потом нигде не используетс€ - это 
			"делитель". “огда получаетс€, что у мен€ все даже вполне сходитс€ - до всех 
			значащих цифр...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ƒалее матлаб использует полученные коэффициенты следующим 
			образом:</P>
		<P class="MsoNormal">a(1)*y(n) = b(1)*x(n) + b(2)*x(n-1) + ... + b(nb+1)*x(n-nb)
		</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			- a(2)*y(n-1) - ... - a(na+1)*y(n-na)</P>
		<P class="MsoNormal">“еперь надо придумать, как мне грамотно (быстро и без больших 
			затрат пам€ти) организовать это на —и...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">»з сделанного за сегодн€:</P>
		<P class="MsoNormal">- введен переключатель скроллировани€</P>
		<P class="MsoNormal">- введена кнопка обнулени€ (сейчас беретс€ одна точка - а 
			нужно насчитвывать среднее пока держу кнопку; точно так же и при первом запуске 
			ноль должен расчитыватьс€ по среднему первого полученного фрейма)</P>
		<P class="MsoNormal">Ќули считаютс€. ѕора вводить фильтры (<FONT color="#ff0099">решено 
				дл€ начала остановитьс€ на фиксированных частотах</FONT>, то есть расчитать 
			необходимые коэффициенты в матлабе, чтобы не привлекать посторонние библиотеки)</P>
		<P class="MsoNormal">------------------------------------------------------------------</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><STRONG>040726 пн</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ƒо программы добралс€ все равно лишь под вечер (утром купил 
			обратный билет из „упы на 7 сент€бр€ - купейный, да еще в "коммерческой кассе", 
			посему обошелс€ в 1044 рубл€; р€дом же купил последнюю индийскую ручку - и 
			ампул с чернилами к ней)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">- "¬иды" порождаютс€ из "ƒиалогов" (по "New" создаетс€ диалог, 
			а уже из него - вид)</P>
		<P class="MsoNormal">- ѕервый элементарный вариант многопоточности (каждый осцилл - 
			в своем потоке!!!)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">-------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040727 вт</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">–азумеетс€, пока это - "псевдомногопоточность", и проблем 
			больше, чем выгод.
		</P>
		<P class="MsoNormal">1) Ќе удал€лс€ созданный поток - нужно €вно прописать удаление 
			в деструкторе (рассмотреть вариант: хранить не указатель на поток, а саму 
			структуру потока, тогда и удал€тьс€ будет "автоматом"). ƒеструктор не 
			срабатывал, т.к. не происходил выход из цикла Run(), а выход не происходил, 
			т.к. € "висел" на GetMessage(). Ётого можно избежать, если сделать 
			PeekMessage() - но тогда и кручение в цикле получаетс€ посто€нным....</P>
		<P class="MsoNormal">2) ѕерестало срабатывать дефолтовое позиционирование окна при 
			вынесении вовне...</P>
		<P class="MsoNormal">3) ≈сли что-либо сделать с окном, когда оно €вл€етс€ дочерним 
			и к тому же находитс€ в "–абочем" режиме, блокируютс€ сообщени€ родительского 
			пользовательского интерфейса....</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------</P>
		<P class="MsoNormal">040728 ср</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕродолжал попытки разобратьс€ с многопоточностью - перебирал 
			варианты, расставл€л брыкпойнты... Ѕезуспешно :(</P>
		<P class="MsoNormal">¬ечером - последний в сезоне поход в ћариинский - 
			"Ѕал-ћаскарад" ¬ерди в постановке  ончаловского.</P>
		<P class="MsoNormal">(с мамой)</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040730 пт.</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ƒалее было два дн€ перерыва: в четрвег объ€вилс€ яј - и 
			получалось решение финансовых и прочих оргпроблем с плавным переходом в 
			вечерний заключительный разговор с —ашей Ќурским (постановка задачи на 
			симул€цию ERP).</P>
		<P class="MsoNormal">¬ п€тницу хоронили д€дю “олю.
		</P>
		<P class="MsoNormal">¬ечером (в п€тницу же) добралс€ до программы - но при наличии 
			сильной головной боли. ¬нес изменени€: перенес Thread.h (от Biran Viksoe) в 
			программу (дл€ возможности модифицировани€). ¬сЄ одно - не то...</P>
		<P class="MsoNormal">ѕоложительный результат дала "правильна€" расстановка закрыти€ 
			окон: если всегда начинать с закрыти€ "¬ида", то оно происходит, и дальнейшее 
			удаление потока из диалога. Ќо остановки на выходе поточной функции при этом не 
			вижу!!! “о есть непон€тно, каким же образом выхожу...</P>
		<P class="MsoNormal"> роме того, <FONT color="#cc0000">обнаржил различи€ в "домашней" и 
				"рабочей" верси€х StatMap - нужно разобратьс€ пока не поздно...</FONT></P>
		<P class="MsoNormal">---------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040731 суббота</STRONG></P>
		<P class="MsoNormal"><STRONG></STRONG>&nbsp;</P>
		<P class="MsoNormal">»тогом вчерашних размышлений стало то, что мне нужно заводить 
			некий единый объект, внутри которого будут уже и диалог, и вид, и поток... », 
			соответственно, в главном окне держать список таких объектов.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">Ќо пока до этого не дошел, не додумал.
		</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬ ходе сегодн€шних разборок:</P>
		<P class="MsoNormal">- одна из причин "вылетов" - в удалении "вида" вызовом из 
			главного окна (деструктор вызывалс€ в контексте основного потока). ”брал, 
			удал€ет диалог при своем удалении.</P>
		<P class="MsoNormal">- нужно запоминать идентификатор потока, тогда можно будет ему 
			послать при закрытии сообщение WM_QUIT</P>
		<P class="MsoNormal">- ошибки с активацией окна-диалога: сейчас диалог активирует 
			вид без обращени€ к главному окну и его списку. "ќбратна€" процедура тоже 
			переписана</P>
		<P class="MsoNormal">- ќшибки при смене длительности/частоты: вызваны "асинхронным" 
			изменением (диалог напр€мую вызывает ф-ию изменени€ длительности, в ходе 
			которой удал€ютс€ нужные массивы и переопредел€ютс€ новые, а обращение к Plot 
			происходит в другом потоке). Ќужно избавитьс€ от непосредственной модификации 
			диалогом (работающим в основном потоке) переменных и массивов дочернего потока.</P>
		<P class="MsoNormal"><STRONG></STRONG>&nbsp;</P>
		<P class="MsoNormal"><STRONG>1957 - </STRONG>после вывода установки длительности в 
			сообщение (через пост) глюки с вылетом при смене прекратились. «атраты 
			процессорного времени при выводе в 4 окна по 40 каналов составл€ют 22-27%. 
			’орошо :)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">======================================================================</P>
		<P class="MsoNormal"><STRONG>040929 среда</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><EM>позади - очень длинный перерыв: подготовка статьи и доклада (в 
				основном - на ќстрове, остатки доклада делал в ѕитере), беломорский отпуск, XIX 
				съезд физиологов в ≈катеринбурге... ¬торой день потихоньку-понемножку 
				вспоминаю, что же € делал и на чем остановилс€.</EM></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕолучаетс€, что остановилс€ € на фильтрах - прин€л решение о 
			"фиксированных частотах" и их коэффициентах, но к реализации оного решени€ не 
			подобралс€ ни с какой стороны (из трех: интерфейс, матлабовские расчеты, сишные 
			алгоритмы). ѕопробуем восстановитьс€...</P>
		<P class="MsoNormal">LF - 10, 20, 30, 40, 50, 100, 200, 500, 1000, 10000 (в 
			усилителе - 30, 100, 1к, 10к)</P>
		<P class="MsoNormal">HF - 0.1, 1, 5, 10, 100 (в усилителе - 0.1, 1, 10, 100)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><FONT color="#9966cc">...¬ принципе даже вз€лс€ за это дело 
				(едит-боксы на комбобоксы заменил) - но заметил, что у мен€ ерунда творитс€ и с 
				масштабом (тот, который Scale): по€вл€етс€ куча никому не нужных значащих цифр. 
				ѕопыталс€ исправить - и завис на этом деле....</FONT></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">-------------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>040930 четверг</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><EM>ќсновные (по смылсу - попутные) зан€ти€ дн€ - договор по 
				поводу B&amp;K и мытье окон в лаборатории.</EM></P>
		<P class="MsoNormal"><EM></EM>&nbsp;</P>
		<P class="MsoNormal">1421 - в общем вчерашнюю "проблему" с масштабом решил, за 
			исключением перехода от микро- к милливольтам: число получаетс€ с единицами на 
			конце, а iDelta при этом уже кратна 10...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">2108 - добавил еще один комбобокс (дл€ децимации), но с точки 
			зрени€ сути ни на йоту не продвинулс€...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">----------------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041001 п€тница</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><EM>прид€ на работу в 10:15, на продолжении двух часов занималс€ 
				"почти ничем" - распечатал договора дл€ B&amp;K, написал письмо ѕерфильеву, 
				раздумывал о будущем оборудовании</EM>...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬озвраща€сь к филтрам: где хранить коэффициенты? ѕопробую 
			сначала в CDlgView (их будет возвращать специальный метод)</P>
		<P class="MsoNormal">15:49 - таблицы фильтров хран€тс€ внутри диалоговых функций, 
			которые возвращают конкретные фильтры по запросу вида. ѕри изменении установки 
			в диалоге он постит сообщение виду, и вид мен€ет свой фильтр.</P>
		<P class="MsoNormal">1826 - в CActDView создание буферов вынесено в отдельную 
			функцию (во избежаение многократного создани€ по-разному)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><EM><U>20:53 ”ра! ‘ильтры работают!!!</U></EM></P>
		<P class="MsoNormal">ѕо началу "засада" оказалась произрастающей из матлаба: 
			функци€ besselg , даже когда ей говорили 'low', все&nbsp;равно 
			делала&nbsp;'high'!!!</P>
		<P class="MsoNormal">ƒл€ получени€ "насто€щего" LP ей нужно не говорить ничего...</P>
		<P class="MsoNormal">ѕосле устранени€ этой проблемы (просто пришлось заново 
			переписать все коэффициенты) заработали оба фильтра.
		</P>
		<P class="MsoNormal">» при двух полноэкранных 40-канальных окнах выше 22% 
			процессорного времени не поднимаюсь... ’орошо...</P>
		<P class="MsoNormal">—оответственно, <FONT color="#ff0066">TODO:</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">- коэффициенты дл€ других частот (сейчас - 
				только дл€ 2048)</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">- добавить HP c 0.5 (0.3?) Hz</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">- децимаци€ (это - уже FIR)</FONT></P>
		<P class="MsoNormal"><FONT color="#000099">- обнуление "хвостов" при любой перестилке 
				(смена длительности и т.д.)</FONT></P>
		<P class="MsoNormal"><FONT color="#000099"></FONT>&nbsp;</P>
		<P class="MsoNormal">---------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041008 снова п€тница</STRONG></P>
		<P class="MsoNormal"><EM>... и то до программы добралс€ лишь к вечеру и без большого 
				энтузиазма</EM></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">- добавлен ‘¬„ на 0.5√ц</P>
		<P class="MsoNormal">- переключение таймера из харддиалога (потом можно будет 
			убрать куда-нибудь в setup)</P>
		<P class="MsoNormal">- вывод секундных маркеров</P>
		<P class="MsoNormal">&nbsp; при этом оказалось, что длина окна у мен€ не кратна 
			секунде... Ќужно разобратьс€....</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">вечером, в раздумь€х о надоедливых мелькани€х, попробовал 
			повнимательнее загл€нуть в DirectX. ƒа, похоже что там это возможно... Ќо 
			столько возни будет....</P>
		<P class="MsoNormal">---------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041009 —уббота</STRONG></P>
		<P class="MsoNormal"><EM>...утренний поход в Ћенту - на 1100 рублей (половина - в 
				лабораторию, половина - себе). »нститутска€ сеть на работает. »з "общих дел" - 
				расшарил финансовый каталог (оставил сам каталог у Ћиды, себе сделал симлинк; 
				разрешени€ на полный контроль даны мне и Ћиде, просмотр - Ќ»)</EM></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><STRONG>15:55</STRONG> - проблема с "некратностью" решена 
			следующей заменой:</P>
		<P class="MsoNormal">было</P>
		<P class="MsoNormal"><FONT color="#006600">&nbsp;&nbsp;&nbsp;&nbsp; //int nWNew = 
				nNewCnt * W /m_nLength;&nbsp; </FONT>
		</P>
		<P class="MsoNormal"><FONT color="#006600">&nbsp;&nbsp;&nbsp;&nbsp; (int nNewCnt = 
				m_nCnt - m_nOldCnt; if (nNewCnt &lt;= 0) nNewCnt += m_nLength;)</FONT></P>
		<P class="MsoNormal">стало</P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nWNew = 
				m_nCnt * W /m_nLength - m_nOldCnt * W /m_nLength; </FONT>
		</P>
		<P class="MsoNormal"><FONT color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (nWNew 
				&lt;= 0) nWNew += W; </FONT>
		</P>
		<P class="MsoNormal">&nbsp;&nbsp;&nbsp;&nbsp; (nNewCnt оставлен прежним)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041014 „етверг</STRONG> - точнее, в первом часу 
			п€тницы, уже дома</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕосле воскесных упраженений с Direct3D, увенчавшихс€ как 
			успехом (€ смог что-то нарисовать), так и поражением (дл€ моей программы это не 
			подойдЄт) и обычных финансовых дней смог таки немножко возвренутьс€ к 
			программе.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">”же хочетс€ поиграть с цветами и проч. - а дл€ того нужно 
			сохран€ть установки. — трудом, но вспомнил, каким образом получать доступ к 
			специальному каталогу, сделал им€ файла. Ќо дальше лучше поспать...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">Todo - CMainFrame должна обеспечивать функции доступа к сетапу 
			(как чтение, так и запись, дл€ разных типов параметров)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">-------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041015 ѕ€тнцица</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">Ќачата работа с сохранением переменных - заведено им€ файла.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">-------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041016 —уббота</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ƒоступ к реестру - сохранение некоторых параметров</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041017 ¬оскресенье</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ћассовые нововведени€ - сохранение основных параметров в 
			реестре, сохранение переменных в конфигурационном файле; сохранение вариантов 
			"палитры" и самих цветов.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">---------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041018 ѕонедельник</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕодправлена перерисовка списка цветов каналов</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">---------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041019 ¬торник</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ƒальнейшие изменени€ в работе со списком цветов, дальнейшие 
			усовершенствовани€ общей</P>
		<P class="MsoNormal">работы с установками.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">----------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041020 —реда</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">класс _Settings , диалог - как наследник от него</P>
		<P class="MsoNormal">Ќовые функции дл€ доступа к цветам</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">----------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041021 четверг</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">изменени€ родительских взаимоотношений, отображение с учетом 
			выбранных цветов.
		</P>
		<P class="MsoNormal">" осметические" правки в нескольких классах.</P>
		<P class="MsoNormal">ѕереход на мультимедийный таймер</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041022 п€тница</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ћассовые правки касающиес€ отображени€.</P>
		<P class="MsoNormal">—пециальна€ кнопка в тулбаре дочернего окна дл€ выноса оного 
			наружу и вноса обратно.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041023 —уббота</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">«апрещение изменений в HardDlg в процессе ввода.
		</P>
		<P class="MsoNormal">IIR-фильтраци€ - избавл€юсь от "резких взбрыков" при изменении 
			параметров ввода (изменение
		</P>
		<P class="MsoNormal">фильтра, добавление каналов и проч.)</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041025 ѕонедельник</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">Ќебольша€ доработка отображени€ - устранены "взбрыки" и эффект 
			"зашкала".</P>
		<P class="MsoNormal">ѕримерные прикидки децимирующих фильтров: если "резать" 
			начина€ от 0.75 будущего</P>
		<P class="MsoNormal">(после децимации) Ќайквиста, то дл€ двукратной децимации мне 
			вполне хватит 64 коэф-</P>
		<P class="MsoNormal">фициентов (с обеспечением 100 дЅ подавлени€ на половине 
			частоты среза). ѕри дальнейшем
		</P>
		<P class="MsoNormal">увеличении коэффициента децимации дл€ сохранени€ столь же 
			хорошего подавлени€ нужно</P>
		<P class="MsoNormal">пропорционально увеличивать длину FIR фильтра - но так как при 
			этом будет уменьшатс€ и
		</P>
		<P class="MsoNormal">количество точек, дл€ которых нужен данный расчет, то вроде бы 
			в итоге объем вычислений</P>
		<P class="MsoNormal">останетс€ прежним, эквивалентным 32 точкам дл€ "единичной" 
			децимации. ≈сли € прав,</P>
		<P class="MsoNormal">то этот вариант проходит: нагрузка на процессор не выходит за 
			30% даже дл€ максимально</P>
		<P class="MsoNormal">возможного числа каналов. ј если учесть, что децимаци€ при 
			этом будет реальной (то есть</P>
		<P class="MsoNormal">уменьшитс€ и количество точек дл€ сохранени€) - то должно быть 
			совсем хоршо.</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041027 —реда</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">ѕервые элементы отработки "децимации" в CHardDlg: € буду 
			хранить только "индекс" комбобокса
		</P>
		<P class="MsoNormal">(отображающий лишь итоговую частоту), а коэффициент децимации 
			и фильтры - расчитывать.</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041101 ѕонедельник</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬писана "кратка€ истори€" за период с 041015 и до сегодн€шнего 
			дн€.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">CHardDlg::GetFrq() возвращает <EM><U>конечную</U></EM> частоту 
			(после децимации); кроме того CMainFrame использует вызов actMode.GetFrq() дл€ 
			получени€ <EM><U>реальной</U></EM> (<EM><STRONG>исходной</STRONG></EM>) частоты 
			дискретизации - на ее основе</P>
		<P class="MsoNormal">будут формироватьс€ "входные" буфера.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">------------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041112 ѕ€тница</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬ очередной раз произошел длительный перерыв (плохо!), 
			заполненный в основе своей возней с Ћидой (предзащита 11 но€бр€) и 
			переживани€ми относительно неработающей бухгалтерии и зависших финансов.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬ечером загл€нул в программу - вспоминл, что мне нужно наконец 
			написать фильтр. ј также что дл€ оптимальной фильтрации хорошо подходит 
			4-членный Ѕлэкман-’эррис, но на этом воспоминании дело и закончилось.</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">---------------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041113 —уббота</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">–азгон дл€ выхода из засто€ никак не получаетс€: с трудом 
			соображаю, каким же образом мне фильтр и окно творить.</P>
		<P class="MsoNormal">(точное блэкмана-хэрриса)</P>
		<P class="MsoNormal">w = 0.35875 - 0.48829*cos(x) + 0.14128*cos(2.0*x) - 
			0.01168*cos(3.0*x);</P>
		<P class="MsoNormal">где
		</P>
		<P class="MsoNormal">x = (0:N-1)' * 2.0*pi/(N-1);</P>
		<P class="MsoNormal">т.е.</P>
		<P class="MsoNormal">for (i = 0; i &lt; N; i++)</P>
		<P class="MsoNormal">{</P>
		<P class="MsoNormal">&nbsp; x = i * 2.0*pi/N;</P>
		<P class="MsoNormal">}</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">--------------------------------------------------------------------------------------------------------------------</P>
		<P class="MsoNormal"><STRONG>041125 четверг 2012</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">» вновь почти две недели - ни строчки, ни мысли... “о есть 
			снова: нужно уже не выбиратьс€ - нужно уже начинать заново...</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal"><U><STRONG><EM>-------------------------------------------------------------------------------------------------------------------------</EM></STRONG></U></P>
		<FONT style="BACKGROUND-COLOR: #ccffcc">
			<P class="MsoNormal"><U><STRONG><EM>-------------------------------------------------------------------------------------------------------------------------</EM></STRONG></U></P>
		</FONT>
		<P class="MsoNormal"><U><STRONG><EM>-------------------------------------------------------------------------------------------------------------------------</EM></STRONG></U></P>
		<P class="MsoNormal"><U><STRONG><EM>-------------------------------------------------------------------------------------------------------------------------</EM></STRONG></U></P>
		<P class="MsoNormal"><STRONG>050113 четверг 1438</STRONG></P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">»так, с последней собственно "попытки" (предыдуща€ строчка - 
			не в счет) прошло ровно два мес€ца... “ак что теперь €вно не избежать мес€ца на 
			восстановление в пам€ти того, что € пыталс€ делать - и зачем....</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">¬споминаю: во-первых, в таком случае лучше пользоватьс€ окном 
			Nuttall:</P>
		<P class="MsoNormal">w = 0.3635819- 0.4891775*cos(x) + 0.1365995*cos(2.0*x) - 
			0.0106411*cos(3.0*x);</P>
		<P class="MsoNormal">или</P>
		<P class="MsoNormal">w =&nbsp;a0 - a1*cos(x) + a2*cos(2.0*x) - a3*cos(3.0*x);</P>
		<P class="MsoNormal">где</P>
		<P class="MsoNormal">a0=0.3635819</P>
		<P class="MsoNormal">a1=0.4891775</P>
		<P class="MsoNormal">a2=0.1365995</P>
		<P class="MsoNormal">a3=0.0106411</P>
		<P class="MsoNormal">&nbsp;</P>
		<P class="MsoNormal">1500 - 1700</P>
		<P class="MsoNormal">ѕридумываю "общий подход" к окну: это будет отдельный класс, 
			все параметры окна задаютс€ в конструкторе (там же оно собственно и создаетс€), 
			доступ - через оператор []. “ип окна - строковым параметром (дл€ начала сделаю 
			Nattall, Blackman-Harris, Blackman и Hamming). ѕо умолчанию - Hamming(128).</P>
		<P class="MsoNormal">&nbsp;</P>
		<P><FONT style="BACKGROUND-COLOR: #ccffcc">--------------------------------------------------------------------------------------------------------</FONT></P>
		<P><FONT style="BACKGROUND-COLOR: #ccffcc"><STRONG>050117 пн</STRONG></FONT></P>
		<P><FONT style="BACKGROUND-COLOR: #ccffcc">ѕрошла€ попытка так попыткой и осталась. “о 
				есть новый объект создан был - но не только не был проверен, даже подходы к 
				этой самой проверке выработаны не были. ј потом оп€ть занималс€... —ам не 
				пойму, чем же € занималс€.</FONT></P>
		<P>—егодн€ решил проверить (достал и включит коробку) и обнаружил, что:</P>
		<P>- люба€ децемаци€ тут же рушит все режимы отображени€ (касаетс€ триггерных 
			каналов, длительности окна - и т.д.)</P>
		<P>- переключение децмиации не вызвает тех функций, которые должна была бы.</P>
		<P>20:50 - в функцию обработки изменени€ децимации введен вызов SetMode(-1); при 
			этом в последнюю функцию введена модификаци€, позвол€юща€ при -1 на входе не 
			измен€ть режим; ф-и€ создани€ окна данных дополнена трассировкой 
			ATLTRACE("%d\t%.17f\n",i,dbTmp);, проведено сравнение с матлабовским окном 
			наттолла (пока - только дл€ длины 256), получил результаты идентичные вплоть до 
			15 цифр после зап€той (это может быть вызвано уже и погрешност€ми форматного 
			вывода).</P>
		<P>ѕосле пробы вывод закомментировал (буду пробовать его же - но уже дл€ фильтра).</P>
		<P>----------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050128 пт</STRONG></P>
		<P>≈ще одиннадцать дней перерыва... «аботы с креслом (привезли наконец), отчет по 
			Ўколе... Ќаверное, что-то еще - но € уже ничего не помню.</P>
		<P>¬се ж таки собралс€ с духом: проверил фильтры. ¬о всем диапазоне децимаций (от 2 
			до 128, последн€€ дает возможность спускатьс€ с максимальной дл€ Active2 
			частоты 16384 √ц до конечной дискретизации в 128 √ц) совпадение с ћатлабовскими 
			данными до 1e-16, подавление на будущем Ќайквисте пор€дка 110 дЅ (€ режу на 0,7 
			- но можно и 0.75, и 0.8).</P>
		<P><STRONG><FONT color="#ff0066">!!!CMainFrame::OnTimer - провер€ть на сбой синхронизации 
					нужно каждый отсчет!!!</FONT></STRONG></P>
		<P>18:38 - ƒанные € получаю как полный Long (нулевые младшие биты). ”даление 
			таковых (&gt;&gt;8 == /256) сто€ло в "виде". Ќо сейчас оно мне понадобитс€ в 
			главной функции (CMainFrame::OnTimer) - дл€ осуществлени€ децимации. “ак что из 
			CActDView деление изъ€то.</P>
		<P><FONT color="#000099"><STRONG>!!! ѕроверить, что же у мен€&nbsp;после этого стало со 
					смещением !!!</STRONG>&nbsp;- проверено, смещаю на 14 бит дл€ получени€ 
				полумилливольта.  ажетс€, до того была ошибка (насчитывал в два раза больше)</FONT></P>
		<P><STRONG><FONT color="#ff0066">!!! —овсем плохо с отображалкой при 30 секундах <FONT color="#000099">
						- и €вно "не то" при введении децимирующих коэффициенов.</FONT> !!!</FONT></STRONG></P>
		<P><FONT color="#000099">----------------------------------------------------------------------------------------------------------</FONT></P>
		<P><FONT color="#000000"><STRONG>050201 вт</STRONG></FONT></P>
		<P>«адумалс€ на тему: а с какими буферами € работаю? ѕохоже, что сейчас € пытаюсь 
			(по крайней мере) обрабатывыать данные "на месте" - а дл€ децимации это не 
			вполне подходит. ¬ принципе, можно (есть класть результат в "нулевую" точку, 
			котора€ на следующем шаге уже уйдет из зоны рассмотрени€) - но при этом € очень 
			быстро "накрою" эту точку (в колцевом-то буфере) свежими данными. “о есть - 
			нужны отдельные буфера!!!</P>
		<P>Ѕолее того, непон€тно и то, какое именно число точек € передаю на отрисовку. 
			ƒелени€ на коэффициент децимации не нашел... ѕлохо искал?</P>
		<P>«агл€нул на сайт BioSemi: он просто отображает каждую энную (восьмую - 
			шестнадцатую) точки... √оворит, что иначе не нравитс€ заказчикам... Ќе бред ли?</P>
		<P>----------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050202 ср</STRONG></P>
		<P>Ќет, собственно "перекрыти€" кольцевого буфера можно и избежать - если класть 
			"новую" точку на еЄ же место. Ќо тогда и все "отображалки-сохран€лки" должны 
			будут знать, что брать нужно только эти точки.</P>
		<P>Ќа первый взгл€д, такой подход экономит и врем€, и пам€ть. Ќо по€вл€етс€ слишком 
			много сложностей.  роме того, "вторичный буфер" даст возможность держать:</P>
		<P>- не все каналы, а только "включенные" (в основном окне)</P>
		<P>- децимированную частоту</P>
		<P>- иметь (в будущем) разную децимацию (и частоту) дл€ разных каналов</P>
		<P>- за счет меньшего числа каналов и отсчетов держать более длинный (по времени) 
			буфер дл€ отображени€ и записи.</P>
		<P>1630</P>
		<P>ƒл€ этого при сохранении какое-то врем€ неиспользовавшегос€ m_pChanBuf изменено 
			его содержание, добавлены новые переменные - количество включенных каналов 
			(m_nOnChans) и длина канального буфера (m_dwChanBufLen). <FONT color="#000099">¬опрос 
				в том, каким образом (и из какого места) получить это самое число включенных 
				каналов.</FONT></P>
		<P><FONT color="#000000">ѕотихоньку постигаю: главна€ карта содержитс€ в CLeftDlg, 
				доступны в CMainFrame по ссылке m_pMainMap. Ќу а там - простой подсчет...</FONT></P>
		<P>1652 ќднако, сейчас € даю возможность изменить общее количество каналов при 
			включенном вводе - а мне нужно это дело запретить!!!</P>
		<P>1654 —делано. <FONT color="#ff0066">Ќо сейчас € вновь разрешаю изменени€ сразу после 
				остановки - а в будущем разрешать мен€ть такие главные параметры можно будет 
				только в том случае, если файл не был начат!!!!</FONT></P>
		<P><FONT color="#ff0066">-------------------------------------------------------------------------------------------------------</FONT></P>
		<P><FONT color="#000000"><STRONG>050207 пн</STRONG></FONT></P>
		<P>ѕри переходе к "поканальной буферизации" по€вл€етс€ возможность заложить разные 
			коэффициенты децимации (и, соответственно, частоты дискретизации) дл€ разных 
			каналов. ¬ насто€щий момент это имеет смысл только дл€ "статусного" канала - но 
			закладывать принципальную возможность нужно уже сейчас. Ћучше всего посмотреть, 
			каким образом это было организовано в dUEn</P>
		<P>ѕосмотрел... Ќет, от этого отталкиватьс€ не стоит - хот€ бы потому, что в "том" 
			варианте частоты дискретизации (и пр.) описывались лишь дл€ группы каналов - а 
			в самом канале указывалась лишь принадлежность к группе. Ќаверное, нужно вз€ть 
			что-то подобное BDF.&nbsp; Ќо!!! “ам, где это возможно, € буду использовать не 
			ASCII, а числовые значени€ (пределы, длина); к тому же ¬—≈√ƒј буду указывать 
			"длину на секунду" (частоту дискретизации) - и уж потом ее "переваривать".   
			этому будет добавлена и собственно длина....</P>
		<P><FONT color="#000000">≈ще правильнее: в "рабочем списке" указываютс€ только 
				"внутренние параметры" - номер канала в глобальном списке, длина (в отсчетах), 
				смещение в кольцевом буфере. „астота/дискретизаци€??? ¬се прочие - задаютс€ в 
				глобальном списке (расчет на то, что насто€щие параметры каналов будут мен€тьс€ 
				реже, нежели их включенность/выключенность). Ќо тогда мне понадоб€тс€ два 
				разных класса: один - дл€ "глобального" списка каналов, другой - дл€ "рабочего 
				списка". “ак их и назову: $ChanG и $ChanW.</FONT></P>
		<P>2148</P>
		<P>«аведены новые классы дл€ "√лобальных" и "рабочих" каналов (почему-то в списке 
			не показываютс€ - неужели дело в долларе?)</P>
		<P><EM><U>«арегистрировалс€ на фотосайте - имею уже п€ток положительных комментариев за 
					первую фотку. ћелочь, а при€тно :)</U></EM></P>
		<P>ѕрактически вс€ работа по положению/выниманию данных переложена на класс. 
			 омпил€ци€ проходит, пробные запуски привод€т в вылету из-за неверной длины: 
			почему-то
		</P>
		<P>DWORD dwLen = m_HardDlg.GetFrq() * 30;</P>
		<P>дает мне страшенную цифру - и отбор пам€ти не проходит.</P>
		<P><FONT color="#000099">ѕроверить работу этого GetFrq - и установить обработку ошибки 
				при заборе пам€ти!!!!</FONT></P>
		<P>--------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050208 вт</STRONG></P>
		<P>1218 - установлена обработка ошибки выделени€ пам€ти</P>
		<P>1222 - устранена ошибка в CHardDlg - как всегда, неинициалирозованна€ переменна€ 
			m_nFinalFrq</P>
		<P>“еперь нужно подумать, как передавать информацию на отрисовку....</P>
		<P>1500 - ѕокамест наблюдаетс€ небольша€ засада: в "виде" € оперирую со списками 
			каналов (референтных и отображаемых), на вход мне тоже поступает список - но 
			уже каналов вводимых. ѕолучаетс€, что мне нужно сравнивать два списка на 
			совпадение содержимого - а это м€гко говор€ врем€еемко. “о есть делать это при 
			каждом поступлении данных не хочетс€. “огда хотелось бы другого: найти место, 
			где эти списки формируютс€ - и попытатьс€ в этом месте сформировать список по 
			отношению к списку вводимых каналов.</P>
		<P>1511 - Ќет, не получитс€. —писки формируютс€ диалогом при каждом изменении 
			соотв. карты (или же - списка бипол€ров). “о бишь дл€ того, чтобы пересчитать 
			на списко вводимых каналов, диалогу нужно таковой передавать - а это уже 
			слишком... Ќо не сделать ли тогда проще: вообще избавитьс€ в CDialogView от 
			списков - и передавать просто адреса соответствующих карт. “огда и сравнивать 
			будет проще... ѕосмотрим, где и как используютс€ эти вызовы и списки.</P>
		<P>”гу. ѕон€тно.&nbsp;‘ункции - только в "рисовательной" функции вида - той, 
			которую € сейчас и мен€ю. Ќичего страшного. —ами списки - тоже лишь в функции 
			CDlgView::CorrectMap(), в деструктуре - и в функци€х получени€ доступа и 
			размера. “ак что можно исправл€ть - только аккуратно. ќстаетс€ еще вопрос с 
			бипол€рами - там-то вроде без списков и никак....</P>
		<P>1700 - –азумеетс€, все не так просто, как хотелось бы. ¬ старом варианте € шел 
			сначала по отсчетам, а уже потом по каналам - и легко мог использовать дл€ 
			референта единственное число. ¬ новом € должен резервировать массив, причем он 
			каждый раз может иметь разную длину. “о есть нужно будет эту длину определ€ть, 
			массив при необходимости наращивать, а при каждом заходе массив обнул€ть.... 
			ѕри этом нужно учесть, что "реферирование" каналов с разной децимацией в 
			принципе невозможно!!!</P>
		<P>1705 буфер, кстати, у мен€ уже есть. “олько он никак не использовалс€... ¬от 
			теперь и задействуем :) Ќо вот длину нужно добавить</P>
		<P>------------------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050218 пт</STRONG></P>
		<P>Ќа том месте, где прерываетс€ предыдуща€ запись, порушил систему. ј когда 
			готовил к переустановке, затер VSS-овскую базу этого проекта. ’орошо, дома 
			некое подобие нашлось... ¬ общем, весь конец прошлой недели на это и ушел. ј 
			дальше в основе своей - стать€ SLB, семинар ¬и“ек'а, поездка в ѕолюс... Ёто - 
			из рабочего. »з "внерабочего" - возн€ с фотографи€ми. ѕодготовил 
			вороьб€-командира, сегодн€ заслал.Ќо комментариев мало, увы....</P>
		<P>»так, попробуем посвпоминать, на чем мы остановились....</P>
		<P>2115 - ” мен€ даже еще не установлены драйвера от BioSemi, так что программа 
			просто вылетает... ѕоставлены доп. проверки, позвол€ющие по крайней мере ничего 
			не делать :))) Ќќ!!! <FONT color="#ff0066">¬ таком режиме у мен€ наблюдаютс€ утечки 
				пам€ти...</FONT></P>
		<P><FONT color="#ff0066">------------------------------</FONT><FONT color="#000000">----------------------------------------------------------------------</FONT></P>
		<P><STRONG>050219 сб</STRONG></P>
		<P>“ак как вчера даже близко к работоспособности не подобралс€, решилс€ таки 
			приехать на работу в субботу (прошлые три субботы пропустил - смотрел на –оми 
			Ўнайдер в трилогии про императрицу —исси). „то ж, вроде бы приехал не зр€:</P>
		<P>- ¬ызов из CMainFrame "видовых рисовалок" производилс€ не с тем lParam (либо 
			недописанный, либо утер€нный при вылете системы кусок)</P>
		<P>- Ќикак не мог ввалитьс€ в отладку в ChanW: в итоге функции вынес в cpp-файл, а 
			сам класс переименовал в _ChanW ($ChanW чем-то не устраивал студию: не 
			показывала имени.)</P>
		<P>14:23: наблюдаютс€ следующие вылеты: после остановки ввода получаю нарушение 
			доступа по записи в функции OnTimer. ќчень похоже, что в этот момент € уже 
			разрушил канальные буфера - но продолжала работу функци€ OnTimer....</P>
		<P>16:29 ¬ыход из положени€ пыталс€ найти в перенесении цилка подсчета 
			каналов/заполнени€ массива включенных каналов из OnRunGo() в OnMapChaged() - но 
			долго не получалось. ќказалось, что эта ф-и€ не вызываетс€, а вызваетс€ 
			аналогична€ ветка из PreTranslateMessage(). ”бирание ветвлени€ не помогло - 
			пришлось напр€мую вызвать ф-ию. ¬ таком виде работает.</P>
		<P>Ќќ!!! я оказываюсь в классической ситуации, требующей синхронизации доступа: 
			массив каналов, который € удал€ю-модифицирую в OnMapChaged() используетс€ в 
			асинхронной ф-ии OnTimer() - и в таков варианте возможны любые нюансы.... Ќужно 
			что-нибудь типа как минимум критической секции....</P>
		<P>17:45 Critical Section заведена и, как показала отладочна€ печать, не напрасно: 
			попытки конкурентного доступа встречаютс€ нередко...  ажетс€ минусом то, что 
			при выключении приборда не запрещаетс€ основна€ карта (и все дочерние). ’от€ 
			так было и в предыдущих верси€х... Ќо наверное лучше все-таки их сбросить - 
			совсем....</P>
		<P>17:56 - предыдущее сделано путем исправлений в CHardDlg::SetMode&nbsp;
		</P>
		<P>19:19 Ѕыли большие проблемы с полной неработоспособностью: €вно лез не в ту 
			пам€ть... ќшибки обнаружилось две: во-первых, размер канального буфера 
			определ€лс€ из общего кол-ва каналов (и получалс€ нулевым) - <FONT color="#ff0066">а 
				нужно???</FONT> из включенных (это в OnMapChanged). ¬о-вторых, уже в 
			OnRunGo() это значение вновь обнул€лось - и заново не пересчитывалось... “о 
			есть выдел€л пам€ть нулевой длины - вот не туда и лез... —ейчас добилс€ по 
			крайней мере "тишины" (вид еще ничего не делает - но хоть вылетов нет....).</P>
		<P>-----------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050221 пн</STRONG></P>
		<P>1307  ак вы€снилось, субботн€€ "невылетаемость" обеспечивалась без записи в 
			"третий" буфер. Ќо и при таковой (сейчас разрешил) работает...</P>
		<P>1545 ѕо ходу дела нашел еще несколько закомментированных строк, предотвращающих 
			запись в выходной буфер. Ќо и это не помогло: если и рисовались, то сплошные 
			нули... ¬ итоге оказалось, что в CActDView::OnPlot дл€ адресации выходного 
			буфера использовалась переменна€ nChanIdx, а модификаци€ оной не 
			производилась.... ѕосле устранени€ этого "недостатка" рисование заработало. Ќа 
			насто€щий момент два главных недостатка:</P>
		<P>-<FONT color="#6600ff"> не отрисовываетс€ статусный канал<BR>
			</FONT><FONT color="#000099">- ƒовльно часто возникают "затыки" при изменинии 
				главной карты (очень похоже на дедлок).</FONT></P>
		<P>20:37 - <EM>около семи выскочил поснимать "след ледокола". „уточку опоздал 
				(обманулс€ светлым небом - но то на западе, на востоке же уже царила глубока€ 
				ночь). Ќаверное, получилось бы все равно неплохо (€сно, ветер разнес дымку - и 
				луна), хот€ и было очень холодно, пальцы заледенели... Ќо получилось очень 
				смазано, и только при "разборе" пон€л почему: не выключил стабилизатор, вот он 
				и дурил при съемке со штатива :((( ј удастс€ ли повторить, не€сно: холодно, и 
				след может зат€нуть... ќбидно будет :(((</EM></P>
		<P>√овор€ о "сути": во-первых, статусный канал тоже нужно сдвигать вправо на 8 бит. 
			ј во-вторых, € не определил дл€ него пам€ть (в соотв. цикле забыл поставить +1) 
			- вот он и возвращал все врем€ нули... ѕосле исправлени€ отрисовка тригеров 
			заработала.</P>
		<P>21:15 ѕри помощи многочисленных ATLTRACE удалось установить: в то врем€, как 
			критическа€ секци€ захвачена процедурой обработки таймера, € пытаюсь доступить 
			к ней из процедуры обработки OnMapChaneged - и на этом месте глухо висну. 
			¬идимо, поток-то у мен€ все же один... “огда наиболее правильный вариант - 
			вынесение всего пользовательского интерфейса в отдельный поток, но сейчас € 
			такого не пот€ну... Ќе пот€ну даже вы€снени€ вопроса о том, в самом ли деле это 
			один поток (и если да - то каким образом выполнение одного запроса прерываетс€ 
			другим).</P>
		<P>ѕроблему удалось победить (насколько успешно, покажут врем€ и дальнейшие тесты): 
			отказом от входа в обработку таймера, ежели секци€ зан€та (полага€, что это не 
			будет фатально, к тому же ни одного подобного "попадани€" зарегистрировать не 
			удалось). — обработкой OnMapChanged() так грубо поступать нельз€ - буду 
			пропускать изменени€ карты. ѕоэтому в ситуации возможного дедлока отваливаюсь, 
			перед этим заново запостив себе же это же самое сообщение. ¬ таком виде вроде 
			как работает...</P>
		<P>--------------------------------------------------------------------------------------------------------------------</P>
		<P>050222</P>
		<P>12:03 ѕоджал таймерный критический фрагмент, исключив из него начало обработки 
			(где массив каналов не используетс€). ѕоначалу было плохо после старта при 
			выключенном девайсе - видимо, из-за "выхода" из CS не сопровождавшегос€ вводом. 
			ѕосле заведени€ соотв. флага стало совсем хорошо&nbsp; :))) ѕравда, редкие busy 
			встречаютс€....</P>
		<P>ToDo:
		</P>
		<P><FONT color="#ff0066"><FONT color="#000099">- увеличить спин-каунт, вспомнить про 
					старший бит в нЄм</FONT>.</FONT></P>
		<P><FONT color="#000000">сделано в 20:25. ѕосле этого даже отошел от вчерашних 
				"нововведений" (отказа от входа в обработке таймера и повторного поста 
				сообщений в обработке OnMapChanged()) - и ничего, работает... ”далось получить 
				сообщение о невозможности войти (уже в режиме "ввода" - от таймера) - но и оно 
				не вызвало зависаний...</FONT></P>
		<P><FONT color="#000099">- –азличать в OnMapChanged, кака€ карта изменилась - главна€ 
				или дочерн€€. ѕолную обработку делать только по главной!!!</FONT></P>
		<P>сделано около 20:25. Ќо мне не понравилось, что дл€ не-главной приходитс€ 
			перебирать диалоги - почему-то из карты в создавший оную диалог сообщение не 
			доходит - ни в PreTranslateMessage (этот почему-то вообще не вызываетс€) - ни в 
			карту... ѕовозилс€, и вернул всЄ на места. Ќадо вспоминать...</P>
		<P>-------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050224 чт</STRONG></P>
		<P>¬€лый день (отходн€к). ”тром успел послать четвертую фотку на фотосайт - дальше 
			в основном тем и занималс€, что ждал ответов... ≈динственное, что сделал - 
			перенес в CMainFrame::OnTimer расчет смещений в основной канальный цикл (был в 
			отдельном).</P>
		<P>ѕосле чего задумалс€ на тему: а что же € успел сделать на тему FIR-фильтра - и 
			где??? “олько в восьмом часу вечера вы€снил - сделано это было в 
			CHardDlg::SetMode, причем фильтр порождалс€ локально - и тут же стиралс€ 
			(использовалс€ только дл€ отладочной печати). “о есть снова нужно думать: а где 
			же мне держать этот самый фильтр (чтобы не слишком далеко был) - и как 
			правильно организовывать буфера дл€ фильтрации....</P>
		<P>---------------------------------------------------------------------------------------------------------</P>
		<P>050225 пт</P>
		<P>—нова ничего не удалось - и уже не получитс€, очевидно :(((</P>
		<P>¬ очередной раз полез в ¬орд - и пон€л, что его дополнительное пусто-молчаливое 
			окно мне надоело! —нЄс ќ–‘ќ - не помогло. —нес и поставил офис - не помогло... 
			¬ общем, помогло только: снести офис, вручную стереть соотв. ветки реестра - и 
			только после того поставить офис заново (видмо, глюк происходит из утилиты 
			переноса файлов и установок). Ќо после этого отказалась стартовать студи€ 
			.Ќ≈“.... ѕостановка "поверх" не помогла - пришлось сносить и ставить заново. ј 
			кака€ уж после этого работа...</P>
		<P>≈динственное, что смог сделать за день - это вспомнить, каким образом была 
			организована децимирующа€ фильтраци€ в dUEn. “ам действительно заводились 
			буфера - по одному на канал, но размером точно в длину фильтра. Ѕуфера - на ¬—≈ 
			каналы, в том числе и те, которые фильтровать не предполагалось - чтобы было 
			откуда брать "синхронные" данные. Ёто, разумеетс€, порождало проблему 
			"цикличности", в простом варианте требующую дополнительного сравнени€ на каждом 
			шаге. —и€ проблема обходилась следующим образом:</P>
		<P>if (((scan+decOff)%nDec)==0) {<BR>
			&nbsp;&nbsp;&nbsp;for (int k = posScanF+1; k &lt; FILLEN; k++)<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum += 
			(double)pFiltBuf[k*nNumch+chn]*flFilter[kF++];&nbsp;<BR>
			&nbsp;&nbsp; for (k = 0; k &lt;= posScanF; k++)&nbsp;<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum += 
			(double)pFiltBuf[k*nNumch+chn]*flFilter[kF++];
			<BR>
			}</P>
		<P>“о есть вместо одного цикла использовалось два - но без "двойных сравнений"... 
			»нтересно, а реальный выигрыш от этого есть?</P>
		<P>√де это всЄ должно находитьс€? Ќаверное, не слишком далеко: если потребление 
			данных и децимаци€ будут производитьс€ в CMainFrame::OnTimer, то и фильтр, и 
			промежуточные "фильтовальные блоки" должны лежать там же. —итуацию с хранением 
			может слегка облекчить то, что изменение режима децимации возможно только во 
			врем€ "останова" - тогда и аллоцировать буфера/считать фильтр может в 
			"стартовалке". ѕрибивать же буфера можно там же - и при выходе.</P>
		<P>-------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050228 пн</STRONG></P>
		<P>»так, где держать фильтр и соотв. буфера, € решил. Ќо ведь не про€снен вопрос с 
			форматом!!!
		</P>
		<P>¬от и сижу целый день, считаю биты: что делать, дабы точно ничего не потер€ть - 
			при 24 входных, стольки же выходных - и фильтре длиной до 4097 коэффициентов... 
			≈сли верить мелком€гким, то в double у мен€ на мантиссу приходитс€ 52 бита - то 
			есть потер€ вроде бы минимальна€...  онечно, пользовать все 64 - лучше... Ќо 
			слишком ли заморочно. » - главное - как проверить????</P>
		<P>¬ общем, голова мо€ не соображает :((( “ак что остановлюсь пока на варианте 
			double...</P>
		<P>¬ итоге с большими трудами и длительным хождением по площадке перенес 
			формирователь фильтра в CMainFrame, и там же организовал "фильтровальный 
			буфер".</P>
		<P>ƒл€ мен€ не совсем удобно то, что таймерный цикл работает в цикле каналы-точки 
			(придетс€ держать по указателю на канал). Ќужно посмотреть, нельз€ ли работу с 
			этим буфером вклинить таким образом, чтобы его заполнение (по крайней мере) шло 
			в пор€дке точки-каналы... ѕогружаемс€ в функцию OnTimer();</P>
		<P>----------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050301 вт</STRONG></P>
		<P>≈ще одно неудобство, вызываемое циклом "каналы-точки": мне где-то нужно хранить 
			(и оп€ть - по-канально) счетчик значений: с тем, чтобы фильтровать (и помещать 
			в выходной буфер) только нужные....</P>
		<P>16:20 ¬роде как завел все необходимые переменные и прописал цикл децимации - 
			но... ”вы, даже начать пробовать не могу: как только включаю децимирование, у 
			мен€ запрещаютс€-исчезают все диалоги. Ќадо провер€ть...<BR>
			16:24 ѕри смене децимации € вызываю CHardDlg::SetMode(-1) - а контролы у мен€ 
			запрещались при модах &lt;= 0... <FONT color="#000099">—менил на = 0... Ќужно 
				проверить, в каких еще случа€х SetMode вызываетс€ с -1!</FONT></P>
		<P>16:37 ¬ы€снил: -1 вообще-то используетс€ как признак отключени€... —менил вызов 
			на SetMode(aMode.GetMode()); - используетс€ существующее значение. “ак лучше, и 
			даже не вылетает. Ќо:<BR>
			<FONT color="#000099">- —оответственно уменьшаетс€ и длительность вывода (4 секунды 
				вместо 8)<BR>
				- нечто похожее на реальные данные проскальзывает лишь изредка...</FONT></P>
		<P>¬ очередной раз - все та же проблема: не попадаю в карту сообщений вида. 
			ѕроблема была решена путЄм:<BR>
			- наследовани€ класса вида от CMessageFilter<BR>
			- передачи ему в качестве параметра конструктора адреса CMessageLoop 
			графического потока<BR>
			ѕри этом оказываютс€ рабочими как PreTranslateMessage - так и карта 
			сообщеиний...</P>
		<P>Ќо вот параметры передаютс€ всЄ равно не те....</P>
		<P>------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050302 ср</STRONG></P>
		<P>¬ы€снилось, что у мен€ и безо вс€кой децимации длины считаютс€ неправильно: как 
			бы только дл€ 2048 √ц... “еперь вот поди вспомни, кака€ из переменных чего 
			значит....</P>
		<P>14:02 - пытаюсь вспомнить<BR>
			m_nLength = m_nDur * m_nLen //€вно - длина окна в отсчетах</P>
		<P>14:29 ƒа, исходно был совсем бред... »збавилс€ от m_nLen, стал запоминать 
			частоту - стало нормально работать при разных частотах. Ќо не при децимации!!!</P>
		<P>15:02 ƒа, там и не в одном месте бред... CMainFrame::OnTimer передавал 
			ѕќЋ”„≈ЌЌќ≈ количество новых точек. ј по-просту делить его тоже нельз€ - по этим 
			точка ведетс€ отсчет входного буфера... » вообще: передавать количество точек 
			неправильно, коль скоро это количество может быть разным дл€ разных каналов!!! 
			ѕусть пока - только дл€ триггерного, но кто знает...
		</P>
		<P>16:15 ј нужно ли мне что-нибудь дл€ этого? »ли уже существующий класс _ChanW эту 
			задачу может выполнить?</P>
		<P>19:28 “ак и не вспомнил, как правильно делать колцевой буфер... ѕока "тупо" 
			добавил счетчики зан€того и свободного места... ј ведь где-то, в каком-то 
			учебнике про это было хорошо расписано - с примерами, подводными камн€ми...</P>
		<P>-----------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050311 пт</STRONG></P>
		<P>» снова - перерыв больше недели :(((<BR>
			ѕоходы по магазинам за подарками дл€ мамы (все равно ничего делать не мог), 
			беседы с ЋЅ по “«, заливка нового ноутбука Ќ—–, немного писанины по repeated 
			measures на выходных (которых было три дн€), визит к “ать€не јлександровне...</P>
		<P>¬ общем так: классы из стандартных библиотек использовать можно - но не буду: 
			универсальность мне не нужна, а вот возможные потери быстродействи€ могут 
			оказатьс€ существенными. —ильно экомномить на паре переменных 
			(зан€тый/свободный размеры массива) тоже глупо: лишь затрачу кучу лишнего 
			времени на проверки при каждой операции. ѕосмотрим, на чЄм всЄ-таки 
			остановилс€...</P>
		<P>»так, остановилс€ на модификации ChanW. »де€: каждый канал должен передавать 
			полученное количество точек. ƒл€ этой цели хорошо подход€т "внутренние 
			счетчики". Ќо, кроме того, мне нужно будет из каждого канала достать 
			информацию, на основании которой € смогу расчитать "горизонтальный масштаб"...</P>
		<P>¬ таком случае получаетс€, что € в рамках CActDView должен отказатьс€ и от 
			единого "—обственного буфера" (пересчитанные каналы, подлежащие отображению) - 
			а пользоватьс€ тем же самым классом. “о есть - списком каналов...</P>
		<P>¬ насто€щий момент буфера определ€ютс€ в <FONT color="#000099">CActDView::SetBuffers</FONT>
			как:<BR>
			m_nLength = m_nFrq * m_nDur/4;
			<BR>
			m_pRefBuf = new long[m_nLength];
			<BR>
			m_pChanBuf = new long[m_nLength*(m_nBufChans-2)];
			<BR>
			m_pBpBuf = new long[m_nLength*(m_nBufChans-2)];
			<BR>
			m_pTrigBuf = new WORD[m_nLength];</P>
		<P>Ёта функци€ вызываетс€ изнутри - из OnCreate и SetFrq; последн€€ - как обработка 
			сообщени€, вызываемого диалогом (при смене длительности ) и главным окном (при 
			запуске - то есть по команде Go). “о есть длительности перерасчитываютс€ по 
			установленной длительности окна отображени€.  оличество каналов беретс€ как 
			m_pMainFrame-&gt;GetActChans(); - то есть общее количество вводимых каналов!!! 
			ј мне-то это зачем????
		</P>
		<P>’от€ есть и друга€ сторона вопроса: просто делать все каналы разными никак 
			нельз€: € просто не смогу считать референты/бипол€ры. “огда получаетс€, что 
			нужно (как это было в dUEn/dWEn) деление на группы. ¬ то врем€, как сейчас 
			групп только две - "обычные" каналы и триггер. » понадоб€тс€ ли другие - совсем 
			не€сно... » (кстати) - сколько может быть бипол€ров? "“еоретически" - очень 
			много (N*(N-1)), где N - число вводимых каналов. ѕрактически же... ј почему 
			пользователь не может захотеть получить ¬—≈ межполушарные бипол€ры? »ли 
			"привести" все каналы к соответствующему уху??? <STRONG>Ergo:</STRONG> бипол€рные 
			массивы тоже должны формироватьс€ динамически: завели новую пару - добавили... 
			» тогда ещЄ один вопрос: а почему € должен заводить эти массивы на всю 
			длительность граф. окна? ѕросто потому, что в противном случае непон€тно, каким 
			образом выбирать???</P>
		<P>Ќо если бипол€ры перераспредел€ть динамически - то почему не поступать так же и 
			с остальными каналами?</P>
		<P>--------------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050315 вт</STRONG></P>
		<P>Ќасколько € помню, в п€тницу единственное до чего добралс€ (кроме подобных 
			"досужих" размышлений) - попыталс€ повнимательнее посмотреть, что же происходит 
			при децимации. ¬печатлени€ крайне негативные:<BR>
			- как будто фильтрует "не то" (слишком сильна€ фильраци€)<BR>
			- при финальной частоте 128 √ц и частоте опроса 50 √ц (20 мс) € получаю 
			некратное (2.56) и маленькое количество точек на выборку.  ак итог - "рвана€" 
			крива€ (точнее - ломана€).</P>
		<P> стати, где-то здесь и аргумент в пользу буферизации полного окна вывода: даЄт 
			возможность перерисовать при перестилке... ј как у мен€ со "сверхкороткими" 
			выборками в старых децимирующих программах???</P>
		<P>-------------------------------------------------------------- 
			------------------------------------------------------------------</P>
		<P><STRONG>050316 ср</STRONG></P>
		<P>» снова дальше этой пары мыслей дело не пошло... ѕосмотрел в старую программу: 
			никакого учЄта "старой точки" (в пределах PolyLine) нет. ≈сли и учитываетс€ - 
			то на этапе буферизации...</P>
		<P>¬ очередной раз получаетс€, что € хочу совсем по-другому... » при этом с трудом 
			соображаю, как именно... Ќо примерно:<BR>
			- ”стройство опрашивать пореже (скажем, 5-10 √ц, то есть 100-200 мс)<BR>
			- после опроса, забора и опциональной фильтрации-децимации данных отправл€етс€ 
			сообщение "видам". “ам происходит не только референсирование и опциональна€ 
			IIR-фильтраци€ - но и “”“ ∆≈ формируютс€ кривые (PolyLine), и “”“ ∆≈ 
			отрисывываютс€ (где??? ¬ каком-то внутреннем еще одном граф. буфере)<BR>
			- собственно отображение происходит по —ќЅ—“¬≈ЌЌќћ” таймеру, с бќльшей частотой 
			(скажем, 50 √ц, 20 мс). —амое лучшее - это сделать отображалку прив€занной к 
			кадровой развертке, но как это сделать € пока без пон€ти€ (были попытки с 
			directX, но неудачные - при обращени€х с обычнми рисовательными функци€ми эту 
			систему клинит).<BR>
			- –исовательный таймер запускаетс€ только после окончани€ обработки первой 
			порции данных<BR>
			- ѕри его срабатывании нужно грамотно определ€ть, какие точки (уже не точки 
			данных, а пикселы буфера) добавл€ть - и сдвигать при осциллоскопическом режиме.</P>
		<P>17:08 - в очередной раз залез посмотреть на DirectX. Ќет, ничего там нет... 
			Ergo, не нарисовать....
			<BR>
			≈сли же поступать проще, то непон€тно, какой таймер брать (все равно точно под 
			развертку мне будет не подобрать).</P>
		<P>---------------------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050317 чт</STRONG></P>
		<P>14:05
			<BR>
			<U>- ѕри любом изменении дочернего окна делать полный его рестарт!!!<BR>
			</U>ѕри этом € переопреле€ю и "граф. окно в пам€ти".  акого размера оно должно 
			быть? ¬ принципе, с запасом должно хватить двукратной (даже полуторакратной) 
			длительности окна вывода. Ќо попробуем рассмотреть крайний случай: минимальную 
			длительность 1/4 секунды. “огда, учитыва€ реденькое квантование ввода (около 5 
			√ц, то есть 1/5 секунды) весьма велик риск этот вывод перекрыть новым... ј 
			может оно и не страшно? ѕосмотрим....<BR>
		</P>
		<P><U>- ѕоведение по граф. таймеру:<BR>
			</U>&nbsp;&nbsp; - ќсциллоскопический режим<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - определ€ем относительное врем€ (мс) 
			относительно старта этого окна<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - переводим это врем€ в точки экрана<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- эта точка будет ѕќ—Ћ≈ƒЌ≈… отображаемой 
			точкой нового вывода<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ѕ≈–¬ќ… точкой буфера будет последн€€ точка 
			предыдущего (включа€ - чтобы зарисовать серую линию - маркер)<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ќпредел€ем, не было ли перехода через конец 
			окна:<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - не было - просто битблтуем 
			буфер<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - было - плюемс€ два раза (до 
			конца окна и от начала до конца буфера)<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - рисуем маркер<BR>
		</P>
		<P>15:10 ѕромежуточные буфера CActDView получаютс€ независимыми от длительности 
			окна. “огда можно поступить двум€ способами: определ€ть их однократно при 
			запуске ввода (и тогда отводить под все обрабатвываемые каналы) - или же 
			дополнительно переконфигурировать каждый раз при изменении количества 
			каналов... ѕохоже, что нужен будет именно второй вариант, прежде всего - из-за 
			недетерминированности количества бипол€рных каналов...<BR>
			¬ качетве длины этих буферов можно вз€ть некоторое детерминированное значение - 
			скажем, 8 секунд...<BR>
			»зменение буферов должно происходить в функции "полного рестарта". ƒл€ этого 
			нужно определить точку входа обработки изменени€ карт каналов и бипол€ров. Ќо 
			(оп€ть же!) preTranslateMessage до вида не доходит....</P>
		<P>15:32 ≈динственной рабочей точкой входа в диалоге €вл€етс€ ф-и€ CorrectMap() - и 
			то лишь потому, что она вызываетс€ в цикле из главного окна!!! ¬се же хорошо бы 
			было, если бы можно было вызвать еЄ не в цикле - а "целенаправленно"....</P>
		<P>15:42 - поступил с диалогом так же, как ранее с видом: в дополнение к уже 
			сущестовавшему наследованию от CMessageLoop нужно еще зарегистрировать этот 
			цикл в "основном". Ќо в отличие от вида, на сей раз основным €вл€етс€ именно 
			главный цикл приложени€ (интересно, правильно ли это?). ¬ таком варианте 
			CDlgView::PreTranslateMessage начинает работать....</P>
		<P>16:04 - в таком варианте даже PreTranslate не нужен - нормально работает вход по 
			CDlgView::OnMapChanged.<BR>
			“еперь нужно посмотреть, что происходит при подключении бипол€ров...</P>
		<P>16:19 - в обработчики бипол€рного чекбокса и листа добавлено 
			m_pView-&gt;PostMessage(WM_DIZ_MAPCHANGED);</P>
		<P>17:56 ¬ текущей конфигурации происходит непри€тна€ вещь: в осциллоскопическом 
			режиме графика сбрасываетс€ на начало не только при изменении размеров окна, но 
			и при его перемещении (но не всегда).  онцов этому делу найти не смог :((( ¬ то 
			же врем€ пон€л, что органолептически при€тнее, когда после изменени€ размеров 
			окно не "обнул€етс€". Ёто значит, что € таки должен хранить промежуточные 
			буфера ѕќЋЌќ… ƒЋ»“≈Ћ№Ќќ—“» окна (иначе мне будет не восстановить нужные точки). 
			» предусматривать очень специальный режим отрисовки полного окна....</P>
		<P><FONT color="#ff0066">18:08</FONT> - сброс m_nPos на ноль происходит в OnPaint 
			из-за того, что она действительно оказываетс€ "за пределами" окна. Ќо почему???</P>
		<P>18:12 ѕочему-то при перемещении окна равной его правой границе оказываетс€ 
			перменна€ nWNew... »щем...</P>
		<P>18:22 <FONT color="#000099">NB!!! ¬ылеты при удалении дочернего окна - € не 
				разрегистрирую цикл</FONT> сообщений!!!</P>
		<P>20:00 ”даление фильтра сообщений из родительского цикла (как дл€ вида, так и дл€ 
			диалога) помогла, но не совсем: все равно продолжились вылеты. јнализ показал, 
			что они проистекают из-за того, что после удалени€ вида становитс€ 
			неопределенной переменна€ CMainFrame::m_pCurrentView. » тут мы имеем вопрос: а 
			какой собственно вид должен становитьс€ текущим после удалени€? —ледующий? 
			ѕредыдущий? “ут поможет только волевое решение... —делаем так:<BR>
			- если был удален не последний вид, текущим становитс€ следующий (с тем же 
			номером)<BR>
			- если был удален последний вид, текущим становитс€ предыдущий (естественно)<BR>
			- при удалении последнего вида переменна€ обнул€етс€</P>
		<P>20:12 » это не помогло. ѕришлось добавить стандартное <FONT color="#000099">&amp;&amp; 
				::IsWindow(*m_pCurrView) . </FONT><FONT color="#000000">¬ таком варианте 
				вопросов не вызывает - и вроде бы закрытие проходит нормально. ¬озвращаемс€ к 
				вопросу от <FONT color="#ff0066">18:0</FONT>8 .</FONT></P>
		<P>20:52 - Ќет, "запредельным" оказываетс€ NWnew - видимо, всЄ здесь растЄт из того 
			факта, что OnPaint вызываетс€ "не во-врем€"...</P>
		<P>------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050318 пт</STRONG></P>
		<P>15:20 ¬ погоне за сбо€щими счетчиками обрамил все изменени€/обращени€ 
			критическими секци€ми - всЄ равно не помогло. ¬ итоге дело оказалось проще: в 
			самом начале CActDView::OnPaint сто€ло<BR>
			&nbsp; int nNewCnt = m_nCnt - m_nOldCnt;
			<BR>
			&nbsp; if (nNewCnt &lt;= 0) nNewCnt += m_nLength;<BR>
			- а в случае "произвольной перерисовки" счетчики оказывались равны, вот € и 
			получал "полную длину" вместо нул€. ѕроблему решила замена сравнени€ на "строго 
			меньше", с выходом из фукции при равенстве нулю.</P>
		<P>15:46 - закомментировал все обращени€ к критической секции. ¬сЄ равно работает 
			:) ¬идимо, внутри вида многопоточности нет :)))</P>
		<P>19:27 <EM>ќтвлекс€ на фотографии, обед, —лаву... ј там вы€снилось, что мало того что 
				корпуса в компах не те - так и процессоры тоже не те! » двух гигов ни в одном 
				нет... ¬ итоге от рабочего настроени€ ничего не осталось - только злость, 
				упадок сил и матерные слова на душе... Ќадо попытатьс€ и вспоминть, о чем же 
				(хорошем...) думалось вечером-утром... “ам были какие-то варианты, картинки, 
				графы, можно сказать...</EM></P>
		<P>1) (»з вчерашнего 17:56) - канальные буфера вида нужно иметь на полную 
			длительность окна - дл€ возможности полной перерисоки без потери данных<BR>
			2) "нормальный" (текущий) режим:&nbsp;I&nbsp;receive the Data&nbsp;(PostMessage 
			from MainFrame), fill ChanBuffers (with re-referencing and IIR-filtering) - and 
			plot received portion of data onto memory Bitmap. But which step will be the 
			next one? What should I do by CActDView timer message? There seems to be two 
			possibilities:<BR>
			2.1. Call RedrawWindow() - or post (send??) WM_PAINT message<BR>
			2.1. I can try to re-plot new portion of window by myself (without WM_PAINT)</P>
		<P>-------------------------------------------------------------------------------------------</P>
		<P><STRONG>050319 сб</STRONG></P>
		<P>ƒома - таки нашел откомплированные тесты на Direct3D. ћнение о "не пойдЄт" 
			подтверждено: на "не том" устройстве даже в самом директовом устройстве получаю 
			4-5 FPS , а это - ни в какие ворота....</P>
		<P>ѕроект вроде как синхронизиован с домашним компьютером.</P>
		<P>---------------------------------------------------------------------------------------------</P>
		<P><STRONG>050320 вс</STRONG></P>
		<P>ќдин из основных вопросов - размер "графического буфера". я преследую две 
			задачи:<BR>
			1.  аждое очередное "рисование" (по полученному большому куску данных) должно 
			быть цельным - не перехлестывать через конец-начало<BR>
			2. ѕо возможности хотелось бы избежать и "перерисовки" еще неотображенных 
			данных (хот€ это и не фатально - если местами и будет отображатьс€ "не совсем 
			то")</P>
		<P>ќпредел€ть его совсем статитчески, раз и навсегда - наверное, не совем 
			правильно. ѕри необходимости можно и "перераспределить" - но заниматьс€ этим 
			каждый раз тоже не хотелось бы... “огда так: при первом вхождении выдел€ть 
			пам€ть с некоторым запасом (20-30-50%), в дальнейшем перераспредел€ть при 
			нехватке.</P>
		<P>¬опрос с "простотой отображени€": наиболее простым представл€етс€ вариант одного 
			циклического буфера. Ќо даже в нЄм € получу "точку под вопросом" - вводимые 
			данные имеют переменную длину, совсем необ€зательно кратную выводу. Ќамного ли 
			увеличаст€ мои затраты, если € буду держать не один кольцевой, а 2-3-4 "сменных 
			буфера"?</P>
		<P> акую информацию в таком случае € захочу иметь об этих буферах?</P>
		<P>---------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050321 пн</STRONG></P>
		<P><EM>—нова день суеты: в дополнение к п€тничным проблемам с компами добавилс€ и 
				потекший водогрей... ѕроверить микроволновку, слить воду... ≈сли что-то и писал 
				- то только сюда, в "размышлени€" - но было утер€но при перезагрузке компа, в 
				очередной раз приключившейс€ при попытке что-то воткнуть во frontal&nbsp;USB... 
				Ёто "что-то" было от Ќ— - они заходили вместе с √алей...</EM></P>
		<P><EM>¬ечером выбиралс€ поснимать на мост лейтенанта Ўмидта</EM>.</P>
		<P>-----------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050322 вт</STRONG></P>
		<P><EM>”тром отправил на сайт свиристель. Ќа многое не расчитывал - но получилось 
				совсем мало: три с половиной часа спуст€ всего 1-0-1 рек и один комментарий... 
				Ћадно, не суть</EM></P>
		<P>  делу: при планируемой отрисовке непон€тно, что делать с нулЄм. ¬ скролл-режиме 
			этот вопрос как бы и не стоит (там ноль считаетс€ по кнопке). ј в осц? я (вроде 
			бы) принимал за ноль первую точку окна - а сейчас-то € даже не знаю, кака€ 
			точка будет первой...</P>
		<P>Ќо подожди... ¬ осц-режиме € ћќ√” узнать, кака€ точка будет первой в окне. я 
			только не узнаю, в какой граф-скан (и какое его место) она попадЄт... –азмер же 
			окна €вл€етс€ фиксированным ¬ —≈ ”Ќƒј’ - то есть € ещЄ и гарантированно не 
			получу разрыв "где-то между точками". Ќо тогда получаетс€, что в осц-режиме € и 
			полилайны должен строить уже с огл€дкой на выходное окно... »нтерполиру€ 
			последнюю линию, счита€ последнюю точку (в окно уже не попадающую) по —“ј–ќћ” 
			нулю - и начина€ новое с Ќќ¬ќ√ќ нул€...</P>
		<P>15:13 - все еще читаю свой код, голова никака€... ѕереименовал функцию OnPlot в 
			Plot - чтобы не путать с OnPaint. «алез в неЄ: а если попытатьс€ объединить 
			подсчет референтного канала и перекладывание отображаемых в одном цикле 
			(перебираю все введенные каналы, если есть в рефмаске - добавл€ю к рефбуферу, 
			если есть в прочих - перекладываю). “огда реферирование будет делатьс€ отдельно 
			- уже перебором отображаемых каналов. Ёто избавит от дво€кого подхода к 
			итераторам каналов введенных.</P>
		<P>------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050326 сб</STRONG></P>
		<P>ќп€ть вс€ недел€ - в никуда. ‘отографии, "доклад" (вроде бы и без подготовки - а 
			всЄ равно и среда ушла, и четверг вместе с ней). ¬ субботу попробовал чем-то 
			зан€тьс€ - но оп€ть не обнаружил головы на месте, в итогде готовил к 
			архивации-записи отсн€тое...</P>
		<P>---------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050328 пн</STRONG></P>
		<P>¬ очередной раз возвращаюсь к дилемме: мне не хочетс€ заводить в виде буфер под 
			¬—≈ возможные каналы (а дл€ бипол€ров это и невозможно) - но в то же самое 
			врем€ хотелось бы сохранить "преемственность" (при включении/выключении одного 
			канала отображение старых остаетс€).</P>
		<P>»ли же... ѕлюнуть на это дело и каждый раз - заново??? Ќаверное, и в этом есть 
			смысл... “огда получитс€ так...</P>
		<P>15:56 - переделал выделение буферов. <FONT color="#000099">Ќо под Ref полна€ длина 
				не нужна!!!</FONT></P>
		<P><FONT color="#000000">---------------</FONT><FONT color="#000000">-------------------------------------------------------------------------------------------</FONT></P>
		<P><STRONG>050329 вт</STRONG></P>
		<P>несмотр€ на общую суету (ќ¬ ищет свою установку, ЋЅ задает вопросы - ну и 
			“ермекс впридачу), вз€лс€ за программу. Ќе с первого раза, но удалось (в 
			очередной раз) довести до рабочего состо€ни€ - с новыми буферами...</P>
		<P>16:59 - вновь заработало... Ќу а если мне (дл€ начала хот€ бы) отказатьс€ от 
			сохранени€ больших буферов - и "держать в голве" только то, что приходит??? — 
			одной стороны, € при этом лишусь возможности перерисовать все окно... ѕопробую 
			пока пережить... “огда выделение буферов должно происходить там же, где и 
			референтного - в Plot()</P>
		<P>20:52 - уже образован новый класс _GrBitmap, заложены его основные переменные и 
			образец конструктора... Ќо еще совсем не решено, как это должно выгл€деть по 
			большому счету...<BR>
			- € работаю не с отдельным битмэпом - со списком<BR>
			- Ќачало: перебрать список и найти первый "свободный" битмэп (флаг фрии = 1)<BR>
			&nbsp;&nbsp; - не найден - создаем новый, длиной на 20% больше требуемого 
			размера<BR>
			&nbsp;&nbsp; - найден - смотрим на размер,
			<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - если не подходит - удал€ем, создаем новый на 
			20% больше требуемого размера (длины)<BR>
			- получаем "рабочий" битмэп.<BR>
			- рисуем в нЄм....</P>
		<P>ѕервый же возникающий вопрос - что означает "перебрать список"? ѕо уму, это 
			должно как-то касатьс€ итераторов....</P>
		<P>¬торой вопрос - делать ли мне список моих битмэпов - или же наследовать свой 
			класс от списка с добавлением в него битмэповской функциональности. »ли же - 
			наследовать от битмэпа? (”ж наверн€ка в WTL что-то подобное есть?)</P>
		<P>--------------------------------------------------------------------------</P>
		<P><STRONG>050330 ср - </STRONG>
		</P>
		<P><STRONG>11:00 - дома</STRONG></P>
		<P>¬ечером (то ли по дороге домой, то ли уже дома) осознал, что € уже не помню даже 
			«ј„≈ћ были зате€ны эти последние изменени€ - когда, вроде бы, и без того 
			более-менее работало... — трудом, но вспомнил: из-за невозможности правильной 
			отрисовки при высоой частоте вывода на экран - и сильной децимации (т.е. когда 
			итогова€ частота ввода 128 √ц, а частота вывода - около 50 √ц; € при этом 
			получаю около 2.5 точек на вывод). ƒома попыталс€ посмотреть книжки - грустно. 
			¬сЄ нужно было делать по-другому: контейнеры, итераторы... “огда было бы 
			красиво...</P>
		<P>Ќуждаетс€ в сильной переделке и работа с отображаемыми каналами: сейчас € 
			перебираю отдельные карты (отображаемых, референтных) - и совсем не занимаюсь 
			бипол€рами (потому что не знаю, что с ними делать). ¬идимо, нужно при запуске 
			(и каждом изменении карты/списка бп) строить какую-то карту "отображени€" всех 
			вводимых каналов: с признаками референтности, отображаемости (и номер), 
			бипол€рности (с плюсом или минусом - и тоже номер) - а при получении совершать 
			однократный проход по этой карте. “огда в итоге у мен€ исчезнет разница между 
			моно- и бипол€рными каналами - уже на этапе IIR-фильтрации и отображени€ € буду 
			работать с единым массивом.
		</P>
		<P>ѕо поводу списка битмэпов: мне Ќ≈ нужно производить перебор всех, чтобы 
			определить, нет ли свободного. ≈сли свободный есть - то это следующий за 
			текущим. ≈сли следующий еще зан€т, то свободного нет. ¬опрос: сразу ли мне 
			зацикливать (например, создава€ первый узел со ссылкой на себ€ самого) - или 
			держать признаки конца и начала дл€ перехода? » хорошо бы какие-то функции 
			"встроить" напр€мую в этот контейнер: чтобы сам он поставл€л нужный битмэп дл€ 
			рисовани€ - и, по возможности, сам из себ€ выдавал нужные фрагменты дл€ 
			отображени€.<BR>
			ѕоследний вариант - снова дво€ко: либо заводитс€ еще один (промежуточный) 
			битмэп на случай, если запрошеннй фрагмент попадает на стык. Ћибо "выдаватьс€" 
			может больше одного фрагмента... ƒумаем... јга: контейнеру в качестве входа 
			будет даватьс€ битмэп "куда" (pDst), и временн<STRONG><EM>ы</EM></STRONG>е 
			координаты желаемого участка. » тогда контейнер (список) действительно —јћ 
			поместит изображение в pDST - независимо от того, оказалось ли оно цельным 
			куском - или было разорвано между разными узлами.</P>
		<P>21:07 - "рабочий" день началс€ с побежки к “ј. ѕотом всЄ-таки вз€лс€ за работу - 
			дополнил несколькими функци€ми класс _GrBitmap, ввел ссылку на него в 
			CActDView. „тобы проверить хот€ бы элементарную (основную) работоспособность, 
			нужно что-то работоспособное написать. Ќачал потихоньку переность рисовательные 
			функции из OnPaint в Plot... Ќо тут позвонила √ал€ - проблема с принтером. ¬ 
			итоге врем€ с трех и до семи на это и ушло - но хоть пообщались....
		</P>
		<P>“аким образом, только к дев€ти какой-то перенос функций осуществлен - но до 
			работоспособности еще очень далеко: пока сплошные вылеты и ничего кроме...</P>
		<P>---------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050331 чт</STRONG></P>
		<P>12:05<BR>
			ѕричины вылетов отслеживал долго: на работе, дома вечером и утром, снова на 
			работе... ќказалось, дело в вызываемой (автоматом) ф-ии OnSize - а там в 
			удалении битмэпа, который не был правильно инициализирован нулЄм.</P>
		<P>13:52<BR>
			ќграниченной работоспособности добилс€. ¬ылетаю внутри Plot()&nbsp; - и именно 
			где-то в рисовании.... Ѕум ловить.</P>
		<P>14:24<BR>
			”гу. я похоже что запуталс€ - какую размерность у мен€ имеет m_pChanBuf... ≈ще 
			один повод дл€ того, чтобы и такие массивы "классифицировать"....<BR>
			14:35<BR>
			ƒа, "подстановка" правильного значени€ (m_nMaxCnt) от вылетов избавила&nbsp;- 
			вроде как и работает... “олько вот не рисует - но это потому, что никакого 
			рисовани€ и нет :)))</P>
		<P>14:44 -  ак-то работает - но ведь € еще даже не объ€вил образованный битмэп 
			зан€тым! Ѕолее того, следов вызова деструктора тоже не наблюдаетс€....</P>
		<P>15:01  акого.. у мен€ при delete m_pBmp; не вызываетс€ деструктор????</P>
		<P>18:23 после выхода в город с этим разобралс€: удаление вызывалось из деструктора 
			вида - и было описано в h-файле, в котором класс _GrBitmap был только объ€влен, 
			но неопределен (не был включен соотв. заголовок). ¬от деструктор и не 
			вызывалс€.... ѕосле переноса тела деструктора в спп-файл деструктор вызываетс€ 
			- но (довольно логично) вызывает переполнение стека: единственный битмэп у мен€ 
			ссылаетс€ сам на себ€... Ќадо думать, как разв€зать этот узел...</P>
		<P>19:21 - частично добилс€: временна€ переменна€, отказ от рекурсии, если pNext == 
			this. Ќо € еще не выставл€л флаг "зан€то" - то есть работал с единственным 
			битмэпом... –искуем:</P>
		<P>19:24 - ¬вел флаг зан€тости (освобождени€ пока нет - как нет и отображени€, в 
			ходе которого освобождение должно получатс€). Ќовые битмэпы образуютс€ без 
			фатальных последствий, удаление тоже идет как запланировано - за исключением 
			последнего: здесь € все-таки&nbsp; в какое-то подобие рекурсии впадаю....</P>
		<P>19:27 - и это решено: в качестве флага "валидности" бмп использую его указатель 
			m_pNext: если он нулевой, то удал€ть этот битмэп уже не надо... ¬ таком виде 
			работает (то есть битмэпы выдел€ютс€ - и уничтожаютс€ без видимых утечек 
			пам€ти.)<BR>
			Ќаступает врем€ думать об отображении и сопутствующих ему флагах....</P>
		<P>20:14 - задумалс€ о том, каким таймером € буду пользоватьс€. Ќаверное, 
			мультимедийным - решил... Ќо такое впечателение, что мультимедийный у мен€ 
			используетс€ только в "медленном&nbsp; режиме"... Ќќ! ¬печатление оказалось 
			обманчивым - у мен€ же написана собственна€ функци€ SetTimer!!! ј она описывает 
			уже "заправку" мультимедийного...<BR>
			&nbsp;&nbsp; Ќо вопросы на этом только начинаютс€. Ќапример: мультимедийному 
			таймеру на вход подаетс€ колбэк-процедура. Ќу а если подавать оную - то ее 
			нужно будет и завести :))) » очень интересно знать, в каком контексте она будет 
			выполн€тьс€... ¬едь у мен€ должны быть <EM><U>раздельные</U></EM> таймеры и 
			процедуры дл€ <EM><U>разных экземпл€ров</U></EM> моего вида...Ќу, положим что 
			ссылку на экземпл€р € как-то смогу этой ф-ии передать - но все равно вопрос: 
			как она будет вызыватсь€????</P>
		<P>21:51 ѕервые тесты показали, что этот таймер вызываетс€ неким глобальным потоком 
			- и, соответственно, вызываемые им ф-ии выполн€ютс€ в нем же - а не в 
			графическом потоке... «автра надо будет попробовать "обычный таймер"...</P>
		<P>-----------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050401 пт</STRONG></P>
		<P>”тренние тесты показали: мультимедийные таймеры идут в отдельном потоке - 
			отличном как от основного потока приложени€, так и от "граф." потока 
			конкретного окна. ¬идимо, это не то, что мне нужно: € хочу сохранить приоритет 
			за вводом (а отображение, тем более множественное, в том же потоке может это 
			дело затормозить). Ѕудем пытатьс€ "разрулить"...</P>
		<P>’отелось бы избежать использовани€ "обычного" таймера: хот€ бы потому, что в 
			этом случае (насколько € помню) невысок приоритет сообщени€ в очереди (хот€ кем 
			он регулируетс€???). ћожно пробовать пользовать мультимедийный - но сообщение 
			окну посылать/постить...</P>
		<P>14:02 - проходит даже "элементарный" вариант с SendMessage - сам таймер работает 
			в одном (своем) потоке, а сообщение обрабатываетс€ уже в "правильном" потоке 
			граф. окна. “олько получилс€ какой-то "затык" при выходе....</P>
		<P>14:37 - от вылета при закрытии окна "спасает" принудительное "убиение" таймера. 
			Ќо вопрос остаетс€: хорошо бы этот таймер убивать и при остановке ввода... 
			Ќо... Ќо делать это нужно не сразу - в принципе-то надо дожидатьс€ конца “о 
			есть какой-то признак конца должен содержатс€ в самой очереди передаваемых на 
			отрисовку картинок....</P>
		<P>15:45 ѕервые пробы рисовани€ вызывают уныние... ¬о-первых, ничего не получаетс€ 
			отрисовывать без WM_PAINT (и инвалидации нужного региона). ¬о-вторых, 
			битмэпчик-то у мен€ похоже что черно-белый получилс€... —начала разберемс€ с 
			цветами:</P>
		<P>15:55 јга, если битмэпу передовать не m_hMemDC, a m_hDC - то цвета получаютс€. 
			Ќо пока € что-то совсем не вижу "реальной отрисовки"...</P>
		<P>15:57 - тоже пон€тно: рисующий фрагмент был просто закомментирован. ѕосле сн€ти€ 
			комментов получаетс€ хорошо :) ƒумаем дальше.</P>
		<P>21:00 !!!!<BR>
			»ду по пути дальнейшего "делени€" рисовательных контекстов. “от, в котором 
			будет производитьс€ собственно рисование (во временных переключаемых битмэпах) 
			будет называтьс€ m_hTempDC. Ќазвание m_hMemDC будет закреплено за контекстом, 
			"напрочь" спа€нным с "посто€нным битмэпом" - то есть тем, который в каждый 
			текущий момент будет отображать "реальную" картинку на экране.</P>
		<P>-----------------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050402 сб</STRONG></P>
		<P>что-то оп€ть едва шевелюсь...<BR>
			»так, send от одного потока к другом проходит - но вопрос в организме остаетс€: 
			будет ли выполнение вызывающего потока приостановлено на врем€ работы 
			вызваемого? » как это проверить?</P>
		<P>ќтносительно же самого рисовани€: если вернутьс€ к идее о заполнении 
			результирующего битмэпа самим классом "списка динамических", то выгл€деть оно 
			должно так: определ€ем результирующий пр€моугольник, передаем его (вместе с 
			прочими необходиыми переменными) списку - а потом отзваниваем на экран именно 
			его...</P>
		<P>14:46<BR>
			ѕроверка установила: вызывающий поток тормозитс€.<BR>
			ѕопутные проблемы:<BR>
			- в некоторых случа€х при рисовании получаю undefined c - видимо, рисование с 
			нулевым к-м точек. Ќо не провер€л<BR>
			- недетерминированное поведение при закрытии вида. ¬ том числа - отлеты при 
			попытки определить IsWindow (вида уже нет, и его m_hWnd - тоже). Ќужно как-то 
			более правильно обнул€ть CMainFrame::m_pCurrentView/</P>
		<P>16:46 !!!!!!!!!!<BR>
			„астично разобралс€ с отлетами. ќсновна€ причина была €сна еще вчера - € не 
			останавливал таймер. Ѕолее детальный анализ показал, что основна€ 
			деинициализаци€ вида вообще производилась в OnClose - а эта ф-и€ вызывалась 
			лишь при клике на соотв. кнопке; таким образом при общем закрытии она участи€ 
			не принимала. ѕроблема решена переносом нужного кода в деструктор - но не 
			уверен, что таким образом решены все проблемы...<BR>
			(<EM>на этом месте решил провести перестановку - а то слишком часто забываю 
				выключать прибор. ѕри этом случайно выключил монитор - и чуть не... 
				¬ыключатель-то у него в очень незаметном месте :))) </EM>)</P>
		<P>16:55 - проверка nDisp &gt; 0 добавлена к CMainFrame::OnTimer - в место, где 
			сообщение посылаетс€ дочерним видам. “еперь из самого вида эту проверку можно и 
			убрать....</P>
		<P>-----------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050404 пн</STRONG></P>
		<P>19:20<BR>
			» все воскресенье провел в погоне за птичками, и понедельник по большей части 
			неизвестно куда делс€... ¬роде бы что-то делать и пыталс€ - но собственно "за 
			дело" прин€лс€ лишь в седьмом часу...</P>
		<P>ѕроблема в чем: у мен€ три единицы измерени€: отсчеты, миллисекунды и точки 
			(окна вывода), и отношени€ между ними не слишком простые (с учетом некратности 
			и ошибок округлени€). ј € хочу максимально упростить "механизм" передачи 
			изображени€ из временных битмэпов в "запоминающий". ¬ простой ситуации € еще 
			могу переложить практически всю работу на "временные битмэпы" - сказав им лишь 
			"куда" выводить и "сколько" миллисекунд нужно (хот€ ведь могу - и в точках???). 
			Ќо может возникнуть случай, когда очередна€ перерисовка не только перекроет два 
			временных битмэпа - но и попадет на границы запоминаемого (в осц-режиме). » что 
			тогда???</P>
		<P>20:05 -
			<BR>
			Ќачинаю с того, что еще более инкапсулирую работу с временными битмэпами в них 
			самих: там же будет хранитьс€ и контекст устройства. ƒл€ этого он сначала будет 
			создаватьс€. (ѕодозреваю, что копирвоание - не пройдет).<BR>
			20:17 _GrBitmap<BR>
			я не только создаю свой CDC, но и тут же выбираю в него m_hBmp. ѕеред 
			уничтожением - отмена выбора.</P>
		<P>20:23 ¬овнутрь засунута FillSolidRect<BR>
			20:44 ¬овнутрь засунуты Line, PolyLine, SetPixels (рисует не одну, а две 
			точки). ќставлена переменна€ CActDView::m_hTempDC - но только дл€ 
			CActDView::OnNcPaint() - дл€ отрисовки стрелочки...<BR>
		</P>
		<P>21:28 - получены первые признаки жизни. ћного внимани€ приходитс€ удел€ть тому, 
			передаютс€ ли собственно объекта (например, HPEN) - или же их WTLевские 
			обертки. — обертками получаетс€ плохо. ѕри передаче объектов одна отрисовка 
			проходит :)</P>
		<P>&nbsp;------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050405 вт</STRONG></P>
		<P>13:27 Ќа работу пришел в начале одиннадцатого, но за работу берусь только 
			сейчас...  ак и вчера, лазал по амазонам - птичьи книжки заказывал. «аходила 
			Ћида (после ночного дежурства), пообщались. ‘отосайт, оп€ть же... “ак вот врем€ 
			и уходит...</P>
		<P>»так, вчерашний вечер завершилс€ тем, что отрисовка происходит - но только один 
			раз. » где искать концы, не совсем пон€тно: накручено много. Ќо уже видна одна 
			существенна€ недоделка: мне недостаточно ќƒЌќ√ќ указател€ m_pBmp - нужно иметь 
			отдельные указатели дл€ записи (рисовани€) и чтени€ (отображени€). Ќе очень 
			пон€тно, как нужно обходитьс€ с контекстами устройств: иметь ли один на все 
			битмэпы - или создавать свой дл€ каждого. ќдин, вроде бы, чего-то должен 
			сэкономить - но тогда при каждой записи/чтении придес€ перевыбирать битмэпы...</P>
		<P>14:25<BR>
			ѕроблема оказалась вчерашн€€: нужно было таки передавать в копирующую ф-ию HDC, 
			а не CDC. ¬озможно, это св€зано с тем, что в "родителе" (виде) m_hDC определено 
			как HDC, а не как CDC... Ќо проблемы остаютс€:<BR>
			- по-прежнему встречаютс€ вызовы с нулевым к-м отсчетов<BR>
			- похоже, что все битмэпы, кроме первого, у мен€ получаютс€ черно-белыми...</P>
		<P>14:28<BR>
			- нулевое к-во отчетов порождаетс€ невалидным коэффициентом децимации 
			(-858993460) - теперь нужно пон€ть, откуда он беретс€.<BR>
			14:38 - ¬идимо, какое-то неверное число западает в CHardDlg::m_nDecIdx... 
			ƒобавил инициализаций и проверок - не знаю, поможет ли. ќтловить - не могу....<BR>
			14:43 –азница в битмэпах определ€лась разинцей в конструкторах: в 
			копи-конструкторе тоже нужно создавать битмэп, как совместимый с 
			–ќƒ»“≈Ћ№— »ћ!!! “еперь все - цветоное...</P>
		<P>16:08 ѕоискал взламывалки на adobe drm - ничего... ѕоиски плавно перешли в 
			беседу со —‘ на тему планов - огорчил ее... ¬ывод один: нужно продолжать...
			<BR>
			»так: рисование идет. “еперь нужно сделать, чтобы рисовалось то, что нужно :)</P>
		<P>17:47 Ѕорюсь с рваной и неровной отрисовкой. ѕока обедал, пришла в голову мысль 
			о возможном источнике: при обработке таймера € каждый раз определ€ю количество 
			точек, к-е нужно отрисовать со времени ѕ–ќЎЋќ√ќ прихода - и оно часто 
			оказываетс€ нулевым. ј € должен считать врем€, прошедшее от начала окна!!!</P>
		<P>19:20!!!!<BR>
			я неправильно расчитывал координаты при рисовании!!! Ѕрал в числителе - общую 
			ширину окна, а в знаменателе - число актуальных отсчетов. ѕереход на пару 
			"ширина отрисовки"/"полученные отсчеты" тоже мало помогает (числа маленькие и 
			нецелые). ѕосле применени€ пары "ширина окна"/"число отчетов на окно" 
			отображение идет нормально - насколько € могу судить... » битмэпа при этом 
			образуетс€ только два :))) !!!!</P>
		<P><FONT color="#000099">Ќо попытки децимации программа не переносит....</FONT></P>
		<P>ѕерекур - и думаем дальше....</P>
		<P>21:06 !!!!!!!!!!!!!!!<BR>
			ћен€ "зацепил" размер первого битмэпа - 63 отсчета, 1-2 точки... Ќу и всЄ 
			прочее на этом месте "циклило". ¬ычислить не мог долго, много отладочной печати 
			потребовалось. — ее-то помощью и было установлено: ƒќ вклчюени€ € каждый раз 
			абортировал драйвера (чтобы иметь возможность изменить режим). ј первый запуск 
			после включени€ ¬—≈√ƒј читает эти самые 63 точки!! —оответственно, дл€ решени€ 
			проблемы пришлось "забуферизовать" флаг запуска (в локальной переменной ф-ии 
			CMainFrame::OnTimer() ) - и ставить эту переменную в false в случае, если 
			драйвера переоткрывались...<BR>
			&nbsp;&nbsp;&nbsp; —амое интересное, что это (на первый взгл€д, по крайней 
			мере) решило и вопрос с "разорванным рисованием" - оно стало нормальным!!! Ќо 
			надо провер€ть дальше...</P>
		<P>ѕочему-то у мен€ при этом битмэп образовалс€ только один... „то непон€тно...<BR>
			<FONT color="#00cc00">ToDo - нарисовать правую границу в осц-режиме.</FONT></P>
		<P>21:21
			<BR>
			√раница нарисована.<BR>
			Ќет разрывов при основном таймере 800 и 400 мс (что с битмэпами - не провер€л). 
			ѕри 200 они по€вл€ютс€ - но вроде бы только на первом экране...&nbsp; Ќужны 
			дальнейшие проверки...<BR>
		</P>
		<P><FONT color="#000000">21:45
				<BR>
				ќпробованы варианты со скроллом. ѕо первым впечатлени€м - мерзко. (пробовал 
				скроллировать в пам€тьи - и выбрасывать чохом, 20 мс). ѕри меньшей частоте - 
				еще более мерзко. ¬роде бы более-менее - при 10-15 мс и пр€мом скроллировании 
				m_hDC... Ќо похоже, что это чревато нестабильностью системы - и совсем плохо с 
				множественными окнами..</FONT></P>
		<P>21:53 - да нет, вроде бы и через пам€ть все выгл€дит приемлимо (даже и на 10 мс) 
			- но только на CRT. ƒл€ LCD не подходит. <FONT color="#000099">ѕќпытка открыти€ 
				второго окна вешает программу насмреть....<BR>
			</FONT><FONT color="#000000">так что даже зашатдаунюсь....</FONT></P>
		<P>--------------------------------------------------------------------------------------</P>
		<P><STRONG>050406 ср</STRONG></P>
		<P>Ќа работу пришел в полодиннадцатого - но вместо программы зан€лс€ шопом: правлю 
			скворца... ќтвлекс€ на кофе - а тут ЌЌЅ с брюлевскими проблемами... ѕ€ть минут 
			такого разговора - и день потер€н :((( ƒа и с шопом тоже - то цвета не 
			нрав€тс€, то рамка... —делаешь - потом переделываешь... »зредка загл€дыва€ в 
			то, что происходит с программой</P>
		<P>13:52<BR>
			ѕервое, что беспокоит - поведение при ресайзе. ƒебаг ничего не дает (получаетс€ 
			инвалидное окно-получатель, не более того). Ќа самом деле все пон€тно: у мен€ 
			при ресайще удал€ютс€ временные битмэпы - а в это врем€ может происходить 
			запись в них. ѕопробуем обрамить критическими секци€ми.</P>
		<P>14:32<BR>
			Ќесмотр€ на крит. секции вылеты продолжились - € не обнул€л m_pReadBmp - и не 
			провер€л ее на равенство нулю при отрисовке.</P>
		<P>15:22<BR>
			Ќет, все-таки при 200 мс опросе неполадки с отображением есть - какие-то 
			полоски рисуютс€... » это - в однооконном режиме. „то же происходит в 
			многооконном - € вообще пока пон€ть не могу :((( “о ли он их отображает 
			"вперемешку" - то ли вообще по очереди...</P>
		<P>15:44<BR>
			ѕытаюсь перейти на WM_TIMER - пока что-то не получаетс€....<BR>
			16:14 (после обеда) "нерабочесть" WM_TIMER объ€сн€лась тем, что € в пор€дке 
			теста обнул€л (int*)(lParam) - а там при нормальном сообщении содержалось 
			что-то осмысленное... “еперь сообщение проходит - но рисовать нормлаьнее прога 
			не стала...</P>
		<P>16:46 –ешил поборотьс€ с остановкой: путем посылки сообщени€ о "нулевом" 
			рисовании и выставлении при оном _GrBitmap::m_pNext = 0. ѕолучилось не сразу: у 
			мен€ SetNext(0) ставила значение this. ѕосле попраки работает - но повторный 
			запуск уже не проходит....   тому же пон€тно: € при этом тер€ю цепочку....</P>
		<P>16:55 - сменил на обнуление размера. ¬ таком виде проходит и рестарт - только 
			самое начало получаетс€ "совсем не то". — двум€ окнами - все равно полна€ 
			лажа..</P>
		<P>---------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050407 чт</STRONG></P>
		<P>“ак весь вчерашний вечер с этими проблемами и прома€лс€... ≈динственное, что 
			стало очевидно - что BitBlt отображает пр€моугольник, Ќ≈ включающий правую 
			границу, то есть все расчеты нужно делать исход€ из этого. Ѕагов же...<BR>
			- после добавлени€/удалени€ каналов получаетс€ "полосатость" отображени€<BR>
			- аналогично - после ресайза (но не после max/restore window)<BR>
			- после подобных изменений возникают "молчаливые участки" - похоже на попытку 
			вывода за пределами окна<BR>
			- можно отображать и два (и больше) окон - но только пока в них разные каналы<BR>
			- очевидно неверна скорость при скролл-выводе</P>
		<P>¬ечером (по дороге домой и перед сном) посетили мысли. “очно помню, что их было 
			три - но вот какие... ¬роде бы так:<BR>
			- ¬о-первых, сбои при выводе в несколько окон объ€сн€ютс€ тем, что разные 
			отображени€ пользуютс€ одним "входным итератором" - а дл€ каждого вывода нужен 
			свой собственный!!!  ак????<BR>
			- ¬о-вторых, дл€ "разборок" мне об€зательно нужно выводить на экран секундные 
			метки. ѕроще всего ставить их уже в m_hMemDC - но это €вно не то, что мне нужно 
			дл€ отладки. ј вот как выводить эти метки во "временные битмэпы"...<BR>
			- "полосатость отображени€" при смене числа каналов €вно закладываетс€ на этапе 
			отрисовки битмэпа - но непон€тно, каким образом...</P>
		<P>11:57 Ќачну, пожалуй, с обдумывани€ вопроса о секундных метках...</P>
		<P>12:53 јлгоритм отрисовки секунд во временных битмэпах придуман - и он довольно 
			прост... Ќо рисуетс€ не кажда€ секунда... “о ли у мен€ могут встречатсь€ 
			битмэпы, перекрывающие сразу две (???), то ли € "накрываю" при собственно 
			выводе - не€сно...<BR>
			12:56 јдаптировано дл€ случа€ многих секунд - все равно получаетс€ "не каждый 
			раз". ¬ыходит, перекрываю....<BR>
			13:00 !!! «амечательно. ќдин из вопросов с "минус единицей разрешилс€" - теперь 
			кажда€ секунда отрисовываетс€... Ќо: у мен€ получилось, что окно оказываетс€ 
			длинее заданного (то есть выводитс€, скажем, больше 8 с). ѕричем через какое-то 
			врем€ эта разница исчезает - и дальше уже попадает "секунда в секунду"...  ак 
			бы это могло быть? ќчень похоже на ошибки округлени€ - которые через какое-то 
			врем€ исчерпываютс€...</P>
		<P>13:40<BR>
			¬ CMainFrame введена нова€ ф-и€ - void Stop(), в которую сведены необходимые 
			при остановке действи€. ¬ызваетс€ она как по кнопке - так и в случае "отлЄта" 
			программы (при выключении питани€ и т.п.), обеспечивает остановку графических 
			таймеров.<BR>
		</P>
		<P>ѕопутно вы€сноилось, что сейчас у мен€ стало резко нехорошо с "рисованием за 
			пределами окна" - после пары проходов курсор пропадает, и € нахожусь неизвестно 
			где... »нтересно, это - следствие домножени€ времЄн на 10???</P>
		<P>14:05<BR>
			я кое-что пон€л!!! "ошибки округлени€" и выода св€заны с разрывом между 
			вызовами: ведь между последней точкой первого полученного буфера и первой 
			точкой второго лежит одна дискрета - и эта лини€ должна отображатьс€!!! » она 
			занимает на графике какое-то, пусть близкое к нулю - но ненулевое рассто€ние в 
			окне. —оответственно, ошибок тем больше, чем меньше дискрета отрисовки - а с 
			увеличением дискреты у мен€ и в самом деле все становитс€ лучше.<BR>
			&nbsp;&nbsp; я уже думал об этом: об€зательно нужно запоминать последнюю точку 
			каждого буфера - и учитывать ее при отрисовке следующего. Ќо при этом сама 
			точка отображатьс€ как бы и не должна... »ли же - не должна отображатьс€ 
			последн€€ точка... ¬ общем, ой... », видимо, все это нужно каким-то образом 
			состыковывать с "входным массивом" - и, соответственно, теми самыми 
			"индивидуальными итераторами"....</P>
		<P>14:33<BR>
			—обственно, € имею проблему циклического буфера (_ChanW) с единственным 
			доступом по записи - и множественным доступом по чтению. ƒоступ по чтению может 
			устанавливатьс€ в двух случа€х:
			<BR>
			- при запуске ввода (дл€ всех открытых окон) и
			<BR>
			- при открытии нового окна во врем€ ввода<BR>
			ѕолучаетс€, что дл€ каждого доступающего по чтению окна € должен иметь свой 
			комплект указателей и счетчиков - плюс глобальный комплект (учитывающий, что 
			канал прочитан ¬—≈ћ» окнами, которые его хот€т читать)</P>
		<P>ƒаже еще сложнее: ведь один буфер - это один канал, а "существование" канала в 
			конкретном окне может мен€тьс€ динамически (то отображаем, то не отображаем). 
			ѕри этом "неотображаемость" канала не должна вызывать иллюзии зан€тости - а 
			включение "отображаемости" должно приводить к тому, что канал начнет читать не 
			с любой точки - а именно с той, котора€ нужна (синхронной с другими каналами)</P>
		<P>Ћадно, о "детальной" (поточечной) синхронизации € могу не думать - но по крайней 
			мере на уровне "одной получки" € ее обеспечить должќн!. ѕри этом вариант 
			"одного счетчика" тоже не устраивает - именно потому, что у каналов может быть 
			разна€ децимаци€ (как было сказано выше, сейчас - только у обычных и триггера). 
			—ледовательно, мы волей-неволей возвращаемс€ к идее dWEn-dUEn - обеспечени€ 
			"групп каналов". Ќо и при этом без "индивидуальных" счетчиков не обойтись...</P>
		<P>ќбщий итог: иде€ "глобализации" счетчиков в данном случае была плоха. Ќо в то же 
			врем€ - что-то глобальное нужно: чтобы отслеживать зан€тость буфера и его 
			"общетекущую" точку....</P>
		<P>15:50<BR>
			“огда так: пон€ти€ "зан€т-свободен" ввод€тс€ ѕќЅЋќ„Ќќ. ѕри очередном заполнении 
			 ј∆ƒџ… канал запоминает место, с которого заполн€лс€ - и место ƒќ ”ƒј. 
			—ообщение отправл€етс€ ¬—≈ћ ¬»ƒјћ. Ќо - у мен€, собственно, нет специального 
			метода, чтобы запоминть "начало заполнени€". я могу зафиксировать лишь момент 
			"готовности к посылке" - и именно его считать "состо€нием буфера", которое 
			будет передаватьс€ (а оно, собственно, включает в себ€ начало-конец, из которых 
			и длина может быть посчитана). ѕризнака "свободности" € при этом получить, увы, 
			не смогу....</P>
		<P>17:18<BR>
			—лишком запутано всЄ... ѕока завЄл лишь самую элементарную ф-ию 
			_ChanW::ResetRW() - просто устанавливающую указатель чтени€ на указатель 
			записи. Ќо здесь нет ни контрол€ переполнени€/опустошени€ - ни даже самой 
			элементарной защиты от одновременного доступа :(((</P>
		<P>19:00<BR>
			 ак вы€снилось, цела€ куча проблем была вызвана сегодн€ же введенной ф-ией 
			CMainFrame::Stop(). ј именно, € в ней не убивал таймер, что в итоге (правда, 
			непон€тно почему) приводило к вызову основного таймера с очень коротким 
			периодом - а это, как мы уже вы€снили, сказыываетс€ на всем крайне негативно. 
			ѕосле правильных разборок с таймером стало чуть легче.</P>
		<P>19:44<BR>
			јналогичным образом решены вопросы с изменением размера: тоже нужно было не 
			только делать все в критической секции - но и убивать таймер (с тем, чтобы 
			восстанавливалс€ он уже из ф-ии Plot() )<BR>
			&nbsp; —обственно, поведение при изменении длительности вывода (отрабатываемое 
			через SetFrq() ) исправлено тоже вводом посылки себе сообщени€ WM_SIZE<BR>
			&nbsp; “аким образом, стало самую капельку - но легче. Ќо не совсем легко: 
			проблемы с выводом остаютс€. ¬ частности, временами (увы, далеко не каждый раз) 
			при достижении границы окна битмэп заполн€етс€ одинаковыми 
			фрагментами&nbsp;чего-то, после ресайза возникают неопределенности с выводом 
			секундных маркеров...</P>
		<P>---------------------------------------------------------------------</P>
		<P><STRONG>050408</STRONG></P>
		<P>√лавные вопросы на сегодн€шний день:<BR>
			<FONT color="#000099">- откуда берутс€ перекосы после ресайза<BR>
				- откуда берутс€ "лишние точки" после добавлени€/удалени€ каналов<BR>
				- как поступать с граничными точками вывода (отрисовка линии от последней точки 
				пред. до первой нового)</FONT></P>
		<P>.17:17<BR>
			“ак ничего и не пон€л. ѕопытка проверить на изменение размеров (сравниваю 
			размеры битмэпа и текущие размеры окна) ничего не про€снила: разница не 
			обнаружена....</P>
		<P>20:43<BR>
			Ќу вот, весь день прошел - и ничего не сделано...<BR>
			 акие-то мысли мелькали, пока ходил платить за интернет: нужно сделать так, 
			чтобы на рисование отправл€лось на одну точку больше, чем получено: добавл€ть в 
			начало предыдущую точку (дл€ первого запуска - просто дублировать нулевую). ѕри 
			этом в отображение эту точку не включать - только считать линию от неЄ (если 
			такова€ лини€ имеетс€).<BR>
			&nbsp; Ќо полным спасением это не станет: вполне реальна ситуаци€, когда на 
			каждый пиксел вывода придетс€ каких-нибудь 5.5 точек ввода. » тогда, получив 
			эту "первую" точку в очередном выводе, € должен буду знать - €вл€етс€ ли она 
			первой в новом пикселе - или четвертой в старом... ј этого € никак не узнаю, 
			если не буду напр€мую в Plot() отслеживать точко-пиксельное соответствие - 
			базиру€сь на окне. —оответственно, нужен еще один счетчик (подобный тому, каким 
			€ считаю секунды) - точно отсчитывающий необходимое количество отсчетов на 
			окно. “огда и расчеты станут более "правильными" - и можно будет попытатьс€ 
			решить проблему с нулЄм при осц-выводе.</P>
		<P>--------------------------------------------------------------------</P>
		<P><STRONG>050409 сб</STRONG></P>
		<P>Ќичего не придумал - но продолжал размышл€ть и по дороге домой:<BR>
			&nbsp; ѕо всему выходит, что мне дл€ очередного вывода (заполнени€ битмэпа) 
			может понадобитьс€ предыдуща€ вертикаль (но может и не понадобитьс€). ќтсюда 
			вытекает тот не слишком при€тный факт, что все колупани€ последних двух недель 
			(собственный битмэп на каждый вывод) шли не туда: в таком варианте предыдущую 
			точку можно получить лишь со значительными затратами.<BR>
			&nbsp; Ќа смену приходит вариант с буферизацией всего графического окна: причем 
			имеетс€ как минимум две копии: в одну рисуетс€, по графическому же таймеру эта 
			(перва€) копи€ частично переноситс€ во вторую (отображаемую). ¬тора€, 
			собственно, €вл€етс€ полной копией экрана.<BR>
			&nbsp; ¬озикает вопрос: хватит ли мне двух копий?  акие могут возникнуть 
			проблемы при при переходе за границы окна?  ак это будет выгл€деть при 
			скролл-отображении???</P>
		<P>-------------------------------------------------------------------</P>
		<P>050411 пн</P>
		<P>≈ще немножко подумал вечером: нет, такой вариант чреват.  ак и любой другой 
			"фиксированный", он рискует наскочить на несоблюдение заложенных условий (а что 
			будет при 1/4-секундном окне? ј что будет, если вывод еще подзадержитс€?). 
			Ergo, мне судьба вернутьс€ к (слава богу) еще не аннулированному варианту 
			временных битмэпов - но с его дальнейшим усложнением (расчет точек по размерам 
			окна, перенос последней колонки).</P>
		<P>≈ще одна шальна€ субботн€€ мысль: вообще-то у мен€ все проблемы растут из 
			некратности ввода и вывода - то есть из того факта, что € получаю практически 
			ЋёЅќ≈ количество точек. ј если это дело ограничить? “о есть: даже получа€ 
			больше, выводить всегода полсекнунды? Ќадо посмотреть, какие кол-ва € 
			получаю....</P>
		<P>11:40 ѕопробовал. Ќет, этот вариант (с фиксацией к-ва получаемых точек) не 
			пройдЄт: при частоте 2048 и времени 500 мс € получаю чаще всего 1016 точек (на 
			8 меньше), иногда - 1080, а при первом приеме - так и вообще 953...</P>
		<P>12:39<BR>
			ƒумал, что вообще уже того... ѕри каждой остановке - полный отлЄт, и концов не 
			найти... ќказалось - все просто: € перешел (в п€тницу, ближе к вечеру, в 
			истории не отражено) на задание размеров битмэпа с указанием пр€моугольника 
			родительского окна - а при остановке ввода эта ф-и€ вызывалась с двум€ нул€ми. 
			¬от € и пыталс€ получить размеры пр€моугольника, адрес которого равн€лс€ 
			нулю....  ак вредно прерыватьс€ хоть на что-либо...</P>
		<P>јнализ "кратностей вывода" показал: чаще всего добавка будет равна 1, и примерно 
			с одинаковой частотой - 2 и 0. Ќе могу пон€ть, будет ли это фатально.... » 
			нужно ли вообще думать на тему: насколько серьезно будет улучшение? ѕри 
			произвольном кол-ве точек в окне (оно может быть и простым числом!) и широких 
			рамках его временных границ - не факт...</P>
		<P>13:01<BR>
			 ак ни крути, начинать нужно с главного: канальный буфер должен мне возвращать 
			на одну точку больше (включа€ предыдущую или - дл€ самого первого раза - дубль 
			первой точки). “ак что начать мне нужно с того, что определить, чем "самый 
			первый раз" отличаетс€ от всех остальных.</P>
		<P>–ечь идет об элементах списка CMainFrame::m_arChanW. ‘ормируетс€ список в 
			OnMapChanged() (наверное, можно было бы и по старту - но сейчас мен€ть не 
			буду). ѕри запуске ввода в OnRunGo дл€ каждого элемента выполн€етс€ команда 
			SetBuff() - так что она и может быть тем местом, где возможна пометка 
			первого/непервого раза...<BR>
			&nbsp; ѕосле этого данные в буфер кладутс€ по таймеру - командой Put(). ѕри 
			этом при каждом тике выполн€етс€&nbsp;ResetRW() -&nbsp;устанавливающа€ 
			указатель чтени€ на указатель записи (кстати, потенциально опасна€ команда!). 
			ѕохоже, что это место € €вл€етс€ дл€ мен€ самым интересным: € могу установить 
			указатель чтени€ ѕќ«јƒ» указател€ записи. Ќу а так как это - сравнительно 
			редка€ процедура - то и&nbsp;доп. проверка на границу буфера&nbsp;не окажетс€ 
			сильно затратной.<BR>
			&nbsp; ћинус в том, что всЄ это происходит ƒќ положени€ первого числа в буфер - 
			то есть в случае "самого первого раза" € еще не могу ничего положить в 
			"предпервую точку"....</P>
		<P>14:34<BR>
			–ешил разделить&nbsp;"синхронизацию указателей" на две части: перед началом 
			записи очередных данных&nbsp;текуща€ позици€ указател€ записи (откуда и нужно 
			будет начинать чтение) запоминаетс€ в переменной m_dwWposOld, а синхнонизаци€ 
			(присваиваение указателю чтени€ значени€, на единицу меньшего, чем это) 
			произоводитс€ уже после записи. ѕри этом&nbsp;у мен€ по€вл€етс€ возможность 
			однократно проанализировать флаг "первого раза" - и&nbsp;дл€&nbsp;этого случа€ 
			скопировать уже имеющеес€ первое значение.<BR>
			&nbsp; —начала хотел даже производить второй этап синхронизации в 
			CActDView::Plot&nbsp;- но там € работаю уже с локальными копи€ми итераторов, а 
			флаг (об€зательно!!!) нужно мен€ть глобальный!!!&nbsp;&nbsp;<BR>
			14:58 -&nbsp;проверил, после небольшой корректировки (нельз€ делать без флага 
			m_bRun - буфера неопределены) вылетов нет...</P>
		<P>15:35<BR>
			ѕерехожу к отображению. «авел переменную CActDView::m_nWinFrameCnt - а теперь 
			думаю, что же с ней делать...<BR>
			- во-первых, определ€ть "нулевой отсчет" (дл€ вычислени€ нул€ при осц-выводе)<BR>
			- во-вторых, похоже что лучше будет при достижении границ разбивать на два 
			битмэпа (ситуацию с перекрытием избегать)<BR>
		</P>
		<P>19:23<BR>
			 ак-то очень долго и муторно определ€л начальную точку дл€ отсчета нул€... 
			¬роде получилось. ѕерехожу к раздумь€м о координатах.</P>
		<P>19:34<BR>
			_GrBitmap::Resize() перенесена вовнуть _GrBitmap::GetFree(), туда же добавлено 
			копирование первой колонки (пока не проверил).<BR>
			19:39<BR>
			_GrBitmap::FillSolidRect() - запрет на стирание нулевой колонки (котора€ была 
			скопирована из пред. битмэпа)<BR>
			19:48<BR>
			»нтересно, как она у мен€ работала? я же при ресайзе не отмен€л выбор битмэпа в 
			контексте... » сейчас ошибку допустил: не тот контекст использовал в кач-ве 
			шаблона дл€ создани€ (нужен m_hParDC)</P>
		<P>--------------------------------------------------------------------------------------</P>
		<P><STRONG>050412 вт</STRONG></P>
		<P>ћысли вечерне-домашние:<BR>
			- у мен€ иногда возникает ошибка при начале ввода, св€занна€ с перенесением 
			первой точки буфера в последнюю. Ќе исключено, что это может быть вызвано и 
			"сбо€ми" самой оси (выделение и кэшировние пам€ти). ѕопробовать выдел€ть Ќј 
			“ќ„ ” ЅќЋ№Ў≈, резервиру€ "минус первую точку".<BR>
			- видимо, без разибиени€ переход€щего через границу окна битмэпа на два мне не 
			обойтись. ¬ этом случае само рисование лучше вынести в отдельную ф-ию, которую 
			и можно будет вызывать два раза</P>
		<P>12:19<BR>
			”гу, это получилось. “еперь нужно все-таки посчитать - что мы передаем, что 
			получаем, что и где рисуем...<BR>
			1. ¬вод - передача. Ќа входе получаем nCnt точек - но передаЄтс€ в вид на одну 
			точку больше!!!<BR>
			2. –исовать будем именно эту nCnt+1 точку из расчета:<BR>
			&nbsp; - Ќа экран приходитс€ m_nLength точек<BR>
			&nbsp; - нулева€ точка рисуетс€ в нулевой колонке.
			<BR>
			&nbsp; - точка с номером m_nLength рисуетс€ в колонке m_nWinW+1<BR>
			&nbsp; - точка с произвольным номером рисуетс€ в колонке 
			N*(m_nWinW+1)/m_nLength<BR>
			&nbsp; - при очередном (не первом в окне) рисовании координата точки 
			определ€етс€ как:<BR>
			&nbsp;&nbsp;&nbsp; - (m_nWinFrameCnt + i)*(m_nWinW+1)/m_nLength - m_nWinPixCnt, 
			где<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_nWinFrameCnt - последний&nbsp;отсчет пред. 
			рисовани€<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_nWinPixCnt - последн€€ точка пред. рисовани€ 
			(она же - нулева€ текущего)<BR>
			3. ќтображение:<BR>
			&nbsp; - окно занимает nDur*250 ms<BR>
			&nbsp; - окно занимает m_nWinW точек<BR>
			<BR>
			14:14<BR>
			Ќалетел с _ChanW::m_dwRpos - ставлю его в -1, а он же у мен€ DWORD :))) »зменил 
			на long</P>
		<P>14:57 !!!!<BR>
			»з вспомненного вчера по дороге домой (на мосту), и не попавшего в список: 
			копировать в первую колонку нового окна нужно последнюю "рабочую" старого!!!<BR>
		</P>
		<P>15:17<BR>
			≈ще один баг выловлен - но свежий (вчерашний): образовыва€ в поисках свободного 
			битмэпа новый, € возвращал не его...<BR>
			ѕолучена кака€-то работоспособность, но:<BR>
			- сбои на границе окна (а € до сих пор не бью битмэпы по его границе - так что 
			все может быть....)<BR>
			- посередине окна тоже что-то бывает<BR>
			- совсем плохо с 1/4-секундным окном (что, в св€зи с вышеизложенным, 
			пон€тно...)</P>
		<P>15:30<BR>
			Ќачато выделение рисовани€ в отдельную ф-ию CActDView::Draw()</P>
		<P>15:37<BR>
			‘ункци€ выделена - пока без анализа на конец окна.</P>
		<P>20:24<BR>
			ќколо четырех пообедал, посмотрел - все равно фигн€ получаетс€. Ќе попадаю € в 
			окошко... ¬роде бы и считатьс€ все должно правильно - а промахиваюсь: то в одну 
			сторону, то в другую... ѕлюнул, воспользовалс€ солнышком - пошел поснимать... » 
			подумать.<BR>
			¬се же: насколько "фатален" переход к полноэкранным битмэпам?<BR>
			- ждать до окончани€ заполнени€ текущего необ€зательно. Ќо нужно провер€ть, 
			чтобы ненароком не отобразить еще неотрисованное (лучше заход-другой пропустить 
			- и отобразить полностью)<BR>
			- выдел€ть можно точно также - динамически. ≈сли битмэп еще не отображен - 
			рисовать в следующем.<BR>
			- предусмотреть какой-то флаг конца...</P>
		<P>делаем чекин - и пробуем перемордовать...</P>
		<P>20:35<BR>
			Ќо у мен€ изменитс€ пон€тие свободы!!! “о есть: если в текущем битмэпе еще 
			достаточно места дл€ отрисовки - то он свободен... ј если нет - то и зан€т....</P>
		<P>21:09<BR>
			Ќет, эти расчеты вообще наход€тс€ вовне ф-ии Draw(). ќна вызываетс€ уже всегда 
			со указанием на свободный битмэп (то есть и битмэп выбираетс€ вовне). ¬ыбор 
			может происходит при нехватке места в текущем...</P>
		<P>-------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050413 ср</STRONG></P>
		<P>12:00<BR>
			Ќе выдержала душа, откатилс€ (благо и изменений-то почти не было) - решил еще 
			раз проверить, где же ошибаюсь. ƒл€ проверки ввел доп. переменную - первый 
			пиксел битмэпа (по отношению к окну). ѕроверка показывает, что сбой на одну 
			точку получаетс€ каждый раз при переходе границы битмэпа (src правее dst). „ем 
			это может быть вызвано?<BR>
			- ошибка при образовании битмэпа (не учитываю перекрыти€)<BR>
			- ошибка при сдвиге</P>
		<P>17:39<BR>
			ѕоследним перед проглукой с √алей "открытием" стало наблюдение над совсем уж 
			хитрым сбоем: в качестве следующего у мен€ оказалс€ предыдущий битмэп... ¬ 
			общем, совсем...</P>
		<P>18:43<BR>
			я чувствую, где проблема - но чувствую и то, что мне ее не побороть... “аки 
			надо переделывать... ƒелаем чекин с лейблом...
			<BR>
			<FONT color="#ff0066">SMALLBITMAP</FONT></P>
		<P>18:57<BR>
			¬несены первые изменени€ в класс _GrBitmap()</P>
		<P>20:25<BR>
			”же что-то рисует Ќќ:<BR>
			- странные линии в на все окно в конце<BR>
			- таки "гр€зь" (пробелы при копировании???)<BR>
		</P>
		<P>-------------------------------------------------------------------------</P>
		<P><STRONG>050414 чт\</STRONG></P>
		<P>ѕросидел почти до дес€ти, и лишь по дороге домой пон€л: этого не может быть! Ќе 
			могут возникнуть на экране линии, проход€щие „≈–≈« ¬—≈ окно!!! —нова нужна 
			отладка...</P>
		<P>11:40<BR>
			— лини€ми стало €снее: при рисовании перехода обнул€л лишнюю переменную. 
			ѕродолжает быть непон€тно с:<BR>
			- разрывами<BR>
			- точкой обнулени€<BR>
			- "лишними" пр€мыми в начале каждого битмэпа....</P>
		<P>12:05<BR>
			“ретий пункт (лишние линии) про€снен - "не то" значение A (должно быть x0). — 
			остальными - не€сно....</P>
		<P>13:12<BR>
			–азрывы на графике возникают в точках несовпадени€ имеющегос€ m_nWinPixCnt и 
			расчитанного x0....</P>
		<P>13:46<BR>
			”дален m_nWinPixCnt - избегаем двусмысленностей....</P>
		<P>14:18<BR>
			Ќехорошие разрывы и проч. пропадают, если ликвидировать не-стирание первой 
			колонки очередного вывода. Ќо непон€тно, правильно ли это: ведь все расчитано 
			как раз на тот случай, что в этой колонке уже есть инфа, которую не нужно 
			удал€ть - а в текущем выводе она лишь дорисовываетс€...<BR>
			&nbsp; ѕлюс к тому: очередные тестовые добавки показали, что у мен€ имеютс€ 
			непри€тности с ф-ией Copy()/////</P>
		<P>16:30<BR>
			Ќет, непри€тности у мен€ были не с Copy()!!!
			<BR>
			¬ ходе перестройки была утер€на специфика записи рисовательного таймера: он 
			запускалс€ не после второго, а после первого потреблени€ данных - и когда 
			отображение переходило на следующий участок, он еще не был заполнен!!! ј 
			"проверки" (фиксаци€ пределов отрисованного и проверка корректности 
			отображени€) € так и не завел... —ейчас проблема решена просто путем запуска 
			таймера лишь после второго потреблени€ данных - но если по-хорошему, то нужна 
			проверка. ѕричем она должна быть достаточно хитра€ (чтобы в следующий раз 
			рисовать, включа€ неотрисованный при прошлом вызове участок)<BR>
			&nbsp;&nbsp;  ороче, сейчас рисование (но только в осц-режиме!) идет - за 
			исключением спецслуча€ 1/4 секунды....</P>
		<P>16:42<BR>
			”браны тестовые заливка синим и коса€ лини€</P>
		<P>16:43<BR>
			¬ битмэпе m_nEndPix фикируетс€ не только по PolyLine(), но и по 
			FillSolidRect();&nbsp; обнул€етс€ при GetFree();</P>
		<P>16:46<BR>
			Ѕитмэп провер€ет попытку&nbsp;копировани€ за пределами участка, при выходе 
			возвращает 0 и ничего не копирует.</P>
		<P>16:55<BR>
			ѕроверка в виде при копирвоании. ѕриходитс€ делать в двух местах. ѕо€влись 
			остановки в конце окна.</P>
		<P>17:17<BR>
			«ависы в конце окна были вызваны ситуацией строгого равенства прошедшего 
			времени ширине окна - получалось, что в очередной раз € хочу отрисовать ¬—≈ 
			окно, вот и не мог... »зменение проверки на &gt;= спасло....
			<BR>
			&nbsp; “аким образом, проверка на отображение неотрисованного реализована - 
			проверено в режиме запуска граф. таймера после первого ввода. Ќо при этом вывод 
			получаетс€ "рваный" (часто приходитс€ ждать). ¬озвращаюсь к запуску после 
			второго ввода.</P>
		<P>17:28<BR>
			<FONT color="#ff0066"><FONT color="#000099">- начинает слегка сбоить при 1/2 секунде<BR>
				</FONT><FONT color="#000099">- совсем не работает при 1/4 секунды<BR>
				</FONT><FONT color="#000099">- не прописан скролл-вариант<BR>
				</FONT><FONT color="#000099">- не прописаны бипол€ры<BR>
				</FONT><FONT color="#000099">- совсем непон€тно с децимацией....</FONT><BR>
			</FONT>¬ целом - пахота только начинаетс€....</P>
		<P>17:43<BR>
			ѕри внимательном рассмотрении "проблемы" с полусекундным окном оказались в 
			основном - в области остановки. ј там нехорошо при любых длительност€х: € 
			впадал в цикл "невозможности рисовани€" (не было новых данных), а обнул€лс€ 
			лишь следующий битмэп. ¬ведено обнуление текущего, но и следующий тоже оставлен 
			- на вс€кий случай...</P>
		<P>17:50<BR>
			— четвертьсекундой тоже все не так плохо: проблема вырастала все из той же 
			плюс-минус точки: в таком варианте последн€€ была на точку раньше длины 
			окна.... ѕосле введени€ поправки вроде как работает...</P>
		<P>18:00<BR>
			ѕереходим к формированию скролл-варианта:<BR>
			- модифицирован вызов _GrBitmap::Copy - берет два пр€моугольника, Dst и Src, 
			второй может быть равен нулю (дл€ осц-варианта), и тогда приравниваетс€ к 
			первому<BR>
		</P>
		<P>19:39<BR>
			„его-то изобразил. ќтрисовывать скролл начинает - но очень быстро 
			затыкаетс€....</P>
		<P>19:54<BR>
			”гу, теперь и не затыкаетс€. Ќо скорость вывода - €вно не та: тер€ю точки....</P>
		<P>19:57<BR>
			ѕовычитал единиц :) ¬роде бы похоже. Ќа четвертьсекунде вылетает (хот€ кому это 
			может понадобитьс€????). — нулем - не то! »щем - где и как его считаем....</P>
		<P>20:21<BR>
			ѕро ноль вспоминл. —кроллируем худо-бедно :)))) ¬ылет при скроллировании на 
			четвертьсекунды образовывалс€ из-за вызова рисовалки с нулевым счетчиком. 
			ќткуда - не знаю, просто заблокировал этот вариант....</P>
		<P>Ќу и что теперь? Ѕипол€ры или децимацию???</P>
		<P><STRONG><EM><U>’а! ѕоздравл€ю!! я вернулс€ на уровень 1 но€бр€!!! “о есть&nbsp;- делаем 
						децимацию :)))</U></EM></STRONG></P>
		<P>—ейчас € даже не уверен - то ли все децимируетс€ правильно, а передаетс€ совсем 
			не то - то ли огрехи лежат в области самой децимации. » даже не очень 
			представл€ю, как это вы€снить... –азве что на максимальном сжатии, когда у мен€ 
			должно выйти около 64 точек на получку....</P>
		<P>21:15<BR>
			¬ы€снил: точно недодаю при собственно децимации: последние точки равны нулю....</P>
		<P>21:22<BR>
			ѕохоже, что € не то передаю...  ладу в буфер 61 точку, а говорю - 63 ????</P>
		<P>21:28!!!!!<BR>
			јга!!! я ошибалс€ на точку!!! Ќужно не<BR>
			<FONT color="#000099">if (nDecCnt++ &gt;= m_nDecCf)<BR>
			</FONT>а<BR>
			<FONT color="#000099">if (++nDecCnt &gt;= m_nDecCf)</FONT></P>
		<P>“еперь количество точек передаетс€ правильное. Ќо вот нравитс€ ли мне это????</P>
		<P>21:33<BR>
			Ќет, мне это определенно не нравитс€:<BR>
			- уж очень непохоже на результаты IIR-филтрации: как будто и не отфильтровали 
			вовсе... » пр€мые участки..<BR>
			- через какое-то врем€ вывод начинает "затыкатьс€" - такое впечатление, что 
			ввод за ним не поспевает...
			<BR>
			- не возникает ли проблем с некратностью точек????</P>
		<P>Ќо об этом будем думать - завтра....</P>
		<P>--------------------------------------------------------------------------</P>
		<P><STRONG>050415 пт</STRONG></P>
		<P>14:40<BR>
			ѕерва€ удача дн€: отлаживать в цифрах децимацию немыслимо - пришлось 
			догадыватьс€. ј догадка показала: € не сбрасывал глобальный флаг m_bStart - то 
			есть при поступлении каждой следующей порции данных фильтровальный буфер заново 
			заполн€лс€ первым значением... ¬ведение сброса помогло: стало выгл€деть 
			приемлимо...<BR>
			- с фильтрацией как-то сильно не то. Ћибо € недофильтровываю FIR, либо 
			перефильтровываю IIR - либо при IIR-фильтрации не учитываю децимацию<BR>
			- возникают тормоза вывода - похоже на нехватку данных<BR>
			- при малой длине окна - тут же затыкаемс€. ѕохоже, что просто не хватает 
			последней точки (или - проблемы некратности окна)</P>
		<P>14:56<BR>
			Ќу конечно! ‘ильтр у мен€ формируетс€ диалогом - и непохоже, чтобы там как-то 
			учитывалась реальна€ частота дискретизации...<BR>
			<FONT color="#000099">- коэффициенты дл€ других частот (сейчас - только дл€ 2048)<BR>
			</FONT><FONT color="#000000">--- это было записано в п€тницу, 1 окт€бр€ 2004 года 
				!!!!<BR>
				ј теперь мне придетс€ еще и вспоминать - каким же таким образом € считал эти 
				коэффициенты...</FONT></P>
		<P>19:42<BR>
			¬ы€снил, что считал их 23 июл€ :) Ћогику расчетов восстановил - только потому, 
			что она была записана в этом дневнике. ѕосле чего последовал длительный 
			перерыв: обед, прощальна€ прогулка с √алей... ¬озвращение, финансовые 
			вопросы... Ќо к мысли вернутьс€ смог. Ќа сей раз, чтобы точно не забыть: так € 
			считаю highPass фильтры:</P>
		<P><FONT style="BACKGROUND-COLOR: #66ffff">&nbsp; function f = hpIIR(cutFrq, dFrq)
				<BR>
				&nbsp;&nbsp;&nbsp; [bBh aBh] = besself(1,cutFrq,'high');
				<BR>
				&nbsp;&nbsp;&nbsp; [bN aN] = bilinear(bBh,aBh,dFrq/pi/2);
				<BR>
				&nbsp;&nbsp;&nbsp; f = [bN aN]; </FONT>
		</P>
		<P>ѕри помощи этой функции можно составить таблицы и дл€ других частот 
			дискретизации. Ќо сначала нужно пон€ть, какие они могут быть:<BR>
			- "родные":&nbsp;<BR>
			16384<BR>
			&nbsp;&nbsp;8192<BR>
			&nbsp; 4096<BR>
			&nbsp; 2048<BR>
			&nbsp; 1024&nbsp; - децимированные<BR>
			&nbsp;&nbsp; &nbsp;512<BR>
			&nbsp;&nbsp;&nbsp; 256<BR>
			&nbsp;&nbsp;&nbsp; 128</P>
		<P>»того получаетс€ 8 разных частот, при предусмотренных&nbsp;7 частотах highpass 
			среза<STRONG><U> (0.1, 0.5, 1, 3, 5, 10, 100&nbsp;)</U></STRONG>&nbsp; получаю 
			матрицу из&nbsp;48 элементов :) Ќеплохо :)))) ƒаже пока каждый элемент состоит 
			из четырех чисел :)))</P>
		<P>«аполн€ем.</P>
		<P>20:31<BR>
			“аблица HighPass коэффициентов заполнена. Ќќ! Ќет самого учета частоты - и не 
			изменены данные комбобокса.</P>
		<P>20:38<BR>
			ƒанные комбобокса изменены, дл€ облегчени€ доступа к финальной частоте заведена 
			соотв. ф-и€ MainFrame::GetFrq().</P>
		<P>20:55 - это сделано, Ќќ!  оэффициенты не мен€ютс€ при смене децимации в 
			харддиалоге - только по комбобоксу!!! <STRONG><FONT color="#000099">ќшибка!!!</FONT></STRONG></P>
		<P>21:04<BR>
			ƒл€ устранени€ этой ошибки запрос коэффициентов введен в CActDView::SetFrq(), 
			котора€ вызываетс€ по OnRunGo(). <FONT color="#ff0066"><STRONG>Ќо! ј что у мен€ 
					происходит при создании нового окна уже в процессе ввода????</STRONG></FONT></P>
		<P>¬идимо, уже на завтра - все то же дл€ LowPass...</P>
		<P>21:19<BR>
			јга, чуть было не налетел - причем точно не в первый раз. ¬ матлабе про Besself 
			написано, что он только lowpass - но на самом деле считаетс€ и highpass, причем 
			при наличии ЋёЅќ√ќ третьего аргумента!!! :)))<BR>
			<FONT color="#000099">¬о-вторых - наверное, нужно изменить пор€док частот: пусть 
				сразу за выключенным следует наибольша€, а потом - по уменьшению...</FONT></P>
		<P><FONT color="#000000">21:26<BR>
				ѕор€док в диалоге изменен. «акладываем основы - но заполн€ть буду завтра....</FONT></P>
		<P>--------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050416 сб</STRONG></P>
		<P>13:47
			<BR>
			«аполнена таблица дл€ IIR Low-Pass филтров.</P>
		<P>13:57<BR>
			ѕроверено. ѕохоже, что результаты совпадают (IIR фильтраци€ после децимации не 
			вли€ет там, где не должна). ƒвигаемс€ дальше:<BR>
			<FONT color="#ff0066"><STRONG><FONT color="#000099">- «атыки<BR>
						- "нехватка данных"<BR>
					</FONT>- <FONT color="#000099">длительные уходы за нулевую линию после переключени€</FONT></STRONG></FONT></P>
		<P>14:36<BR>
			–азмышл€€ над проблемой "затыков": при малой частоте дискретизации и малой 
			длительности вывода € получаю сколь угодно большое рассогласование между 
			последней точкой линии - и последней точкой битмэпа. “о есть: одна точка 
			находитс€ еще в этом битмэпе (далеко от край), следующа€ - уже в другом (и тоже 
			далеко от кра€).  аков же выход?<BR>
			&nbsp; ¬озможно, в подобной ситуации нужно пытатьс€ рисовать линии, выход€щие 
			за пределы битмэпа - как в конце, так и в начале. ¬идимо, делать это придетс€ в 
			сочетании Plot &amp; Draw...</P>
		<P>14:43<BR>
			ѕростое решение: если текущий ввод выходит за пределы битмэпа, рисуетс€ включа€ 
			—Ћ≈ƒ”ёў”ё точку - ну а новый начинаетс€ с ѕ–≈ƒџƒ”ў≈…. Ќо при этом по€вл€ютс€ 
			"взбрыки" (которые можно будет проверить лишь на хардовом сигнале) - и от 
			"нехватки данных" € не спасен... Ќужно думать поточнее...</P>
		<P>15:36<BR>
			ѕроверка показала: при сильной дециации € недосчитываюсь точек Ќ≈«ј¬»—»ћќ ќ“ 
			ƒЋ»Ќџ ќ Ќј!!!</P>
		<P>16:02<BR>
			¬идимо так: € же передаю кол-во точек ƒ≈Ћ≈Ќ»≈ћ, а оно не учитывает ќ—“ј“ќ . 
			Ќужно же - реальное кол-во точек...</P>
		<P>16:09<BR>
			»зменил. Ќо при этом куда-то исчезла часть секундных меток (при 20с) - и все 
			равно затыкаетс€....</P>
		<P>18:15<BR>
			¬от уже второй час сильно сомневаюсь: а что же у мен€ вообще со счетчиками? я 
			же (вроде как) собиралс€ передавать Ќј ќƒЌ” “ќ„ ” больше??? —тал смотреть - 
			пока высмотрел только, что m_nCnt уже нигде не используетс€ - убрал...</P>
		<P>18:35<BR>
			¬нимательно прошелс€ по m_nWinFrameCnt - поизмен€л где-то на единичку, строгое 
			неравенство на нестрогое... Ќо без четкого понимани€ - что и где мен€ю. Ќадо 
			сейчас в SourceSafe проверитс€...
			<BR>
			&nbsp; ‘акт: стало лучше - но все равно до тормознутого варианта добираетм€... 
			блиин....<BR>
			<STRONG><FONT color="#000099">&nbsp;   тому же €вно есть логическа€ несостыковка с 
					фильтрами: перва€ полученна€ точка ввода €вл€етс€ на самом деле последней 
					точкой предыдущего - то есть уже сохраненной...<BR>
				</FONT></STRONG>&nbsp; Ћезу в VSS.\</P>
		<P>Ѕыло&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			стало</P>
		<P>Plot - рисование
		</P>
		<P>if (m_nWinFrameCnt + nCnt &gt; 
			m_nLength)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			if (m_nWinFrameCnt + nCnt &gt; m_nLength)<BR>
			{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
			&nbsp;&nbsp;&nbsp; int nC = 
			m_nLength-m_nWinFrameCnt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			int nC = m_nLength-m_nWinFrameCnt + 1;</P>
		<P>Draw - конец</P>
		<P>if (m_nWinFrameCnt &gt;= m_nLength) m_nWinFrameCnt -= 
			m_nLength;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			if (m_nWinFrameCnt &gt; m_nLength) m_nWinFrameCnt -= m_nLength;</P>
		<P>&nbsp;</P>
		<P>18:49<BR>
			ѕоследнюю строчку вернул к старому варианту (показалось логичнее). Ќе помогло: 
			дело в том, что все равно начинаю "сбоить". ѕричем - где-то через 64 окна (или 
			128 секунд???)<BR>
			ѕроверить не могу: при 4-секундном окне - уже не дождатьс€....</P>
		<P>19:35<BR>
			–азобралс€ с секундами: к их счетчику добавл€лс€ nCnt, а нужно - nCnt-1; “еперь 
			они похоже что точно попадают - и не пропадают. —четчик переименован из <STRONG>m_nOldCnt</STRONG>
			в <STRONG>m_nOneSecCnt</STRONG>.ќт "недоввода" это, пон€тное дело, не 
			спасает...</P>
		<P>19:45<BR>
			ѕохоже, нужное исправление вот: при переходе к рисованию и обнаружению выхода 
			за пределы окна следующее окно должно начинатьс€ с той же точки,&nbsp;на 
			которой закончилось это:<BR>
			<FONT color="#000099">//выход€щую за пределы точку убираем
				<BR>
				nC--;
				<BR>
				nCnt -= nC;
				<BR>
				nBase = nC; </FONT>
		</P>
		<P>ѕо крайней мере, после этого уже п€ть минут рисует крайне децимированное 
			двухсекундное окно. Ќа этом завершаем, напомнив предсто€щие шаги:</P>
		<P><STRONG><FONT color="#3300cc">TODO<BR>
					- –еденькие точки разрыва, наблюдающиес€ при максимальной децимации и малой 
					длине окна<BR>
					- ѕравильный учет совпадени€ первой точки новой получки с последней предыдущей 
					в IIR-фильтрах</FONT></STRONG></P>
		<P>---------------------------------------------------------------------------------</P>
		<P>050417 вс (дома)</P>
		<P>- »сточником точек разрыва может быть как заливка пр€моугольника рисовани€: его 
			"нулева€" точка может совпадать с последней точкой предыдущего (ƒќЋ∆Ќј - Ќќ 
			ћќ∆≈“ » Ќ≈ —ќ¬ѕјƒј“№????). я соотв. поправку вводил - но что-то мне не 
			понравилось. ѕопробую еще раз (CActDView::Draw, пометка 050417)</P>
		<P>- 18:36 - дл€ всех случаев, кроме m_bChange == true, цикл реферировани€ и 
			IIR-фильтрации начинаю не с нулевой, а с первой точки!!!</P>
		<P>20:20   вопросу о "взбрыках" - от них избавл€лс€ в период между 22 и 23-25 
			ќкт€бр€ 2004 года. ѕопробую сравнить две "крайние" версии в VSS.<BR>
			20:22 ѕосмотрел. ≈динственные изменени€ между 22 окт€бр€ и 29 €нвар€ (следующий 
			домашний чекин) - заполнение коэффициентов по флагу m_bChange и перенос 
			вычислени€ нул€ с предшествующей на следующую за IIR-‘ильтрацией позицию. ј где 
			у мен€ сейчас? ƒа вроде бы так же... ‘ильтруетс€ в Plot(), а ноль беретс€ уже в 
			Draw()... Ќда....
			<BR>
			21:08<BR>
			–азве что в перечень условий обнулени€ не был включен флаг m_bChange. 
			¬ключил...</P>
		<P>-------------------------------------------------------------------------------------------</P>
		<P>050418 пн</P>
		<P>11:47 (все-таки полтора часа провел на фотосайте)<BR>
			ѕервые пробы домашних изменений: не-стирание нулевой колонки похоже что 
			отрабатывает правильно. ј вот с учетом нулевой точки при IIR-филтрации что-то 
			не то: без HighPass еще рисует нормально, а вот после HighPass нулева€ точка 
			получаетс€ совсем не там....</P>
		<P>13:13<BR>
			¬се еще разбираюсь с нулевой точкой (в режиме посто€нных отвлечений на 
			финансовые вопросы). ѕолучаетс€, что просто пропускать мне нельз€ (ведь новое 
			значение уже положено!). Ќельз€ только сдвигать в "старые значени€"....</P>
		<P>14:00<BR>
			"Ћишние палки и точки" объ€сн€лись просто: в "зачищаемом" пр€моугольнике нужно 
			и правую границу увеличивать на 1... ¬ общем, сейчас все работает, на глаз 
			нехорошестей не видно (а так как фильтры только дл€ глаз и предназначены - то и 
			пусть его). ¬озвращаюсь к начатым по дороге на работу раздумь€м о судьбе 
			бипол€ров - и о "переходной таблице" вообще....</P>
		<P>-------------------------- чекин -------</P>
		<P>»так, бипол€ры и проч.<BR>
			-¬о-первых, мне хочетс€, чтобы на выходе ф-ии Plot() формировалс€ уже 
			гомогенный массив отображаемых каналов - без разницы, моно- или же бипол€рные 
			они.<BR>
			-¬о-вторых, "ƒословный перебор" имеющихс€ биопл€ров кажетс€ процедурой слишком 
			дорогосто€щей: тем более, что осуществл€ть ее придес€ дл€  ј∆ƒќ… точки  ј∆ƒќ√ќ 
			из вводимых каналов<BR>
			-¬-третьих, бипол€ры усложн€ют ситуацию значительно: получаетс€, что каждый из 
			вводимых каналов может не только быть/не референтным и монопол€рно отображаемым 
			- но и €вл€тьс€ членом любого количества бипол€ров!</P>
		<P>Ќапрашивающийс€ выход - иметь "сводную карту". ѕроще всего сделать ее (как и 
			прочие карты) - по ¬—≈ћ каналам, из каждого вводимого получать его номер, и уже 
			по нему определ€ть флаги:<BR>
			- референтности<BR>
			- монопол€рности (с номером канала-вывода) - флагом может быть номер (начина€ с 
			единицы)<BR>
			- бипол€рности (с номером канала-вывода и знаком) - флагом может быть номер 
			(начина€ с единицы), отрицательный дл€ вычитаемого. Ќо вот этих-то флагов может 
			оказатьс€ много!!!!</P>
		<P>ѕытаюсь придумать альтернативу. ¬ общем случае у мен€, скорее всего, может 
			оказатьс€ ћЌќ√ќ ¬¬ќƒ»ћџ’ каналов - и ћјЋќ ќ“ќЅ–ј∆ј≈ћџ’. “огда и цикл можно было 
			бы попытатьс€ построить ѕќ ќ“ќЅ–ј∆ј≈ћџћ (счита€ таковыми и референты). Ќо, 
			оп€ть же, при этом один вводимый канал в списке может встретитьс€ несколько 
			раз....</P>
		<P>Ќаверное, можно не бо€тьс€ статической карты (основные карты у мен€ именно 
			такие). Ќо! —ейчас у мен€ установлен размер 32*9 = 288 каналов. ’ватит ли этого 
			дл€ всех будущих применений????</P>
		<P> арту эту можно строить по сообщению (OnMapChanged, вроде бы). ћожно и каждый 
			раз - но зачем?</P>
		<P>14:56<BR>
			<STRONG><FONT style="BACKGROUND-COLOR: #ffff33" color="#ff0066">#define TOTCHANS 32*10 
					!!!!</FONT></STRONG></P>
		<P>16:13<BR>
			ѕервый после массовых изменений (совсем друга€ карта!) тест - без бипол€ров 
			живет и работает!</P>
		<P>16:38<BR>
			”дал€ю бипол€рный буфер (m_pBpBuf). —оответственно, под m_pChanBuf выдел€етс€ 
			пам€ть на все выводимые каналы (включа€ бипол€ры).</P>
		<P>19:24<BR>
			у‘, и это побороли... —начала неправильно обнул€л буфер - и лишь под занавес 
			пон€л, что у мен€ бипол€рный цикл оказалс€ вне цикла по точкам... —ейчас 
			нормально отображает и те, и другие каналы - и допускает добавление/удаление.</P>
		<P>—ледующие планы:<BR>
			<FONT color="#990000"><FONT color="#000099">- отображение при отсутствии монопол€ров и 
					каналов вообще, при отсутствии всего<BR>
					- поведение при открытии нового окна во врем€ ввода<BR>
				</FONT>- обработка каналов с разной децимацией.</FONT></P>
		<P>-------------- чекин 
			--------------------------------------------------------------------------</P>
		<P>19:41<BR>
			—ейчас отлетает при попытке отрисовки окна без аналоговых каналов - и даже с 
			одними бипол€рами</P>
		<P>19:49<BR>
			—лишком рано выходил из фии SetBuffers - не успевал назначить длины. Ќо и 
			пытатьс€ выдел€ть буфера нулевой длины тоже нельз€!!! —ейчас работает с одними 
			бипол€рами (без моно) - но только если предварительно был включен-выключен хот€ 
			бы один моно....</P>
		<P>20:17 Ќаверное, на радост€х от 30го река за "ополовника" :)<BR>
			ѕонял: дело было в диалоге, именно в нЄм неинициализировались переменные. 
			ѕоставил вызов CorrectMap() в конец OnInitDialog(). “еперь пустое окно 
			рисуетс€. Ѕолее того, открытие нового окна во врем€ ввода не приводит к вылету 
			- все проходит нормально.</P>
		<P>20:24<BR>
			- при добавлении нового бипол€рного канала включаю бипол€ры</P>
		<P>21:26<BR>
			ѕокамест сделал децимацию триггерного канала. <FONT color="#ff0066">≈сть таки 
				затыки при полусекундном окне :(((<BR>
			</FONT>”стал - пора к дому....</P>
		<P>---------------------------------------------------------------------------------------------------------------</P>
		<P>050419 вт</P>
		<P>–азибираюсь с разноразмерными каналами (попытка организовать недецимированный 
			триггер). «аведена переменна€ _ChanW::m_nNew - раздельный счетчик новых данных 
			по каналу. ¬ид теперь тоже берет счетчики пр€мо из соотв. канала 
			(предполагаетс€, что буфер начинаетс€ с аналоговых каналов, триггерный идет на 
			последнем месте). —оответственно, и счетчик максимумов у тригканала свой. ¬ 
			таком режиме работает без вылетов - но и €вно не так :) ѕомимо "счетчика новых" 
			€ должен из каждого канала вычерпывать и его длину...</P>
		<P>15:05<BR>
			ƒл€ обеспечени€ недецемированного триггера пришлось ввести полный второй 
			комлект счетчиков (в виде). ѕохоже, что работает - хот€ можно ожидать вс€ких 
			подвохов из-за возможного несовпадени€ "границ окна".</P>
		<P>15:24<BR>
			¬ведена кнопка "децимаци€ триггера".  ак бы проверить, работает она или нет???</P>
		<P>16:13<BR>
			 нопка не работала (главное окно не считвыало ее показани€).  огда же стала 
			работать, вы€снилось: при децимации триггера теперь все рушитс€...</P>
		<P>16:16<BR>
			»справлено поведение OnRunGo() в отсутствие включенных каналов (ранее не 
			вызывала Stop())</P>
		<P>17:21<BR>
			“еперь обработчик CHardDlg::OnBnClickedTrigdec посылает сообщение 
			m_pMainFrm-&gt;PostMessage(WM_DIZ_MAPCHANGED,0,0); - и перераспределение 
			буферов происходит в правильном месте, наблюдаютс€ все признаки переключени€ и 
			работоспособности. ќтлеты регистрировались - но не каждый раз (надо 
			разбиратьс€). » даже окно с одним только триггером отображаетс€.... ќдин минус: 
			во всех режимах с децимацией (как с децимацией трига, так и без оной) 
			по€вл€юст€ глюки отображени€ тригканала (мусор в конце.) ’от€ € не уверен - они 
			могут быть и на аналоговых каналах....</P>
		<P>17:40<BR>
			¬ CDialogView заведен checkbox дл€ инвертировани€ триггера</P>
		<P>19:50<BR>
			ѕервые хардовые тесты. ѕервые баги:<BR>
			<FONT color="#ff0066"><STRONG><FONT color="#000099">- промашки на границе децимации<BR>
					</FONT><FONT color="#000099">- ошибка при масштабировании раз в 10<BR>
					</FONT></STRONG></FONT>ƒумать....</P>
		<P>20:19<BR>
			ѕроверил масштаб в ActiView - совпадает с моим. —даетс€ мне, —лава ошибс€ раз в 
			10...</P>
		<P>20:31<BR>
			ѕромашки на границе децимации: "запоминать" € должен уменьшенный на 1 
			децимационный счетчик. Ќо это помогает только когда включена децимаци€ 
			триггера... ѕравильно: если децимаци€ триггера выключена, € после перебора 
			каналов (а триггер идет последним) получаю старое значение - вот мне ничто и не 
			помогает...  ак же сделать????</P>
		<P>21:00<BR>
			ѕрименена довольно сложна€ схема запоминани€ (алгоритмом это не назовешь): если 
			канал подвергс€ децимации, его итоговые значени€ (децимационный счетчик и 
			позици€ в буфере) сохран€ютс€ в отдельных переменных. ѕосле прохождени€ всех 
			каналов смотрим, €вл€ютс€ ли эти переменные валидными (не -1) - и если да, 
			присваиваем...</P>
		<P><STRONG><FONT color="#000099">Ќа самом деле и в случае с не-децимацией тригканала (да и 
					в случае с децимацией - тоже) € должен учесть факт сдвига!!!!</FONT></STRONG></P>
		<P><STRONG><FONT color="#ff0066">ћусор в конце тригканала так таки и по€вл€етс€.... ¬роде 
					бы - только при децимации</FONT></STRONG></P>
		<P><STRONG><FONT color="#ff0066">» при скролле на границе окон нехорошо...</FONT></STRONG></P>
		<P>----------------------------------------------------------------------------------------------------------------------------------------------</P>
		<P>050420 ср<BR>
			¬чераший вечер принес пусть и пустую - но непри€тность: вылетел фотосайт. ¬ 
			итоге он откатилс€ на 13 апрел€ - пропал "ќполовник" со всеми реками и 
			комментари€ми - ну и бќльша€ часть таковых к "“упику". ќбидно - и по старой все 
			же набралось что-то, ну а последн€€ просто стала моим "рекордсменом", втрой раз 
			по ней 37 реков € уже не наберу.... ƒа и выкладывать сейчас смысла нет - сайт 
			еще несколько дней будет переполнен. Ћадно, переживем...</P>
		<P>ѕосле гибернации не запустилась джина. ћожет быть, еще и из-за того, что 
			замораживалс€, даже не остановив куловский вывод. ѕришлось перезапуститьс€. 
			“еперь работает - попробуем подумать...</P>
		<P>ѕотом мен€ ждал еще один глюк: пошел совсем не тот выход с джины. ј после 
			перезапуска и вообще отказалась работать.  онечно! —нова выскочила из разъема 
			плата. ѕодкусил зажим - надеюсь, будет держать.</P>
		<P>Ћишь часам к трем пон€л: глючу € не при отображении - € недорисовываю! Ёто 
			отчетливо видно и на осц-картинках: между последней и первой точками есть 
			разрыв. ≈ще хитрее при "обнулении": перва€-то точка получаетс€ необнуленной. 
			Ќадо вылизывать...</P>
		<P>18:17<BR>
			≈ще подумал, посмотрел, посчитал - и убрал во всех рисовательных функци€х 
			m_nWinW+1. ќказалось, что теперь рисуетс€ правильно - и даже при скролле с 
			недецмированным триггером мусор не по€вл€етс€... —ейчас покумекаю еще.</P>
		<P>18:40<BR>
			ѕри децимации триггера мусор по€вл€етс€ (и скролл - и осц). Ѕез децимации вроде 
			бы нет в осц - но есть в скролл. ѕри скролле одна точка таки пропадает - и нет 
			соотв. секундной линии...</P>
		<P>19:00<BR>
			—екундную линию нашел: счетчик нужно было инициализировать не нулем, а готовой 
			секундной (тогда рисуетс€ в нулевой поизиции). ѕропажа точки в конце/начале 
			(при скролле) сохран€етс€. ћусор сохран€етс€....</P>
		<P>19:20<BR>
			ѕопытки боротьс€ с отс. точкой: создаю битмэп на 1 точку шире. “очки все равно 
			нет - и пропадают секундные линии :(</P>
		<P>&nbsp;</P>
		<P>-----------------------------------------------------------------------------</P>
		<P>050421 чт</P>
		<P>“ак вчера весь вечер - и сегодн€ с утра искал пропавшую точку. ќсновной вопрос - 
			где же она находитс€: в рисовании или в отображении. » каким образом это можно 
			вычислить??? —оздал бездну тестовых конфигураций, с отрисовкой начальных и 
			конечных точек и участков ломаных линий, с трейсингом... ѕолной €сности нет - 
			но кажетс€, что дело скорее в отрисовке. ѕричем не отирсовываетс€ (вроде бы) 
			именно начальна€, перва€ точка нового окна....</P>
		<P>так весь день и вечер точки и искал....</P>
		<P>---------------------------------------------------------------------------------------</P>
		<P>050422 пт</P>
		<P>Ќет, нет и еще раз нет! Ќужно еще и еще раз думать - как € отсчеты и точки 
			считаю... ”вы, здесь не получитс€ - надо на бумаге...</P>
		<P>18:51<BR>
			ѕосле очередных размышлений пон€л: никаких единиц ни добавл€ть, ни вычитать - 
			не надо! ≈динственное, что нужно учитывать - это при рисовании, выход€щем за 
			пределы окна таки брать выход€щую точку. ј откатыватьс€ потом на минус единицу! 
			Ќо там ведь и по пиксел€м тоже откат нужен "в минус"....</P>
		<P>Ќо триггерные проблемы остаютс€ - хот€ иногда и кажетс€, что их совсем нет...</P>
		<P>20:52<BR>
			Ќо оказалось, что проблема точки тоже остаетс€.... —тал смотреть еще 
			внимательнее: оказалось, что дело - в неправильной инициализации стартовых 
			параметров ф-ии Plot() (min, max. d). » в самом деле, они были расчитаны на 
			обеспечение непрерывности рисовани€ - но сейчас-то € эту непрерывность 
			обеспечиваю "извне" (дублиру€ конечную и начальную точки). ѕолучаетс€, что мне 
			и массивы не нужны - обхожусь локальными переменными... “еперь вроде рисует 
			:))) Ќаконец :)))</P>
		<P>Ќо вот что делать с триггером.... » довольно-таки частыми отлетами :((((</P>
		<P>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<BR>
			ѕо дороге домой пыталс€ сообразить: что же это получаетс€, € сам наехал одной 
			своей "идеей" на другую? ¬едь разрыв произошел из-за того, что и в Draw() 
			предыдуща€ точка запоминалась - а сейчас € еЄ же стал дублировать ещЄ и в 
			"основной цифири"... Ќо не всЄ так просто: сейчас € обеспечиваю любую 
			некратность точек и отсчетов, IIR-фильтрацию... ¬ общем, пусть остаетс€...</P>
		<P>--------------------------------------------------------------------------------------------------------------------------</P>
		<P>050423 сб<BR>
			”тром получил птичьи определители - вот смотрел/слушал их, по ‘— ползал... јж 
			до двух часов. —ейчас пытаюсь вернутьс€ к "работе". ќсновное - разобратьс€, что 
			же происходит с тирггерным каналом при децимации.</P>
		<P>14:45<BR>
			ѕервое, что вы€снилось после включени€ трейсинга перехода рисовани€ - 
			рассогласование счетчиков: "основной" € увеличивал на единицу, а триггреный - 
			нет. Ёто непри€тно и в недецимированном варианте, а при децимации моглостать 
			совсем...
		</P>
		<P>17:00<BR>
			ѕоправка оказалась ключевой. ѕосле ее введени€ в режиме децимации (и децимации 
			триггера) программа отпахала больше часа - без каких-либо сбоев или перекосов</P>
		<P>“очнее, два непри€тных момента есть:<BR>
			<FONT color="#ff0066"><STRONG><FONT color="#ffff33">- изредка точки тригканала дублируютс€</FONT>
					<BR>
					<FONT color="#000099">- кака€-то полна€ лажа с первой точкой вводимого буфера - 
						причем сказываетс€ уже на этапе децимации!!!<BR>
					</FONT></STRONG></FONT>» еще про один момент не забывать:<BR>
			<STRONG><FONT color="#000099">- во всех случа€х децимации тригканал нужно сдвигать на 
					половину ширины фильтра!</FONT></STRONG></P>
		<P>ƒумаем дальше...</P>
		<P>≈динственное, чего добилс€ - пон€л проблему первой точки: это сами усилители 
			генерировали мощный выброс - причем с той же частотой 2 √ц....</P>
		<P>-------------------------------------------------------------------------------------------------------------</P>
		<P>050425 пн</P>
		<P>14:26<BR>
			ѕервый сигнал собрал - и первые тесты провел. “еперь бы сообразить, как должен 
			выгл€деть желаемый сигнал.... ¬едь нужно и биты хорошо представить, и временную 
			точность соблюсти.....</P>
		<P>практически весь день ушел на построение в куле тестового триг-сигнала. Ќадо 
			было получить отдельные биты - а дл€ этого потребен дополнительный код (соотв. 
			- отрицание и убирание единицы). ¬ итоге сейчас (19:33) построено, и работает - 
			но вот только € не пон€л: получаетс€, что у мен€ при децимации сдвиг идет не в 
			ту сторону???</P>
		<P>20:44<BR>
			ƒа.... ќшибок тут хватало<BR>
			<FONT color="#000099">-</FONT><STRONG><FONT color="#000099"> ¬о-первых, совсем неверно 
					решена не-децимаци€ триггера (€ вообще проскакиваю нужную ветку). Ќе сделано - 
					еще нужно думать<BR>
				</FONT><FONT color="#000099">- ¬о-вторых, и при децимации сдвиг на децимированные 
					отсчеты примен€лс€ два раза<BR>
					- в третьих, если итоговый коэффициент оказывалс€ за пределами буфера, он 
					корректировалс€ ¬Ќ”“–» цикла - тем самым вызыва€ его прерывание<BR>
					- в-четвертых, под "триггерным" понималс€ канал 0 - в то врем€, как им €вл€етс€ 
					канал 1</FONT></STRONG></P>
		<P>Ќа насто€щий момент решена задача синхронизации с децимированным триггером. 
			Ѕеремс€ за недецимированный.</P>
		<P>21:03<BR>
			<STRONG><FONT color="#ff0066"><FONT color="#000099">- сейчас при недецимированном триггере 
						ввод вообще не идет<BR>
					</FONT></FONT><FONT color="#000099">- попытка запуска без децимации после ввода 
					с децимацией - однозначный вылет!!!</FONT></STRONG></P>
		<P>21:47<BR>
			- ¬о-первых, никакого отображени€ не было по причине nD == 0. <STRONG><FONT color="#ff0066">
					ј вот зачем вообще эта переменна€ ???<BR>
				</FONT></STRONG>- ¬о-вторых, € просто еще и забывал положить 
			недецимированное триг-значение в выходной буфер</P>
		<P> роме последнего вопроса все решено. ћоем электроды - и домой.</P>
		<P>----------------------------------------------------------------------------------------------</P>
		<P><STRONG>050426 вт<BR>
			</STRONG>(<EM>на работу пришел в час - утром шл€лс€ по лесу. Ќи одного кадра, но 
				столько слышал</EM>...)</P>
		<P>13:55<BR>
			ѕрактически точный путь к вылету: запуск с децимацией триггера, после этого - 
			выключение децимации вообще. ¬идимо, путаюсь с логикой флагов. » почему-то 
			разрешаетс€ окошко разрешени€ децимации триггера....</P>
		<P>14:25<BR>
			»зменена логика разрешени€ чекбокса (пришлось - с проверкой на существование 
			окна)<BR>
			ѕодправлена логика возвращаемого значени€ CHardDlg::GetDeciamate() - не 
			помогает :(</P>
		<P>...я предполагал, что дело - в неправильной интерпретации флагов. Ќо нет - флаги 
			(сейчас - уж точно) расставл€юст€ правильно. ќднако € €вно пихаю мимо какого-то 
			буфера :((((</P>
		<P>15:37<BR>
			” мен€ при изменении децимации не вызывалась ф-и€ пересчета буферов. (заложена 
			в изменение родительской карты). Ќо вызывалась при включении/выключении 
			децимации триггера. —оответственно, после включени€ децимации, включени€ 
			децимации триггера и выключени€ децимации € оказывалс€ с последним (маленьким) 
			буфером. ¬от и результат....</P>
		<P><FONT color="#ff0066"><STRONG><FONT color="#000099">- кнопка Decimate Trigger мигает (не 
						нужно разрешать в Enable Controls)<BR>
					</FONT><FONT color="#000099">- после выключени€ канала в родительской карте в 
						дочерних он исчезает - но остаетс€ распознаваемым в отображении....</FONT></STRONG></FONT></P>
		<P>15:58<BR>
			Ѕоротьс€ нужно не со следстви€ми (миганием кнопки), а с причиной - частыми 
			вызовами SetMode(). ј происход€т они оттого, что в сравнении участвует ѕќЋЌќ≈ 
			статусное слово - включающее в себ€ признак начала и триггер. Ќужно примен€ть 
			маску!!!</P>
		<P>16:25<BR>
			ѕрименены маски, изолирующие скорости и батарейно-CMS-ный статус. »тоги 
			сдвинуты. јлгоритм расчета режима изменен.</P>
		<P>16:48<BR>
			¬ CHardDlg заведены индикаторы BAT и CMS, соотв. ф-и€ выставлени€ цветов 
			(OnCtlColorStatic)</P>
		<P>17:21<BR>
			ѕосле некоторых мытарств индикаторы работают, как задумано</P>
		<P>17:30<BR>
			ќтправл€ю сообщени€ об изменении главной карты - только не видам, а диалогам!!! 
			“ак - проходит.</P>
		<P>18:14<BR>
			ѕрограмма отработала 45 минут - без сбоев и нарушений. Ќамечаем, что дальше<BR>
			<STRONG><FONT color="#990000">TODO:<BR>
					<FONT color="#006600">- создание нового окна в процессе ввода</FONT><BR>
					<FONT color="#000099">- сохранение параметров окон<BR>
					</FONT><FONT color="#000099">- сохранение параметров программы<BR>
					</FONT><FONT color="#000099">- правильное отображение Ext-электродов</FONT><BR>
					<FONT color="#000099">- правильный отзвон кол-ва модулей в главной карте<BR>
					</FONT></FONT><FONT color="#000099">- изменение длины окна на едит-бокс со 
					спинкотролом (от 1 секунды)</FONT></STRONG></P>
		<P>CheckIn
			<BR>
			-----------------------------------------------------<BR>
			18:35<BR>
			¬роде бы новые окна создаютс€ и начинают работать без проблем????</P>
		<P>18:44<BR>
			ћодули отзваниваютс€ правильно. <FONT color="#ff0066"><STRONG><FONT color="#000099">Ќужно 
						правильно разрешать чекбокс екстов</FONT>.</STRONG></FONT></P>
		<P>18:50<BR>
			ќткорректировано отклчюение боксо екстов.</P>
		<P>20:00<BR>
			”становлено: главную карту перекашивает после посылки главному окну сообщени€ 
			WM_DIZ_MAPCHANGED</P>
		<P>20:07<BR>
			—бой происходит после добавлени€ к списку триггерного канала</P>
		<P>20:10<BR>
			Ёто происходило из-за попытки "поправить" смещение триггерного канала....</P>
		<P>20:15<BR>
			ћожно сказать, что с кол-м модулей разобрались возвращаемс€ к вопросу об 
			екстах.</P>
		<P>20:42<BR>
			ќткорректированы оффсеты тачпруфов.</P>
		<P>21:20<BR>
			“акое впечателение, что мэпирование - поборол....<BR>
			<FONT color="#ff0066"><STRONG><FONT color="#000099">¬ылет после смены режима!!!!<BR>
					</FONT><FONT color="#000099">- сохранение параметров окон<BR>
					</FONT><FONT color="#000099">- сохранение параметров программы<BR>
					</FONT><FONT color="#000099">- изменение длины окна на едит-бокс со спинкотролом 
						(от 1 секунды)</FONT></STRONG></FONT></STRONG></FONT></P>
		<P>---------------------- чекин - домой --------------------------------</P>
		<P>---------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050427 ср<BR>
			</STRONG><EM>≈ще одна прогулка по лесу - на сей раз кого-то "настрел€л" - желта€ 
				тр€согузка, большой пестрый д€тел....</EM></P>
		<P>14:30 - 16:30<BR>
			ќтслеживал, что происходит. ѕри смене режима из CHardDlg посылаетс€ сообщение 
			WM_DIZ_CHANGEMODE. —ейчас после него делаю и обработку WM_DIZ_MAPCHANGED - все 
			равно не помогает :(((</P>
		<P>16:38<BR>
			—тоило пожаловатьс€ - и догадалс€: € кол-ва каналов переустанавливал ѕќ—Ћ≈ 
			вызова HardDlg.SetMode() - а нужно ƒќ. —ейчас определение этих переменных 
			включено и в обработку WM_DIZ_CHANGEMODE. Ќо вопрос возникает: что такое у мен€ 
			m_nChans и m_nTouch???</P>
		<P>16:45<BR>
			ƒа, m_nTouch - то, что называетс€ obsolete. —ейчас это - m_nExtChans. ј вот 
			m_nChans и m_nPinChans - вещи разные: перва€ - кол-во реально включенных (с 
			учетом кол-ва модулей) каналов, втора€ - максимально возможное дл€ режима 
			кол-во пин-каналов.</P>
		<P>16:50<BR>
			≈сли сбой произошел во врем€ активного ввода, выводитс€ сообщение об ошибке.</P>
		<P>19:09<BR>
			ѕеределана длина - теперь просто в целых секундах, без излишеств.<BR>
			<STRONG><FONT color="#000099">ѕочему-то стал неправильно отражатьс€ статус CMS</FONT></STRONG></P>
		<P>19:30<BR>
			ѕоследн€€ ошибка исправлена (€ по-другому перекосил статусное слово).
		</P>
		<P>«адача: внедрить в диалог три битмэпбаттона (сохранение, чтение и установка 
			параметров)</P>
		<P>20:30<BR>
			Ѕитмэповские кнопки в диалоге заведены.</P>
		<P>21:08<BR>
			ѕри создании диалога в него передаетс€ его номер - дл€ делени€ установок. 
			»зменени€ в конструкторе.</P>
		<P>21:32<BR>
			—деалано запоминание (пока на автомате) основных числовых парметров окон. 
			¬стают вопросы:<BR>
			<STRONG><FONT color="#cc0066"><FONT color="#000099">- нумераци€ окон (особо - в случае 
						удалени€: как-то нужно декрементирвоать счетчик???)<BR>
						- запоминание и чтение массивов (карты) и структур (биопол€ры)<BR>
					</FONT></FONT><FONT style="BACKGROUND-COLOR: #ccffcc" color="#000099">- чтение 
					дефолтов ("нулевое окно")</FONT></STRONG></P>
		<P>--------------- устал - домой ------------------------------</P>
		<P>--------------------------------------------------------------------------------------------------------</P>
		<P>050428 чт<BR>
			ѕочти два часа просидел на ‘— - а всего-то получилс€ 21 коммент... ƒа, таким 
			способом попул€рность зарабатывать мне тоже не по силам...</P>
		<P>12:44<BR>
			–ешаю вопрос о нумерации окон. ¬ очередной раз - у мен€ две функции закрыти€ 
			(вида и диалога). ќбщее и различи€???<BR>
		</P>
		<P>13:15<BR>
			‘ункции удалени€ вида и диалога приведены к общему знаменателю.</P>
		<P>13:18<BR>
			≈сли удал€етс€ последний вид, счетчик уменьшаетс€ - и новый созданный получит 
			тот же номер. ѕри удалении диалога из середины списка уменьшени€ номера не 
			происходит.</P>
		<P>13:25<BR>
			ѕеренесена домашн€€ верси€ ActD.h - с внесенными функци€ми записи и чтени€ 
			структур.</P>
		<P>13:45<BR>
			¬ картах заведены функции, дающие доступ к самой карте (дл€ чтени€ и записи); в 
			диалоге карты пишутс€ - читаютс€. Ќо! Ќе вызываетс€ обработка изменени€ 
			карты!!! - приводит к вылету.</P>
		<P>14:27<BR>
			¬се же у мен€ очень нехорошо с открытием новых окон во врем€ активного ввода. 
			ѕохоже на то, что сообщени€ к ним начинают идти до того, как окно окончательно 
			сформируетс€... ѕопытки заблокировать - тоже пока неудачи :(</P>
		<P>17:00<BR>
			ƒело оказалось в нарушении последовательности. ƒл€ правильной обработки 
			изменений в карте должна была пройти доп. инициализаци€ диалога, запускавша€с€ 
			уже после его создани€. –ешение - вынесение загрузки карты в отдельную ф-ию, 
			вызываемую из главного окна уже после прохожени€ всех инициализаций. ¬ таком 
			виде - работает, даже "на ходу".<BR>
			ƒобавлено сохранение/восстановление рефкарты.</P>
		<P>18:09<BR>
			„тобы структуру бипол€ров можно было записывать, CStringh m_strName&nbsp;&nbsp; 
			изменее на char m_czName[40]</P>
		<P>18:54<BR>
			ѕоборото сохранение/восстановление бипол€ров</P>
		<P>19:03<BR>
			«апрет на закрытие единственного вида во врем€ ввода. ƒл€ этого в классе вида 
			пришлось сказать, что сообщение обрабатываетс€ (инче все равно закрывалс€, хот€ 
			контроль - в главном окне)</P>
		<P>19:08<BR>
			«апрет на закрытие последнего диалога (здесь - уже без извращений).</P>
		<P>19:10<BR>
			ќкошко с сообщением о невозможности закрыть последнее окно</P>
		<P>21:20<BR>
			ѕосле долгих мытарств стало точно €сно: путаюсь с массивами диалогов-видов. 
			ќбрамил критической секцией - стало легчк</P>
		<P>21:35</P>
		<P>Ѕыла одна ошибка: при невозможности удалени€ вида/диалога € не покидал критич. 
			секцию. ј покидать ее надо&nbsp;- причем ƒќ вызова окошка с сообщением (иначе 
			мы останемс€ в крит. секции - и вывод затормозитьс€.). —ейчас работает, как 
			руки ни выкручивал - не убил.<BR>
			-------------------------- 21:37 -------- завершаем - домой 
			--------------------------------</P>
		<P>--------------------------------------------------------------------------------------------------</P>
		<P>050429 пт</P>
		<P>14:42<BR>
			«адание отдельного цвета дл€ фона бипол€ров.</P>
		<P>14:49<BR>
			«аливка бипол€ров отдельным цветом</P>
		<P>16:47<BR>
			Ѕьюсь с сохранением/восстановлением позиций окон. ѕолучает€, что функцию вида 
			SetPar() использовать нельз€ - она сама уже что-то предполагает и сохран€ет... 
			ѕридетс€ дублировать ее функциональность в отдельной функции.</P>
		<P>19:00<BR>
			ѕоборол сохранение положени€ окна: почему-то перед <FONT color="#000099">GetWindowRect(&amp;rcW);</FONT>&nbsp; 
			нужно было давать
			<BR>
			<FONT color="#000099">SetParent(0)</FONT>;
		</P>
		<P>21:40<BR>
			Ќачал делать диалог параметров вида. ѕосле его вызова при закрытии программы 
			регул€рно получаю ошибки :((( ”сЄ....</P>
		<P>---------------------</P>
		<P>050430 сб</P>
		<P>14:59<BR>
			продолжаю попытки разобратьс€ с замеченными вчера вылетами. ƒл€ них не нужно 
			даже открывать диалоги и проч. - отлЄты бывают просто при закрытии программы, 
			имеющей хот€ бы одно окно. ѕредположение одно: какие-то сообщени€ брод€т у мен€ 
			слишком длинными пут€ми :((( ¬от и забредают в окна уже после того, как окна 
			этого нет :(((</P>
		<P>17:25<BR>
			¬о всех случа€х ошибки возникают, когда обработка таймера вызываетс€ уже после 
			того, как была вызвана ф-и€ OnClose()... »ли же: таймер возникает раньше, 
			OnClose() прерывает его обработку... “огда надо еще какую-то крит. секцию что 
			ли???</P>
		<P>17:39<BR>
			«авел таковую крит. секцию. ¬се хорошо - только теперь запуск не проходит :)))</P>
		<P>17:50<BR>
			ј, € попросту два раза выходил из секции в OnRunGo()... —ейчас вроде как все 
			исправлено.... ј не пойти ли мне???</P>
		<P>--------------------------------------------------------------------------------------<BR>
			<STRONG>050501 вс<BR>
			</STRONG>------------- дома, ночью -------------------------</P>
		<P>01:00<BR>
			ѕри отсутствии драйверов и железа наблюдались дедлоки при выходе - € просто не 
			выходил из таймерной секции (сто€л return вместо throw). »справил, но кажетс€, 
			что временами дедлоки бывают...</P>
		<P>01:15<BR>
			¬осстановлена заливка свежесоздаваемого битмэпа вида (дабы не было пустого 
			окна)</P>
		<P>01:20<BR>
			 оррекци€ размеров восстанавливаемых окон (чтобы дочерние не выходили за 
			пределы родительского)</P>
		<P>12:49<BR>
			Ќадо избавл€тьс€ от рестартов основного таймера - у мен€ и в рабочем режиме 
			вызовы медленные... “ак что будет достаточным стартовать при запуске - и 
			останавливатьс€ при выходе...</P>
		<P>12:50<BR>
			ѕожалуй, ближайшую задачу сформулируем - на воспоминание о формировании диалога 
			свойств. —ейчас-то у мен€ лишь одна - по цветам... ј нужны будут общие 
			установки, триггера - и далее, далее, далее...</P>
		<P><STRONG>050502 пн
				<BR>
			</STRONG>снова ночью
		</P>
		<P>00:58<BR>
			ѕримитивные листочек и страничка созданы. Ќо! Ќужно еще подумать, каким образом 
			передавать установки (в случае диалога это делалось через конструктор)</P>
		<P>01:05<BR>
			ѕридумал: _Settings у мен€ все равно глобальна€ переменна€ - так что € буду 
			инициализировать наследуемый от нее класс конкретной страницы в дефолтовом 
			конструкторе. Ќужно пон€ть, как обходитьс€ с правильным запоминанием при 
			выходе....</P>
		<P>01:18<BR>
			— запоминанием тоже обошелс€ - но пока есть проблема: вообще нет выхода (в том 
			смысле, что по ќ  не выходит). ѕодумаем утром...</P>
		<P>----------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050503 вт<BR>
			</STRONG>Ќа работе: продолжаю не понимать, почему не происходит выход по кнопке 
			OK....</P>
		<P>12:51<BR>
			Ќу бред!!! ¬ыщывающа€ фунци€ ожидала булевского значени€ - и получаемые 
			возвраты интерпретировала пр€мо наоборот!!! ѕри успехе из Onapply() нужно 
			возвращать 1, при неудаче - 0 !!!</P>
		<P>12:57<BR>
			 ласс CSettingsDlg убран из проекта. ќсталась только страничка цветов, 
			сделанна€ на его основе....</P>
		<P>13:02<BR>
			¬ свойствах разрешена Apply, на странице цветов добавлены вызовы SetModify() - 
			теперь цвета можно мен€ть "совсем на лету".</P>
		<P>13:50<BR>
			Ќикак не мог считать строку из сохраненной в файле: у мен€ в классе CSettings 
			функци€ CStrings зарезервировна дл€ другого - только дл€ получени€ имени 
			файла... “огда ее нужно переобозвать!</P>
		<P>13:57<BR>
			‘ункци€ переобозвана, заведена нова€ - возвращающа€ строку. –аботает.</P>
		<P>14:40<BR>
			»справление ошибки: в главном окне не покидал таймерную критсекцию при 
			отсутствии рабочих каналов.</P>
		<P>14:47<BR>
			— изменением таймера тоже разобралс€ - анализировал не то состо€ние 
			(переустанавливать - только при уже работающем таймере!!!)</P>
		<P>15:06<BR>
			«агрузка параметров вида вынесена в отдельную функцию, с параметрами "полна€ 
			загрузка" и "секци€". ѕри инициализации диалога производитс€ неполна€ загрузка, 
			из функции LoadMap() - полна€.</P>
		<P>15:56<BR>
			¬роде бы успешно разбираюсь с сохранением и загрузкой дефолтовых параметров - 
			но обнаружено: при закрытии любого окна ввод ввообще подвисает... √де?????</P>
		<P>16:22<BR>
			ќказалось даже еще хуже: вылеты при повторных запусках. ќбъ€снение простое: 
			флаг m_bRun модифицировалс€ вне таймерной секции (соответственно, таймерна€ 
			ф-и€ получала доступ к нему до инициализации всех нужных переменных). Ќо с 
			закрытием второго окна все по-прежнему плохо :(((\</P>
		<P>16:46<BR>
			јга! ƒело оказываетс€ в ф-ии вида GetPosition(), котора€ зачем-то устанавливает 
			SetParent(0) - после этого все и плохеет. ј без этого оказываютс€ совсем не те 
			координаты....</P>
		<P>17:11<BR>
			¬роде бы что-то нащупал: парентов переставл€ть не надо, дл€ ча€лдов следует 
			сдвигать не лево-верх родител€ с поправкой на край....</P>
		<P>----------------------------------------------------------------------------------------------</P>
		<P>050504 ср</P>
		<P>ѕосле того обнаружил неполадки с закрытием окон - то подвиснет, то хрюкнет... 
			—тал разбиратьс€, расставл€ть крит. секции - начались дедлоки :((( 
			ѕереставл€л&nbsp;так, иначе - ну и соответственно глючило так или иначе. ¬ 
			конце концов просто отрубил запуск главного таймера - чтобы этот поток в дело и 
			не вмешивалс€. ќказалось, что и оно не помогает!!! “о есть даже без 
			вмешательства таймера с закрытием окон все равно беда :((((</P>
		<P>ѕохоже, что дело в самом алгоритме закрыти€-удалени€. ѕолуча€ в виде сообщение 
			WM_CLOSE, € пощу соотв. (свое) сообщение в главное окно, и дальше вс€ работа 
			ведетс€ уже от его имени (то есть - силами главного потока приложени€). » этот 
			же поток удал€ет окно - но создано-то оно было своим граф. потоком!!! ј в 
			справке €вно написано: удал€ть окно из другого потока нельз€!!! » вообще лучше 
			всего, чтобы удал€лось оно само (по завершении потока).... ¬ общем, нужно 
			редезайнить...</P>
		<P>ƒумал об этом по дороге домой, что-то пробовал дома. Ќо там картина друга€: не 
			исключено, что вмешиваетс€ разница между одно- и многопроцессорными машинами 
			(таки здесь есть возможность одновременного выполнени€ двух потоков).</P>
		<P>„то интересно: "домашн€€ верси€" (от 2 ма€) таких проблем с закрытием окна не 
			испытвает - но там полно других проблем: при закрытии второго окошка зависает 
			(и напрочь) ввод, да и программа при закрытии виснет глухо...</P>
		<P>16:15<BR>
			«начитс€ так.
			<BR>
			<STRONG><FONT color="#000099">- ѕри закрытии вида (CActDView::OnClose) ничего не делаем 
					- только отсылаем сообщение главному окну<BR>
					- √лавное окно в функции CMainFrame::OnViewClose провер€ет наличие данного вида 
					и возможность удалени€ (запрет на удаление последнего вида) - и вызвает функцию 
					RemoveOsc<BR>
					- функци€ CMainFrame::RemoveOsc(int idx) удал€ет вид и диалог из списков - и 
					удал€ет диалог командой
					<BR>
					delete m_arpDialog[idx];<BR>
					- в деструкторе диалога (CDlgView::~CDlgView() )<BR>
					&nbsp; - сохран€ютс€ установки<BR>
					&nbsp; - разрушаетс€ окно<BR>
					&nbsp; - посылаетс€ сообщение граф. потоку на его закрытие
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
					::PostThreadMessage((DWORD)m_pThread-&gt;m_idThread,WM_QUIT,0,0 );<BR>
					&nbsp; - ∆ƒ≈ћ «ј¬≈–Ў≈Ќ»я ѕќ“ќ ј !!!!!!!!!!! (здесь-то и была ошибка!!!)<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
					WaitForSingleObject(m_pThread-&gt;m_hThread,INFINITE);<BR>
					&nbsp; - удал€ем поток<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete m_pThread;</FONT></STRONG></P>
		<P>¬ таком режиме не только не отмечено зависаний и вылетов - но и нет утечек 
			пам€ти!!!</P>
		<P>16:26<BR>
			ƒл€ унификации: диалог при нажатии кноки Close посылает то же сообщение, что и 
			вид!
			<BR>
			‘ункци€ OnDlgClose и соотв. дескрипторы команд из главного окна удалены!!!</P>
		<P>16:48<BR>
			»справлена ошибка в CDlgView::PreTranslateMessage, из-за которой диалог 
			фильтровал все нажати€ клавиш. “еперь акселераторы работают всегда</P>
		<P>===================== CheckIn ==========================================</P>
		<P>17:15<BR>
			¬ диалоге параметров вида - чекбокс SaveOnClose и кнопка SaveNow, их правильное 
			обслуживание (именованные пока трогать не будем)</P>
		<P>17:20<BR>
			¬ отображении - убраны отладочные точки по кра€м ломаных<BR>
			<BR>
			Ќа повестке дн€:<BR>
			<STRONG><FONT color="#990066"><FONT color="#000099">- диалог отображени€ триггерного канала 
						(цвета, инвери€)<BR>
					</FONT></FONT><FONT color="#000099">- диалог сохранени€, чтени€ параметров инд. 
					окон и программы в целом<BR>
					- диалог параметров ввода (свободный, гейтед, триггеред)</FONT></STRONG></P>
		<P>19:54<BR>
			¬ основном построен диалог отображени€ триггерного канала.
		</P>
		<P>20:28<BR>
			ƒиалог отображени€ тригканала проинтегрирован с классом CSettings (как 
			дружественный класс, сохранение - вместе с цветами)</P>
		<P>20:38<BR>
			¬ид считывает триггерные установки.
		</P>
		<P>20:42<BR>
			ѕолностью убраны упоминани€ об "инверсии триггера" - теперь все заменено на 
			маску.</P>
		<P>00:31<BR>
			ѕопытки запустить дома: во-первых, обнаружена кака€-то разница в CViewSettDlg - 
			на флешке нет последней версии. » дома тоже!!! ???</P>
		<P>¬о-вторых, релиз-сборка все равно отлетает. ѕо всей видимости, нецензурно 
			формируетс€ SetMode...</P>
		<P>01:09<BR>
			ѕерва€ проблема с релизом ликвидирована: при установке в "выключено" в actMode 
			не инициализировалось количество пин-каналов nPinChans!!! ќсталась проблема с 
			открытием нового окна...</P>
		<P>01:28<BR>
			¬тора€ часть проблем лежит где-то в районе загрузки параметров осцокна....</P>
		<P>----------------------------------------------------------------------------</P>
		<P>050505 чт</P>
		<P>11:54<BR>
			”брана ставша€ пустой ф-и€ CDlgView::LoadMap()</P>
		<P>12:06<BR>
			ѕочему-то не перенес из дома изменени€ в actMode (обунуление пин-каналов).   
			тому же здесь все равно в релизе отлетало - нужна задержка между USB_WRITE и 
			CLOSE_DRIVER</P>
		<P>12:14<BR>
			ƒа, вчера € действительно переписал не все файлы. ѕоложил в "нулевую папку". 
			–елиз-сборка работает: возможно, проблемы у мен€ с домашней конфигурацией, так 
			что нужно провер€ть проверку загружаемых параметров :)))<BR>
		</P>
		<P>12:39<BR>
			Ќет, отлеты все-таки есть - если нет драйверов, вылетаем при открытии нового 
			окна....</P>
		<P>13:44<BR>
			ѕохоже, что дело обсто€ло так: бокс с сообщением об отсутствии драйверов € 
			выдавал ƒќ запуска основоного потока приложени€ - и в итоге просто не успевал 
			отследить соотв. сообщение в CMainFrame::PreTranslateMessage. ѕосле переноса 
			окошка в CMainFrame::OnCreate похоже что все работает.</P>
		<P>14:00<BR>
			ƒл€ правильной работы и открытие окна нужно производить после проверки на 
			наилчие драйверов!!!</P>
		<P><BR>
			++++++++++++++++++++ чекин ++++++++++++++++++++++</P>
		<P>14:56 (ѕосле извести€ о прин€тии статьи в Neuroscience Letters)<BR>
			ѕо итогам размышлений:<BR>
			- никакого открыти€ окон при запуске программы и соотв. флага не надо, нужна 
			будет отдельна€ кнопка, "загружающа€ сессию" (именованную или нет???)<BR>
			- флаг сохранени€ параметров окон тоже не нужен - пущай себе сохран€ют. ≈сли не 
			загружать, то это никому и не помешает<BR>
			¬несены соотв. изменени€ в диалог, проверена его работоспособность.</P>
		<P>15:20<BR>
			–еализована загрузка параметров окон - дефолтова€ или индивидуальна€.</P>
		<P>15:40<BR>
			√рузим главную карту</P>
		<P>16:32<BR>
			«агрузка главной карты и основных параметров программы работает.  акие-то глюки 
			с загрузкой бипол€ров...</P>
		<P>16:52<BR>
			ѕопутно вы€снил что € не сохран€л (и не читал) флаг индивидуальной загрузки 
			параметров окон... »справлено..<BR>
			— бипол€рами немножко разобралс€ (при загрузке не восстанавлива "нулевую" 
			строчку) - но не совсем пон€тно, как быть в случае отключени€ от ввода 
			назначенного на пару канала....</P>
		<P>18:56<BR>
			ƒиалог установки значений и цветов дл€ смещений, сохранение этих параметров</P>
		<P>19:25<BR>
			ѕределы и смещени€ учитываютс€ при отрисовке</P>
		<P>+++++++++++++++++ чекин +++++++++++++++++++++++</P>
		<P>20:00<BR>
			»зменена логика открыти€: файловые команды помечены как недоделанные, нова€ 
			кнопка ID_OSC_NEW открывает новый осциллоскоп, запуск разрешен при полном 
			отсутствии окон, в этом случае при запуске открываетс€ новый осциллоскоп.</P>
		<P>20:04 - соотв. команда в меню</P>
		<P>20:14<BR>
			 оманда принудительного задочивани€ и каскадировани€ всех открытых окон.</P>
		<P>20:20<BR>
			Ќачато формирование триггерного диалога<BR>
			21:41<BR>
			“риггерный диалог в основе своей нарисован. “еперь нужно еще кое-что подправить 
			- и прописать.... Ќо - уже дома: пора. “ретий чекин<BR>
			+++++++++++++++ чекин +++++++++++++++++++++++</P>
		<P>050506 пт<BR>
			ƒома до половины второго ночи переименовывал контролы триггер-диалога - 
			вручную, в фаре. „тобы было удобнее составл€ть массивы. —ейчас (уже на работе) 
			кофе попью и займусь - группами и алгоритмами их включени€/выключени€....</P>
		<P>14:30<BR>
			ƒиалог по части многочисленных чекбоксов ведет себ€ нормально. ’отел сделать 
			боксики цветными - но не получаетс€: не посылают они соотв. сообщений. “о бишь 
			если хочетс€, то нужно будет пускатьс€ в OWNERDRAW - но это как-нибудь потом<BR>
			<STRONG><FONT color="#000099">- чтение и сохранение параметров<BR>
					- обрабока едит-контролов<BR>
				</FONT><FONT color="#000099">- запрет страницы во врем€ ввода</FONT></STRONG></P>
		<P>15:17<BR>
			ѕри активном вводе триггерна€ страница просто удал€етс€.</P>
		<P>16:54<BR>
			«аокнчено сохранение параметров</P>
		<P>17:28<BR>
			—делана обработка едит-контролов. ѕора пообедать :)))</P>
		<P>20:42<BR>
			«алез в CMapDlg - а там нехорошо... ѕервичную инициализацию подправил - но вот 
			цвета нормально отображать все равно не получаетс€... Ѕог с ним.<BR>
			—делал загрузку имен каналов из биосеми-файла - в CMapDlg</P>
		<P>20:50<BR>
			«агрузка имен каналов из меню.</P>
		<P>21:10<BR>
			јвтозагрузка имен каналов из моего конффайла.</P>
		<P>21:41<BR>
			¬ывод имен электродов в карте.<BR>
			++++++++++++++++++++++++++++ чекин - домой ++++++++++++++++++++++++++++<BR>
			ƒома<BR>
			00:34<BR>
			¬ диалоге смещений исправлен пор€док обхода</P>
		<P>00:44<BR>
			‘ункци€ Find() и макрос SIZE перенесены в глобальные - много где нужны</P>
		<P>00:56<BR>
			¬ диалог смещений добавлена обработка EnKillFocus, доработано поведение в 
			ошибочных ситуаци€х (возврат к старому значению)</P>
		<P>00:59<BR>
			¬ обеих верси€х чтени€ списка имен к маскам добавлены все файлы.</P>
		<P>---------------------------------------------------------------------------------------</P>
		<P>050507 сб</P>
		<P>10:50 ѕеренесены изменени€ из дома</P>
		<P>11:00<BR>
			ѕередача адреса имен каналов в карты диалогов</P>
		<P>11:10<BR>
			ѕередача адреса имен каналов в карты бипол€рного диалога</P>
		<P>11:25<BR>
			ѕрограмма запускаетс€ на вар€гинском компьютере. Ќехорошо с дефолтовыми 
			парметрами окна.</P>
		<P>11:38<BR>
			ѕараметры приведены в какую-то норму....
			<BR>
			--------------- чекин----------------------------------------</P>
		<P>13:12<BR>
			¬ывод имен каналов на график</P>
		<P>13:20<BR>
			 лючевой момент!!! ѕ–оверка на ноутбуке!!! –аботает</P>
		<P>13:40<BR>
			—окартил битмэп на 50 пикселов (имена каналов вывод€тс€ отдельно).  оррекци€ 
			размеров главных диалогов</P>
		<P>14:00<BR>
			Ќет, сделаем так: посто€нна€ граница окна (дл€ меток) - 30 пикселов, но в то же 
			врем€ ширина битмэпа - 60; длинные метки будут мигать; заполнение - правильным 
			фоновым цветом.<BR>
			--------------------------- чекин ------------------------</P>
		<P>14:30<BR>
			»справлена ошибка в заполнении имен бипол€ров.<BR>
			Ќа ноутубке, при открытии в релизе большого количества осциллов и закрытии 
			прогарммы (без запуска) - вылетели :((((</P>
		<P>------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>17:45<BR>
				Ќаписан документ, программа в его сопровождении послана to Coen Metting 
				VanReign</STRONG></P>
		<P>----------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050511 ср</STRONG></P>
		<P>¬ыходные прошли в перекопке заболоченного огорода - и в ожидании ответа от 
			 оуэна. “€желое это дело - ждать... Ѕыло даже отча€лс€ - но сегодн€ утром ответ 
			пришел. » хорошо, что сегодн€ - на возникшие вопросы € бы из дома ответить не 
			смог. —ейчас ответил (похоже, € просто не дал нужных инструкций), поулчил 
			подтверждение - будем ждать, что скажут дальше. Ќо просто ждать нельз€ - нужно 
			продолжать....</P>
		<P>»так, вопрос с триггером:<BR>
			- ¬озможно, понадобитс€ сборка битов в слове не только по "OR", но и по "AND" 
			???<BR>
			-  ак должна происходить сама обработка заданных тригпараметров???</P>
		<P>≈сли учесть, что провер€тьс€ должно каждое значение триггра, основной задачей 
			становитс€ максимальное упрощение-ускорение этой процедуры - дабы зр€ врем€ не 
			занимать. ƒл€ этого предлагаю: начинать с анализа произошедших изменений:
			<BR>
			- отмечать наличие&nbsp;изменений в тригканале,&nbsp;вставшие и упавшие биты<BR>
			- если изменени€ обнаружены, анализировать их релевантность: провер€ть гейтовые 
			услови€, а затем - собственно триг.<BR>
			- видимо, и дл€ "свободного" режима нужны "триг-услови€" - чтобы можно было 
			запустить/остановить запись посылкой соотв. триг-слова.</P>
		<P>20:12<BR>
			Ќе слишком бодро, но начал таки развлекатьс€ с битами триггера (NB! ” них 
			все-таки единица - вверху, то есть разомкнута!!!) - но прервалс€, решив 
			добавить контрол дл€ редактировани€ "спецсимволов". » вот тут-то и завис - не 
			доход€т до диалога никакие PreTranslateMessage :(((</P>
		<P>ѕравда, попутно подправил поведение по Return и KillFocus в CAcqTrigDlg - теперь 
			в случае неудач возвращают предыдущее значение.</P>
		<P>–азобралс€ лишь сейчас - путем ѕ–ј¬»Ћ№Ќќ√ќ наследовани€ собственного класса 
			контрола и подключением его в карту через DDX_CONTROL....</P>
		<P>20:22<BR>
			ƒа нет, DDX необ€зательно - достаточно subclass....</P>
		<P>21∆25<BR>
			ѕоведение вынесенного в отдельный класс контрола вроде бы доведено почти до 
			ума: только вот продолжает бр€кать по сиске€м - и западают шифты-контролы при 
			переходе на другое окно (нужно очищать при активищации)</P>
		<P>---------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050512 чт</STRONG></P>
		<P>13:06<BR>
			“аки возможность претранслировать системные сообщени€ (чтобы точно 
			зафиксировать клавиши) мне не давала поко€. ƒолго копалс€ по и-нету, пока не 
			нашел в €вном виде высказывани€ о возможность фильтров только дл€ немодальных 
			диалогов. —делал свои свойства немодальными (похоже, что в WTL на тему ошибки - 
			методы класса пришлось переписать.) - указатель, как член класса CMainFrame, 
			лист создаетс€ по первому запросу и существует все врем€ - лишь скрываетс€ по 
			командам закрыти€. –азумеетс€, нужно о многом не забывать (уничтожать при 
			закрытии главного окна; фильтр удал€ть тоже только если родительский цикл еще 
			есть (его может и не быть) - и проч. проч...)</P>
		<P>ѕока оставлю так (включа€ спецконтрол) - но далее все клавиши нужно будет 
			вынести на отдельную страницу свойств - и пусть редактируют....</P>
		<P>13:30<BR>
			ƒополнительные телодвижени€ все по поводу тех же свойств: восстановление 
			активной страницы свойств и сн€тие с нее флага модификации. (почему-то это 
			оказалось нужным)</P>
		<P>13:35<BR>
			¬идимо, мне еще придетс€ предпринимать определенные усили€, чтобы системные 
			клавиши хучились лишь тогда, когда активна (и видима) соотв. страница.</P>
		<P>13:50<BR>
			ƒумаем на тему, что в каких ситуаци€х делать с тригканалом<BR>
			- Free acquisition - наверное, здесь все-таки нужно будет два триггерных слова: 
			дл€ запуска записи - и дл€ ее окончани€. “огда провер€ем эти слова??? Ќаверное, 
			там нужен будет еще и "паузный гейт"<BR>
			- Gated - провер€ем состо€ни€ гейтов (начина€ снизу, при наличии соотв. And)<BR>
			- Triggered - провер€ем наличие гейтов, потом - триггер....</P>
		<P>–езультатом проверки должен €вл€тьс€ некий флаг, доступ к которому будет 
			возможен не только из блока проверки триггера - но и из команд меню (шоткатов)</P>
		<P>ƒл€ такого поведени€ понадобитс€ соотв. модификаци€ диалога. „тобы не рисовать 
			много чего лишнего, лучше будет "переобозвать" соотв. переменные - и 
			перенаправл€ть результаты в другие переменные...</P>
		<P>“аким образом, единственным "выключаемым" в диалоге становитс€ “риггер в режиме 
			1 (Gated).  роме того, в "свободном" режиме выклчюаетс€ And0 - а также мен€ютс€ 
			тексты.</P>
		<P>14:37<BR>
			ѕродолжаю перерисовывать диалог. Ќет, даже так: в свободном режиме всегда 
			разрешены три группы - два триггера и "Gate condtition" (бывша€ And1)</P>
		<P>14:52<BR>
			ѕоведение диалога вроде бы сделал. Ёх, только представить себе, как мне это 
			придетс€ описывать... ƒа еще по-аглицки.... “еперь не худо было бы "развести" 
			переменные.... ƒл€ этого "непосредственные операции" должны осуществл€тьс€ не с 
			самими массивами - а с их адресами...</P>
		<P>15:46 CAcqTrigDlg<BR>
			јдреса массивов заведены и обрабатываютс€. Ќужно их переключать при 
			переключении режимов - и обновл€ть содержимое соответственно....</P>
		<P>16:03 CAcqTrigDlg<BR>
			¬роде бы переключени€ сделаны....</P>
		<P>---------------------------------------------------------------------------------------------------<BR>
			<STRONG>050513 пт</STRONG></P>
		<P>¬ полночь запостил з€блика - ну и как всегда врем€ ушло на отслеживание 
			комментариев :((( » мозги - тоже. Ѕудем вспоминать, на чем остановились:</P>
		<P>ћне нужно отработать переход от логики триггера к логике собственно записи. — 
			учетом того, что на запись оказывает вли€ние не только триггер - но и разные 
			там нажатые кнопки, команды меню....</P>
		<P>18:00<BR>
			ƒовольно долго маюсь с двум€ ф-ми - подготавливающей и отслеживающей. «апуталс€ 
			с итерацией (получилось [2-1] вместо [2-i]), в ходе экспериментов пон€л, что 
			выставл€ть "сверхстарший байт" мне нужно только в том случае, когда ќЅј слова 
			(верхнее и нижнее) нулевые - и тогда можно это делать лишь в одном слове...</P>
		<P>—ейчас нужно придумать, каким образом в случае чистых гейтов возвращать ноль, 
			если сами гейт-услови€ не изменились....</P>
		<P>18:31<BR>
			Ќет, лучше будет разделить "хардовые" и "логические" дела. ’от€.... ј не 
			построить ли мне общую карту валидных битов????</P>
		<P>18:39<BR>
			ƒа, с маской все выгл€дит логичнее<BR>
			ћен€ смутило отсутствие сообщени€ о включении гейта в тригрежиме - но его вроде 
			и не должно быть? ¬едь в этом случае гейт только регулирует видимость 
			стартового триггера??</P>
		<P>Ќу а что тогда дл€ старт-стопа? ”гу, в старт-стопе конец гейта должен означать 
			то же, что и стоптриггер....</P>
		<P>19:27<BR>
			Ќет, но тогда...<BR>
			≈сли отсутствие гейта означает то же, что пауза записи, то оно не должно 
			преп€тствовать распознаванию триггера. “о есть может возникнуть ситуаци€, когда 
			измен€ютс€ одновременно оба параметра.... Ќо тогда и возвращать нужно нечто 
			более сложное :(</P>
		<P>21:22<BR>
			ќчистка ненужных битов и сравнение со старым триггером вынесены за вызов ф-ии - 
			незачем лишнюю работу на каждом слове делать!</P>
		<P>------------------------------------------------------------------------------------</P>
		<P><STRONG>050514 сб</STRONG></P>
		<P>ѕо дороге домой продумал еще раз: нет, полностью дублировать "гейт-паузу" и 
			запись в файл - нехорошо. ”добнее - переключитьс€ в тестовый режим (с запретом 
			записи), и в нем иметь возможность еще раз посмотреть, как триггера-гейты 
			работают.</P>
		<P>¬ этом случае - нужна ли в тригрежимах информаци€ о включении гейта? ƒл€ самой 
			функциональности - вроде бы нет (если триггер пришел - значит гейт включилс€). 
			Ќо дл€ отображени€ соотв. кнопки - хорошо бы ее иметь. “о есть если и гейт 
			включилс€, и триггер пришел - ничего лишнего не надо (наружный модуль и сам 
			сможет догадатьс€, что гейт включен - иначе и триггера бы не было). ј вот если 
			просто включилс€ гейт?&nbsp; ј если он уже был включен и осталс€ включенным? 
			ѕохоже, что мне остаетс€ только один вариант: в обоих случа€х возвращать сигнал 
			включени€ гейта - а там уж пусть вызывающий модуль разибираетс€, имело ли место 
			изменение состо€ни€. “ем более, что оно все равно зависит не только от 
			тригхарда - но и от софтовых кнопок.</P>
		<P>15:23<BR>
			«авел массив (CSimpleArray), в который будут складыватьс€ результаты обработки. 
			Ќо ведь нет! я должен помещать в него не адрес входного буфера (он дл€ 
			дальнейшей работы абсолютно безразличен) - а точку выходных буферов. ѕричем - с 
			возможной коррекцией дл€ случа€ фильтрации-децимации...</P>
		<P>--------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050516 пн</STRONG></P>
		<P>»так, вне зависимости от того, буду ли € обрабатывать тригканал (с точки зрени€ 
			поиска триггера) перым или последним, в этот момент € буду иметь информацию 
			только о нем. ћожно, конечно, обработать его сначала, поскладывать смещени€ 
			входного буфера - но тогда придетс€ их очень много раз провер€ть... —лишком 
			нехорошо.</P>
		<P>’очу попробовать так:<BR>
			- в момент синхронизации выходного буфера (StoreW()) получать информацию о его 
			текущем положении (эта информаци€ будет разной дл€ каналов с разной децимацией 
			- а в пределе вообще своей дл€ каждого канала; тогда становитс€ более чем 
			резонной обработка тригканала в последнюю очередь). ѕри обработке тригканала, 
			независимо от того, есть ли децимаци€ вообще и децимируетс€ ли тригканал в 
			частности, проходить ¬—≈ ветки обработки с наращиванием соотв. счетчиков - и на 
			выходе получать ѕј–” значений (в простом случае децимации/не-децимации,&nbsp; в 
			дальнейшем значений может быть больше) - и пл€сать уже по ним....</P>
		<P>11:43<BR>
			- перед началом обработки тригканала запоминаем нужное тригслово (а то может 
			быть изменено)<BR>
			- сам вызов дл€ проверки триг-изменений - ѕќ—Ћ≈ прохождени€ прочих проверок 
			(чтобы иметь нужные счетчики)</P>
		<P>12:53<BR>
			Ќу, выходной массив тригкоманд € вроде бы сформировал (хот€ и не провер€л). 
			 акие же у мен€ есть варианты действий:<BR>
			- nTAns &lt; 0 - преркращение записи: ≈сли запись идет, остановить ее по 
			окончании очередного фрейма. ≈сли записи нет - просто изменить состо€ние кнопки 
			"пауза"<BR>
			- nTAns&nbsp; = 1<BR>
			&nbsp; - ≈сли запись идет, ничего и не делаем<BR>
			&nbsp; - ≈сли записи нет, и ввод по триггеру - ничего не делаем<BR>
			&nbsp; - ≈сли записи нет, и ввод гейтовый - начинаем запись<BR>
			- nTAns = 2<BR>
			&nbsp; - ¬ состо€нии "пауза" - ничего не делаем<BR>
			&nbsp; - ≈сли паузы нет, начинаем очередной ввод по триггеру</P>
		<P>13:08<BR>
			«аведена кнопка "пауза" и ее обработка</P>
		<P>13;17<BR>
			ќбработка кнопки "пауза" по значени€м тригканала</P>
		<P>13:57<BR>
			¬се же за счет двойственности управлени€ у мен€ по€вл€етс€ неоднозначность: 
			если пауза в тригрежиме была включена кнопкой, триггер все равно будет 
			приходить - и € никак не узнаю, был ли включен гейт или нет... “о есть у мен€ 
			по€вл€етс€ единственный (!!!???!!!) случай двойного возврата - одновременный 
			триггер и включение гейта. Ќо тогда € могу и завести еще одно - двойное - 
			значение! ѕопробуем...</P>
		<P>14:24<BR>
			¬роде бы так: завел доп. проверку на ¬ Ћё„≈Ќ»≈ гейтов - и оно добавл€етс€ к 
			возвращенному триггеру. “огда при одновременном включении триггера и гейтов € 
			получаю значение 3 - и выключаю паузу. Ћюбопытное дополнение: в этом случае 
			включение "еще одного гейтсигнала" (ежели их больше одного) приведет к 
			включению гейта!!! - то есть пересилит вручную включенную паузу.</P>
		<P>14:38<BR>
			¬роде бы так - но мне пока сложно сказать, насколько оно работает: нужны 
			гораздо более хитрые тесты (без неизбженого дребезга от используемого сейчас 
			гвозд€ - придетс€ еще писать программку, котора€ бы напр€мую на джине нужные 
			биты дергала....)</P>
		<P>14:53<BR>
			 аковы же варианты собственно записи?<BR>
			- √ейтрежим<BR>
			&nbsp; - записи нет<BR>
			&nbsp;&nbsp;&nbsp; - гейт влкючилс€ - начинаем<BR>
			&nbsp;&nbsp;&nbsp; - гейт выключилс€ - ничего<BR>
			&nbsp; - запись есть<BR>
			&nbsp;&nbsp;&nbsp; - гейт включилс€ - ничего<BR>
			&nbsp;&nbsp;&nbsp; - гейт выключилс€ - заканчиваем<BR>
			- “ригрежим<BR>
			&nbsp;&nbsp;&nbsp; - независимо от того, есть запись или нет, анализирую 
			разницу во времени от предыдущего триггера и,
			<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; если она удовлетвор€ет&nbsp;&nbsp;&nbsp; 
			услови€м, начинаю новую запись. ¬ыключение гейта вли€ет только на распознавание
			<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; очередного триггера<BR>
			- свободный режим<BR>
			&nbsp;&nbsp; ????????</P>
		<P>ѕолучаетс€, что мне нужно три независимых флага:<BR>
			- m_bRecording<BR>
			- m_bNeedStart;<BR>
			- m_bNeedStop;</P>
		<P>„то из себ€ представл€ет собственно запись? ѕолучив команду m_bNeedStart, 
			начинаем с указанной точки строить файловые буфера - они-то как раз должны быть 
			строго определенной длины. ƒалее:<BR>
			- если свежие данные закончились, а буфера не заполнены, сохран€ю флаг 
			m_bRecording<BR>
			- когда буфера заполнены,&nbsp;записываю их в файл и<BR>
			&nbsp; - при тригвводе сбрасываю флаг m_bRecording<BR>
			&nbsp; - при гейтвводе начинаю копить буфера заново - но только если не было 
			флага m_bNeedStop<BR>
			&nbsp; - при гейтвводе и установленном флаге m_bNeedStop - сбрасываю флаги 
			m_bRecording и m_bNeedStop</P>
		<P>Ќо вот какими средствами при этом обеспечивать перекрывающийс€ ввод???</P>
		<P>16:08<BR>
			Ќаверное, даже и в "неперекрывающемс€" случае файловые буфера должны быть 
			отдельными объектами - дл€ обеспечени€ одновременных записи в файл и заполнени€ 
			буфера.&nbsp;“огда разница между&nbsp;перекрывающимс€ и неперекрывающимс€ 
			режимами заключаетс€ в том, что в первом случае заполн€етс€ один буфер, а во 
			втором нужно заполн€ть сразу много... Ќе заполн€ть&nbsp;€ не могу - реальна€ 
			запись в файл поступивших данных может пойти только после того, как 
			будут&nbsp;получены ¬—≈ данные....</P>
		<P> о&nbsp;всему прочему, буфер этот не так прост...&nbsp;он<BR>
			- может состо€ть из 24-битных (3-х байтных) значений<BR>
			- может иметь дополнельный канал Anntotations (for BDF+)<BR>
			-&nbsp;может (???) представл€ть собой смесь из 16-битных (триггер) и 24-битных 
			каналов....</P>
		<P>Ќачинать, видимо, € буду с "простого" варианта - 24-битных каналов....</P>
		<P>----------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050517 вт</STRONG></P>
		<P>“ак за весь вечер ничего путного в голову и не пришло... ѕыталс€ думать по 
			дороге домой, по дороге на работу... ќсновной вопрос: что же делать с 
			возможностью перекрывающегос€ ввода? Ќи в гейтовом, ни в "свободном" варианте 
			такого быть не может - и там все просто: завожу два буфера, пишетс€ всегда в 
			один из них... » всЄ. &nbsp;Ќиаких проблем не возникнет и в "нормальном" 
			триггерном варианте - когда следующий триггер приходит уже после окончани€ 
			обработки текущего фрагмента. Ќу а если нет?</P>
		<P>–ассматривал варианты:<BR>
			- множественность буферов записи. ќсновной минус: при многочисленных триггерах 
			нужно писать сразу во много мест<BR>
			- ќтдельные канальные буфера увеличенной длительности, запись в файл ведетс€ 
			поканально. ћинус: при большом количестве каналов сама операци€ "запись" может 
			стать невыносимо задумчивой<BR>
			- “о же, что в предыдущем - но при окочнательной записи данные перекидываютс€ в 
			"правильный" буфер. ћинус - неэлементрана€ операци€ переброски</P>
		<P>ћен€ еще довольно сильно тормозило то, что один раз эта задача €вно была решена 
			(последн€€ верси€ dERP позвол€ла записывать фрагменты с перекрытием) - но € 
			совершенно не помнил как. —мотрел версию, хран€ющуюс€ на ноутбуке - и ничего 
			там не нашел. » только сейчас сн€л последнюю версию (20030703 дл€ RunThrd.cpp) 
			с компа DAQ - так вот там заведено 8 (!!!) буферов - и при необходимости запись 
			ведетс€ в несколько сразу. ѕосмотрим, как это было сделано...<BR>
			&nbsp; ѕосмотрел. Ќе могу сказать, что мне все пон€тно. Ќекий флаг используетс€ 
			- €вно как обозначение дл€ "свободности"/зан€тости очередного буфера (если он 
			ненулевой - данному буферу еще нужны данные; если же нулевой - в него можно 
			направл€ть новый ввод). Ќо при этом € сейчас никак не могу согласитьс€ с тем, 
			как он считываетс€: после того, как € начинаю ввод в один буфер, € ј¬“ќћј“ќћ 
			перехожу на следующий - и объ€вл€ю его свободным. „то может привести к ситуации 
			"перекоса" (если на самом деле этот буфер еще не был освобожден). Ќет, сейчас 
			бы € поступил так: на следующий буфер переходил (если он все равно есть - чего 
			экономить), но флаг обнул€л только после того, как запись будет завершена. “о 
			есть в случае прихода очередного триггера провер€етс€ флаг текущего буфера и, 
			если он ненулевой (буфер еще не освободилс€) - просто пропустить данный 
			триггер. Ќу и буферов возмьму поменьше... —кажем, 4 штуки - дл€ общих задач 
			должно хватить.</P>
		<P>15:15<BR>
			¬ первом приближении создал класс дл€ int24</P>
		<P>16:13<BR>
			¬ классе файла € завожу четырехкратный буфер, но к каждому буферу мне еще нужны 
			будут добавки: помимо флага свободности и "базового" адреса соотв. участка 
			буфера мне нужны будут еще 4 копии канальных массивов.... “о есть нет, 
			главный-то канальный массив может оставатьс€ одним - мне просто нужно дл€ 
			каждого "подбуфера" иметь "локальные счетчики" - ведь они у мен€ получаютс€ по 
			каждому каналу свои...</P>
		<P>16:43<BR>
			ј как же все это будет происходить? –ешив, что нужно что-то писать, € отправл€ю 
			классу файла соотв. сообщение, содержащее адрес массива каналов. ƒалее файл 
			разбираетс€ сам:<BR>
			- нужно начать новую запись<BR>
			- нужно продолжать писать<BR>
			- нужно дописать текущий фрейм - и закончить запись</P>
		<P>ѕризнаком того, что должна быть начата нова€ запись, €вл€етс€.... ј что может 
			€вл€тьс€ таковым признаком? ‘лаг зан€тости текущего массива не проходит - его 
			установленность может означать и то, что новую запись начать нужно - но никак 
			не возможно. “о есть нужен еще один флаг (общий) - текущего ввода.</P>
		<P>’орошо, получил € в качестве параметра адресс вектора рабочих каналов. ¬ 
			соответствии с результатми анализа триггера и кнопок решил, что писать - нужно 
			(или мне это тоже передавать в параметрах сообщени€? ¬едь таковые сообщени€ 
			л€гут в очередь...)
		</P>
		<P>ќй, еще более нет: вторым параметром сообщени€ станет адрес вектора, 
			сохран€ющего результаты анализа триггера (угу. ј кнопки мне как туда 
			складывать?)</P>
		<P>Ћадно, потом. Ќо в общем, у мен€ будет информаци€ о:<BR>
			- текущих Ќј„јЋј’ канальных буферов<BR>
			- смещении в этих буферах, с которого нужно начинать запись<BR>
			- количестве поулченных данных
		</P>
		<P>я начинаю заполн€ть текущий файловый буфер, и...<BR>
			- дохожу до конца буфера (а входные данные еще есть)<BR>
			- дохожу до конца входных данных (а буфер еще не заполнен)</P>
		<P>¬о втором случае пон€тно: флаг "сейчас пишем" остаетс€ сто€ть - а поканальные 
			счетчики приобретают соотв. значени€.
			<BR>
			¬ первом случае заполненный буфер должен быть отправлен на собственно запись (и 
			отображение в снап-окна), после чего нужно либо<BR>
			- закончить запись (обнулить соотв флаг) - в случа€х, если кончилс€ триггерный 
			участок или был получен сигнал о конце гейта<BR>
			- переключитьс€ на следующий буфер - и заполн€ть его (если гейт продолжает быть 
			открытым)</P>
		<P>Ќо вот каким образом "продолжать в следующем буфере"? ћне нужно будет либо 
			запоминать итоговую позицию по каждому каналу - либо и сами переключени€ 
			осуществл€ть многократно (дл€ каждого канала). Ќе проще ли будет сделать второе 
			- тем более что речь идет только о "непрерывных" режимах?</P>
		<P>ƒалее, случай с множественными триггерами: пришел один, начали писать первый 
			буфер, не закончили - а уже пришел второй, пишем и следующий - и тоже не 
			закначиваем.. —ледовательно, каждый раз, получа€ "свежую посылку", € должен 
			буду перебирать все четыре буфера и провер€ть - ждет ли какой из них еще 
			данных. ј получив "свежий триггер", оп€ть же перебирать все - и определ€ть, 
			есть ли свободный. ≈сли же его нет... ќтказыватьс€? »ли все же заводить еще 
			один (то есть - делать массив динамическим)?
		</P>
		<P>ƒалее - проблема борьбы с дребезгом (chatter). ¬ случае триггера она должна 
			решатьс€ введением "мертвого окна", в пределах которого новый триггер просто не 
			распознаетс€. ƒл€ гейтов такой вариант недопустим. “ам возможны:<BR>
			- дребезг при включении (вкл - кратковременное выключение - снова вкл)<BR>
			- при выключении (выкл - снова чуть-чуть вкл - выкл)<BR>
			- кратковременное включение<BR>
			- кратковременное выключение</P>
		<P>ѕерва€ и треть€ проблемы: свод€тс€ к тому, что у мен€ есть еще один сигнал на 
			включение.  огда он приходит, мне нужно проверить - не соответствует ли он уже 
			записанному участку. ѕри дребезге на включении это, очевидно, будет так - и 
			тогда тихо-спокойно продолжаем. ѕри кратковременном выпадении теоретически 
			возможна ситуаци€, когда участок сигнала действительно таки выпадет. Ќу так и 
			оставим его так :)</P>
		<P>¬тора€ и четверта€ проблемы: последний случай как бы вообще не страшен (будет 
			начат и записан новый фрейм). ѕри выключении же € рискую после реально 
			непрерывной серии записать еще один фрейм, да еще и с разрывом в начале...  ак 
			бы все-таки от этого избавитьс€???</P>
		<P>19:56<BR>
			я все еще продолжаю "теоретические измышлени€". Ќа сей раз - на тему меток 
			времени и соответственно - определени€ того, нужен ли триггер. “ак вот, чтобы 
			не ма€тьс€ дурью с синхронизацией, врем€ буду считать собственно по отсчетам. 
			»х, в DWORD, должно хватить на трое суток даже при максимальной частоте.... Ќо, 
			с другой стороны, в файл € должен буду писать именно врем€ - то есть кака€-то 
			"база" мне нужна. » где же она должна определ€тьс€? —трого говор€, “ќ„Ќќ € 
			этого сказать все равно не смогу - поэтому пусть будет по кнопке Go...</P>
		<P>Ќо, согласно спецификации EDF+, событи€ в файле должны считатьс€ от момента его 
			открыти€. ѕоэтому мне понадоб€тс€ два времени - врем€ создани€ файла и врем€ 
			нажати€ на кнопку (чтобы определить смещение этого времени от времени создани€ 
			файла).</P>
		<P>21:26<BR>
			переменные-счетчики заведены. ¬роде бы что-то считаетс€. Ќо! я не вижу сигнала 
			о закрытии гейта!!" Ќет - это была уже ошибка тестировани€: € вчера тригуслови€ 
			изменил (три бокса отметил). Ќет, вроде бы все это работает....</P>
		<P>---------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050518 ср</STRONG></P>
		<P>—нова - дорожные мысли... ѕосле получени€ очередной порции данных и первичного 
			триганализа данные передаютс€ "файлу". ¬озможные ситуации:<BR>
			- «јѕ»—№ »ƒ≈“<BR>
			&nbsp; - свежих команд нет - просто пишем и все тут<BR>
			&nbsp; - свежие команды есть. „то это может быть?<BR>
			&nbsp;&nbsp;&nbsp;&nbsp; - “ригрежим - “ќЋ№ ќ новый триггер (может быть не 
			один)<BR>
			&nbsp;&nbsp;&nbsp;&nbsp; - гейтрежим - “ќЋ№ ќ выключение гейта (но - возможно - 
			с последующим его включением)<BR>
			- Ќ≈“ «јѕ»—»<BR>
			&nbsp; - свежих команд нет - можно сразу отвалитьс€<BR>
			&nbsp; - свежие команды есть. „то это может быть?<BR>
			&nbsp;&nbsp;&nbsp;&nbsp; - “ригрежим - “ќЋ№ ќ новый триггер (может быть не 
			один)<BR>
			&nbsp;&nbsp;&nbsp;&nbsp; - гейтрежим - “ќЋ№ ќ включение гейта (но - возможно - 
			с последующим его выключением - и так не один раз)<BR>
		</P>
		<P>12:57<BR>
			ѕродолжаю - вдогонку "дорожным" (которые, собственно, так и не были записаны): 
			сообщение должно отправл€тьс€ себе же (так как таймерна€ секци€ - в отдельном 
			потоке, который задерживать не стоит). ј передать в нем € могу только адрес 
			списка событий... » что мне тогда делать? ¬ месте прин€ти€ начну работать со 
			списком - а очередной таймер его модифицирует.... “о есть получаетс€, что флаги 
			событий мне следует расставл€ть пр€мо в триггерном канале? (ќ чем и думал по 
			дороге) Ќо это "наедет" на другую проблему: децимируемость тригканала... „ем же 
			сие грозит? —обственно - лишь одним: наличием в одном выходном слове разных 
			команд. „то может решатьс€ так:<BR>
			- в тригрежиме - только триг<BR>
			- последовательность GATE_ON GATE_OFF так и передаетс€<BR>
			- при последовательности GATE_OFF GATE_ON выклчюение гейта подавл€етс€</P>
		<P>Ќо при этом и анализировать мне нужно в другом месте....</P>
		<P>14:50<BR>
			»так, € вроде бы закодировал все в триггерных словах. “еперь мне существенно, 
			чтобы тригканал в списке сто€л на первом месте. ѕопробую переставить.</P>
		<P>14:56<BR>
			¬роде бы перестановка прошла....</P>
		<P>15:00<BR>
			 ласс TrigPos и соответствующий вектор удалены из класса CMainFrame</P>
		<P>15:46<BR>
			Ѕыли обнаружены утечки пам€ти. ƒумал - из-за заведенного файла, оказалось - 
			недовычищенные проблемы с децимирующими фильтрами и буферами. »справил.</P>
		<P>16:00<BR>
			”становка триггерных команд по кнопке "пауза"</P>
		<P>18:50<BR>
			Ќачал прописывать записывающие фрагменты - т€жело получаетс€, неиз€щно.... ј 
			если т€жело и неиз€щно - то и работать оно не будет :( ¬от и не работает... “о 
			есть нужно как-то совсем по-другому. »нтересно, как????</P>
		<P>20:14<BR>
			“ранспонировал цикл. ѕервые признаки работоспособности. Ќе ловлю выключени€ 
			паузы.</P>
		<P>20:33<BR>
			ѕри таком подходе m_nEndPoint мне и не нужна - достаточно флага m_bNeedStop. ¬ 
			такой конфигурации элементарный случай (гейт без разновеликих каналов) 
			работает.</P>
		<P>21:40<BR>
			—тал пробовать с сочетанием децимированных и не каналов - вылетаю. »скал 
			причину в классе файла, потом дошло... » при отключенной записи вылетаю точно 
			так же: дело было не в бобине....</P>
		<P>00:17 - at home<BR>
			ѕо всей видимости, основное изменение, повлекшее за собой неработоспособность 
			программы в режиме децимации без децимации триггера - перестановка тригканала 
			на первое место в списке: вид именно из нулевого канала считывает "основной" 
			счетчик. ≈сли он будет делать это, базиру€сь на канале 1, непри€тностей быть не 
			должно (Ќќ!!! Ќужно учитывать и вариант, когда пишетс€ только один канал - 
			триггерный)</P>
		<P>----------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050519 чт</STRONG></P>
		<P>12:00<BR>
			—четчики: вернулс€ к "старому образу мыслей": таймерна€ ф-и€ послыает 
			сообщение, в котором WPARAM содержит децимированный счетчик - он-то и считаетс€ 
			видом за основной. ¬ таком виде работает.</P>
		<P>12:05<BR>
			» после раскомментировани€ "пишущего сообщени€" тоже не вылетает. Ќќ! ѕри 
			недецимированном счетчике пишу €вно много (€вный сбой счетчиков) - и неполадки 
			при остановке...</P>
		<P>12:50<BR>
			¬ частности обнаружено: "количество модулей" при построении главного списка 
			каналов не учитываетс€!!!</P>
		<P>13:10<BR>
			ƒа - действительно не учитывалось... » с тачпруфами примерно так же: где-то 
			учитвывалось - но успешно забывалось...</P>
		<P>13:21<BR>
			— записываемыми фреймами - точно так же: вернулс€ к передаче самого 
			децимированного значени€.</P>
		<P>[отвлечение на тестовый эксперимент - записывали ActiView, свою версию просто 
			погон€л]</P>
		<P>20:30<BR>
			ƒва самых актуальных замечани€<BR>
			- ќшибка при остановке - обращение к уже несуществуещему канальному буферу из 
			NewFrame()<BR>
			- в режимах децимации дублируетс€ перва€ триггерна€ команда
			<BR>
			¬торое - замечание мелкое, а вот первое может быть серьезно. ќтлавливать 
			сложно: про€вл€етс€ довольно редко. ѕроверил, € и в самом деле удал€ю 
			"канальный буфер" как бы без предупреждени€ - а он в это врем€ может еще 
			обрабатыватьс€. Ќепон€тно, почему € не налетал на это без записи - возможно, 
			дело в том, что "записывающий" фрагмент куда более задумчив... Ќо в общем, с 
			этим нужно что-то делать...</P>
		<P>20:42<BR>
			ќкуржил удаление буфера и вызов NewFrame критической секций m_csWChans - вроде 
			бы вылетов нет (но € и до того снова не смог их отловить). Ќо на самом деле 
			нужно другое: чтобы команда "—топ" вообще не срабатывала до тех пор, пока не 
			будет дописана текуща€ секци€!!! »ли, хот€ бы, чтобы запись действительно была 
			абортирована....</P>
		<P>¬ариант "подождать" по-простому не пройдет - файл пишетс€ в том же главном 
			потоке... Ёто мне нужно каким-то образом перепослать себе сообщение</P>
		<P>21:04<BR>
			ƒа, такой вариант похоже что работает. Ќе совсем €сно с "самым началом" - то € 
			выставл€ю паузу, то нет... Ќаверное, здесь вообще нужно логику управлени€ 
			мен€ть....</P>
		<P>21:08<BR>
			—пецмеры дл€ преодтварещени€ заполнени€ фильтровального буфера тригкомандой.</P>
		<P>--__________________----------------------------------------------------------------------------------------------</P>
		<P><STRONG>050520 пт<BR>
			</STRONG><EM>(утром прогул€лс€ - посмотрел соловев, на работе с 14:00)</EM></P>
		<P>14:00-16:50<BR>
			ќзадачилс€ выделением "файла" в отдельный поток. —начала хотел еще один класс, 
			потом передумал - сделал сам файл наследником потока и процесса. ƒолго не мог 
			там найти свое сообщение... “олько под конец пон€л: мне нужно при запуске 
			регистрировать в своем же лупе свой же фильтр (и нигде больше!). ¬ таком виде 
			прекрасно работает - и даже таких проблем с синхронизацией нет! ’от€ дл€ 
			очистки совести мне все же лучше передавать адрес нужной крит. секции - чтобы 
			ее отслеживать....</P>
		<P>17:00<BR>
			ѕерва€ попытка обрамить получение фрейма крит. секцией закончилась неудачей: 
			при остановке попадаю в дедлок....</P>
		<P>18:00<BR>
			¬се же пришлось отказатьс€ от цикла, ожидающиего "дописывание" - висну. 
			¬ернулс€ к варианту повторого пощени€ сообщени€.</P>
		<P>Ќа очереди - запись триггерного варианта. ќсновное в нем - с учетом претриггера 
			откатитьс€ назад и сходу положить в очередной (!!!) свободный (!!!) буфер все 
			претригзначени€.</P>
		<P>19:02<BR>
			¬ св€зи с переходом к триггерной записи (с возможным перекрытием и, соотв-но, 
			множественной записью) мне нужно изменить подход к пон€ти€м "зан€т-свободен"<BR>
			- bUsed - все буфера, которым нужна запись<BR>
			- при переходе на след. буфер текущий объ€вл€етс€ Free, а следующий - тут же 
			Used<BR>
			- ¬идимо, в самом начале нужно объ€вл€ть первый буфер Used (или вообще если не 
			пишем...)</P>
		<P>19:35<BR>
			¬ыстроена возможность записи в несколько буферов сразу. ѕока € работаю только с 
			гейтвводом, и мне ничего на страшно :) ¬ том смысле, что у мен€ и запись в файл 
			пойдет синхронна€, то есть текущий буфер по окончании записи уже будет свободен 
			- то есть € гарантированно получу свободный буфер!!! Ќо нужно предусмотреть и 
			ситуацию, когда этого не будет (если мне когда-нибудь случитс€ перейти на 
			асинхронную запись).</P>
		<P>21:40<BR>
			 акой-то вариант триггерного ввода прописал - но по-насто€щему там еще очень 
			далеко..<BR>
			- ќб€зательно нужна хоть одна посттриггерна€ точка<BR>
			- ¬опрос с автоматикой нулевого буфера при триггерном вводе (если € его 
			помечаю, как писабельный - то в него пойдут только посттриг данные)<BR>
			- ¬опрос с логикой отключени€ записи и перехода на след. буфера...</P>
		<P>¬ общем, есть где подумать :) Ќо - буду сворачиватьс€</P>
		<P>---------------------------------------</P>
		<P><STRONG>050523 пн</STRONG></P>
		<P><EM>Ѕудем восстанавливатьс€ после огородных выходных (+22, картошку сажали)</EM></P>
		<P>»так, дл€ обеспечени€ правильной буферизации мне необходимо "уточнить" флаг 
			зан€тости - он должен иметь следующие значени€:<BR>
			- буфер свободен<BR>
			- в буфер ведетс€ запись<BR>
			- запись в буфер завершена, файл нуждает€с в переоткрытии</P>
		<P>ќбщий флаг bWritings должен устанавливатьс€ по "или" - если хот€ бы один из 
			буферов нуждаетс€ в новых данных. ѕри входе в ф-ию все буфера должны 
			провер€тьс€, если хот€ бы один нуждаетс€ в закрытии - произвести закрытие и 
			переоткрытие файла, буфер объ€вить свободным.</P>
		<P>14:56<BR>
			¬роде бы отлажена логика работы с буферами - суд€ по сообщени€м, отлажена как 
			дл€ триггеров (в том числе - множественных(), так и дл€ гейтов. “еперь нужно 
			думать о возможном сочетании (гейт в триггерном режиме - свободна€ запись).</P>
		<P>Ќо дл€ этого сначала нужно пон€ть, какую же логику € хочу получить... »так, речь 
			идет о тригрежиме:<BR>
			- нажимаетс€ кнопка (или включаетс€ гейт) - ведем "обычную" непрерывную 
			гейт-запись<BR>
			- в ходе гейт-записи поступает триггер: мы должны<BR>
			&nbsp; - завершить текущий гейт-фрейм - и не начинать новый!<BR>
			&nbsp; - начать новый триг-фрейм<BR>
			&nbsp; - если "свободна€ запись" велась по кнопке (а не по хардовому гейту), 
			сбросить эту кнопку!<BR>
			- по окончании записи триг-фрейма (точнее - всех триг-фреймов) - снова 
			вернутьс€ к рассмотрению вопроса о гейте. ≈сли он установлен, продолжить запись 
			в свободном режиме.</P>
		<P>¬ообще же, все это "замыкаетс€" на иную общую логику - и иные кнопки. “ак что 
			начинать нужно с того, что сделать эти кнопки. Ёто должны быть:<BR>
			- disable writing<BR>
			- Run<BR>
			- Pause<BR>
			- Manual recording</P>
		<P>ѕерва€ - касаетс€ только файла, и мен€ сейчас не волнует. ¬тора€ - остаетс€ 
			точно той же, что и сейчас. “реть€ - мен€ет свое назначение в том отношении, 
			что Ќ≈ ¬ Ћё„ј≈“ гейт, а только отключает его запрещение.
		</P>
		<P>19:24<BR>
			 нопки € сделал, и даже как-бы их "базовую функциональность" обеспечил - но 
			вопрос еще и в том, что этот подход должен сопровождатьс€ соотв. изменени€ми в 
			диалоге: выкидыванием "свободного ввода" и выделением дл€ тригввода отдельного 
			гейта дл€ "ручного ввода"....</P>
		<P>----------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050524 вт</STRONG></P>
		<P>ѕродолжаю перестаивать триггерный диалог (удаление Free режима, отдельный гейт 
			дл€ свободного ввода в тригрежиме). —ейчас не устраивает:<BR>
			- ¬ гейтрежиме второй And не запрещает соотв. гейтбиты<BR>
			- ¬ тригрежиме учитываетс€ And3</P>
		<P>13:54<BR>
			Ёто сделано. —ледующее не то: тригбиты вообще не запрещают гейтбитов</P>
		<P>13:56 - сделано. ѕереходим к самим разборкам. ѕохоже, что мне понадоб€тс€ и 
			другие возвращаемые значени€....</P>
		<P>≈ще раз - о кнопках:<BR>
			- √ейтрежим: работают исключительно как радио, флаги m_bNeedStart, m_bNeedStop; 
			повторное нажатие на уже нажатую кнопку эффекта не имеет<BR>
			- “ригрежим: работают независимо: лева€ выставл€ет те же флаги, права€ - 
			m_bManStart, m_bManStop</P>
		<P>15:14<BR>
			ƒобавлены слова (расшир€юсь вправона два бита)<BR>
			0xF0800000; - ManStart<BR>
			0xF0400000; - ManStop</P>
		<P>16:13<BR>
			— анадизом битов все еще хитрее: при таком подходе получаетс€ больше возможных 
			сочетаний: кроме возможности одновременного прихода триггера и включени€ гейта 
			добавл€етс€ оба варианта мануального гейта (как включение, так и выключение). 
			—оответственно, становитс€ невозможной алгебраическа€ суммаци€ - только по 
			битам.... ѕриходитс€ мен€ть коды возврата на:<BR>
			#define GATE_ON 1
			<BR>
			#define GATE_OFF 2
			<BR>
			#define TRIG_ON 4
			<BR>
			#define MAN_ON 8
			<BR>
			#define MAN_OFF 16
		</P>
		<P>17:33<BR>
			—оответственно, и возврат провер€ем раздельно: в свитче биты манов не 
			учитываем, они пойдут отдельным свитчем</P>
		<P>18:10<BR>
			¬ мейнфрейме что-то прописал - пора идти в файл....</P>
		<P>18:50<BR>
			„то-то соответствующее попробовал прописать и в файле: дескать, если запись 
			есть - то просто снимаем флаг окончани€, если записи нет - помечаем, что нужна 
			нова€....</P>
		<P>” мен€ неполадки с чтением гейтов!!!</P>
		<P>19:15<BR>
			Ќу да, у мен€ же отпала необходимость ремэпировани€ кнопок и массивов... ¬се 
			ненужное - удалено!. — результатами пока все равно не€сно.... Ѕудем пытать.</P>
		<P>19:18<BR>
			“аак... ” мен€ в тригрежиме пауза не выключаетс€ :(</P>
		<P>19:46<BR>
			√ейт в тригрежиме переключаю нормально. “риггера = не вижу :(</P>
		<P>20:12<BR>
			Ћокализовал еще пару сегодн€шних ошибок. “риггера ловлю, гейты тоже. Ѕолее 
			того, "понимаю" и маны, даже корректно выключаю их по триггеру - но 
			промахиваюсь при ручном выключении :(((</P>
		<P>20:53<BR>
			» с ручным выключением тоже разобралс€. Ќо - не чую хардовых манов.</P>
		<P>21:03<BR>
			 ак-то исправил - но насколько верно смогу узнать только при реальном вводе...</P>
		<P>21:08<BR>
			ѕопыталс€ сигнализировать только о включении - не помогает, не понимаю....</P>
		<P>21:17<BR>
			Ћегка€ коррекци€ остановки при мануальном вводе в тригрежиме Ќаверное, нужно 
			будет уточнить....</P>
		<P>21:30 - и с гейтрежимом тоже подрправил.</P>
		<P><STRONG><FONT color="#cc0066">Ќужно отображать установленный режим ввода!!!</FONT></STRONG></P>
		<P>------------------------------</P>
		<P><STRONG>050525 ср</STRONG></P>
		<P>ToDo:<BR>
			- calculating and keeping time<BR>
			- event channel<BR>
			- CSnapView<BR>
			- File recording</P>
		<P>¬рем€: согласно спецификации, кажда€ запись должна начинатьс€ с пол€ "смещение" 
			- относительно начала файла, в секундах, со знаком. ѕри этом врем€ первой 
			записи ќЅя«јЌќ быть нулевым - и означать врем€ начала файла, указанное в 
			заголовке (дата и врем€ в ч:м:с)<BR>
			&nbsp; ¬опрос: как мне отслеживать это врем€? Ќаиболее точный вариант может 
			дать лишь подсчет введенных точек - но он окажетс€ невалидным в случае, если в 
			записи были перерывы (нажати€ кнопки Run/Stop). “о есть мне нужны будут ƒ¬ј 
			времени - врем€ первой записи и врем€ каждого последующего запуска.</P>
		<P>“очное врем€ запуска € смогу (гипотетически - врем€ начала ввода) € могу 
			получить в ф-ии OnTimer - но не просто вз€в текущее врем€, а еще и вычт€ из 
			него длительность полученного участка (кол-во полученных точек деленное на 
			частоту дискретизации). ¬се последующие времена будут расчитыватьс€ из него - и 
			общего счетчика введенных точек.</P>
		<P>—амо получение времени:<BR>
			&nbsp; GetLocalTime(&amp;tmSystemTime); //получим текущее локальное врем€ в 
			формате SYSTEMTIME<BR>
			&nbsp; SystemTimeToFileTime(&amp;tmSystemTime, &amp;ftmTime); //переводим врем€ 
			в 100 ns единицы - т.е. *10000 даст ms<BR>
			(переменные должны быть статическими - если они в стеке, то что-то глючит....)</P>
		<P>Ќо хорошо: врем€ € измерил. Ќо как его передавать? —обственно "непрерывную 
			нумерацию" может иметь лишь первичный буфер - но все виды и файл имеют дело уже 
			с динамическим поканальным массивом... “ак-так-так... ѕервой моей мыслью было - 
			завести еще один массив и писать в него счетчик. Ќо как-то это уж больно 
			расточительно, да и потребовало бы солидных перестроек в самых-самых основных 
			массивах... “огда остаетс€ еще один вариант: считать непосредственно в 
			CDataFile - и считать точки тригканала. “ем более что и врем€ старта, и 
			собственно назначение времени конкретной записи - дело именно файла....</P>
		<P>-------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050526 чт</STRONG></P>
		<P>ѕродолжаем раздумь€ о подсчете времени. ќстановилс€ € на том, что в CDataFile 
			считаю точки тригканала. » вот пришел сигнал на запись...<BR>
			- если это вообще перва€ запись, нужно:<BR>
			&nbsp; - присвоить это значение&nbsp;переменной StartPoint<BR>
			&nbsp; -&nbsp;”становить "глобальное" стартовое врем€, прибавив значение 
			счетчика (*10000000/nFrq) к&nbsp;полученному в&nbsp;основном окне времени 
			нажати€ на кнопку "Run".&nbsp;</P>
		<P>- если запись не перва€<BR>
			&nbsp; - это - первый Run, перерывов не было - смещение вычисл€етс€ только из 
			счетчика<BR>
			&nbsp; - были перерывы - к смещению должна добавл€тьс€&nbsp; разница между 
			временем очередного запуска и глобальным стартовым временем.</P>
		<P>14:32<BR>
			— этой целью m_u64StartTime перенесена в CDataFile, m_u64RunTime будет и там, и 
			там (в главном окне нужна, чтобы определ€ть только один раз, в файле по ней 
			будет производитьс€ "базирование")</P>
		<P>15:08
			<BR>
			–асчет стартового времени перенесен в CDataFile. Ќо! “ам два входа - при одном 
			счетчик еще не инкрементирован, при другом - уже да... “ак что переношу 
			увеличение счетчика в начало обработки тригканала.
		</P>
		<P>ќсталось разобратьс€ с не-первым пуском....</P>
		<P>19:25<BR>
			„то же, вроде бы с временами разобралс€ - и в гейтовых, и в триггерных режимах 
			показывают что-то похожее на истину. “ак и не додумал (и не проверил, 
			следовательно) ситуацию с приходом триггера на фоне продолжающегос€ свободного 
			ввода... Ќо, наверное, на это нужно уже смотреть - то есть нужно сделать то, 
			чем смотреть. Ќо дл€ начала - чекин</P>
		<P>=++++++++===================== чекин =================================</P>
		<P>19:40<BR>
			»так, € хочу образовать "базовый вид", потомками которого будут вид-осциллоскоп 
			и вид-снэпшот (дл€ начала). ƒл€ этого € должен сначала пон€ть, какие из 
			переменных и методов должны перейти в базовый класс, а какие - остатьс€ "чисто 
			осцилльными"....</P>
		<P>21:30<BR>
			ѕервый вариант "разнесени€" умудрилс€ оставить работоспособным. ¬опрос в том, 
			что мне тогда нужно еще и диалоги делать разными - ну или по крайней мере 
			чувствительными к "содержимому"... ¬ противном случае большинство ф-ий придетс€ 
			оставить виртуальными - но везде.... ѕока же получаетс€ неплохо: результат 
			зависит от того, какой именно вид порождает GrThread. ј он создаетс€ диалогом в 
			OnInitDialog. —оответственно, достаточно будет сделать тип окна третьим 
			параметром конструктора диалога (и тогда он спокойно сможет что-то отображать - 
			а что-то нет...)</P>
		<P>-----------------------------------------------------------------------------------</P>
		<P><STRONG>050527 пт</STRONG></P>
		<P><EM>„то-то и встал поздно, и всю первую половину дн€ занималс€ другим - купил 
				–убинар 500/8 (1200 р + 620 р бленда + 100 р крышка) - вот все и смотрел на 
				него и сквозь него, по сайтам ползал... Ќо все же...</EM></P>
		<P>Ќа самом деле мне нужен совсем другой уровень абстракции. Ѕазовый "вид" должен 
			содержать в себе лишь то, что необходимо дл€ отображени€ „≈√ќ ”√ќƒЌќ - то есть 
			никаких специфичных ф-ий в нем быть не должно. “аким образом, на насто€щий 
			момент мне нужно выкинуть<BR>
			+SetZero(void) 
			-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			called by CDlgView::OnBnClickedZero<BR>
			+SetScroll(BOOL bSc)&nbsp;&nbsp; called by CDlgView::OnBnClickedScroll, 
			OnInitDialog, DoDataExchange<BR>
			+SetFrq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			message&nbsp; WM_DIZ_SETFRQ form CDlgView and CMainFrame<BR>
			+SetBuffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			called by CActDView::SetFrq and MapChanged<BR>
			+Set_Timer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;called 
			by COscView::Plot<BR>
			+Plot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message 
			WM_DIZ_PLOT<BR>
			+OnCfChanged&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			message WM_DIZ_CFCHANGED<BR>
			+Draw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			called by COscView::Plot<BR>
			+ChangeTimer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;called 
			by CDlgView::OnBnClickedTool. OnInitDialog<BR>
			+ 
			MapChanged&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			message WM_DIZ_MAPCHANGED<BR>
			и сделать переменным содержимое ф-ий<BR>
			OnSize<BR>
			OnPaint<BR>
		</P>
		<P>17:27<BR>
			CActDView::MapChanged(void) удалена и заменена на<BR>
			CActDView::OnMapChanged(UINT /*uMsg*/, WPARAM /*wParam*/, LPARAM /*lParam*/, 
			BOOL&amp; /*bHandled*/), теперь обрабатываетс€ не в PreTranslateMessage 
			-&nbsp;а в основной карте сообщений. —оответственно, и перенести проще...&nbsp;</P>
		<P>17:55<BR>
			бќльша€ часть перенесена<BR>
			вместо ф-ии ChangeTimer - OnChangeTimer как обработчик сообщени€ 
			WM_DIZ_CHANGETIMER</P>
		<P>18:01<BR>
			C SetZero() и SetScroll() - так же....<BR>
			“аким образом, все специфичные ф-ии убраны. “еперь нужно так же поступить и с 
			переменными....<BR>
			ѕереносим
			<BR>
			m_bZero<BR>
			m_bScroll<BR>
			m_nWinBegPix - Ќужна в OnSize<BR>
		</P>
		<P>18:41<BR>
			—обственно, OnSize - тоже лишь обработчик сообщени€. ”бираем в COscView. 
			ѕродолжаем перемещать пер-ые<BR>
			bool m_bChange;
			<BR>
			fltCf2 m_cfLP;
			<BR>
			fltCf1 m_cfHP;
			<BR>
			CRITICAL_SECTION m_csBitMaps;
			<BR>
			&nbsp; - дл€ этого пришлось продублировать OnCreate с вызывом род. метода. 
			»нтересно, а работать это будет???<BR>
			&nbsp;&nbsp;&nbsp; ƒа&nbsp;&nbsp;вроде&nbsp;&nbsp;&nbsp;&nbsp; как работает....<BR>
			UINT m_uTimerID;
			<BR>
			DWORD m_dwTime;
			<BR>
			double *m_pOldHPx;
			<BR>
			double *m_pOldLPx;
			<BR>
			double *m_pOldHPy;
			<BR>
			double *m_pOldLPy;
			<BR>
			int m_nTrigFrameCnt;
			<BR>
			<BR>
			/////// - не нужен long *m_pActBuf;<BR>
			long *m_pChanBuf;
			<BR>
			long *m_pRefBuf;
			<BR>
			WORD *m_pTrigBuf;
			<BR>
			int m_nMaxCnt;
			<BR>
			int m_nMaxTrigCnt;
			<BR>
			_GrBitmap *m_pWriteBmp;<BR>
			_GrBitmap *m_pReadBmp;
			<BR>
			int m_nWinFrameCnt;
			<BR>
			int m_nOneSecCnt<BR>
			”ƒјЋ≈Ќј m_nLengPlus<BR>
			int m_nTimer<BR>
			”ƒјЋ≈Ќџ //int m_nX0, m_nY0; int m_nXSum,m_nYSum;<BR>
		</P>
		<P>19:36<BR>
			m_Pnt из статического сделан динамическим!!!<BR>
			ѕеременных там еще много - но дальше переносить € подожду: многие из них могут 
			понадобитьс€ и дл€ снапшота.</P>
		<P>21:10 (после очередной порции скана —окала)<BR>
			¬се же дл€ диалогов тоже такое нужно будет - но много проще: в базовом классе 
			останетс€ всего ничего, только указатель не вид да ф-и€ активации...</P>
		<P>--------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050528 сб<BR>
			</STRONG><EM>”тром попыталс€ поснимать птичек во дворе и около школы новым 
				стеклышком - безуспешно :( ѕоехал через Ќевский - а там подготовка к 
				карнавалу... «ашел в яћ, маленьких моноподов нет, в ‘ото–у тоже - в итоге вз€л 
				еще один маленький штатив, но со съемной площадкой... ѕосмотрим... ƒо работы 
				добралс€ лишь к 14:00, и начал не с работы, а с подготовки €понской фотографии 
				к публикации</EM></P>
		<P>18:06<BR>
			¬се-таки смог разделить и диалоги тоже на "базовую" и "индивидуальную" части. 
			ќсновна€ проблема оказалась с IDD, котора€ бралась из базового диалога. 
			ѕроблему удалось решить созданием своей ф-ии Create, причем она не виртуальна€, 
			так что и указатель дл€ ее вызова нужен €вный. „то большой проблемой не 
			€вл€етс€: вызов идет из CMainFrame::OnOscNew.</P>
		<P>ѕойду посканирую....
		</P>
		<P>21:06 —канирование зат€нулось (еще и 18 глава вылетела - а она длинна€...) “ак 
			что больше ничего не успеваю - пора домой :(</P>
		<P>------------------------------------------------------------------</P>
		<P><STRONG>050530 пн<BR>
			</STRONG><EM>Ќачал день с письма ¬иктору ћарковичу Ўкловскому - про Active2. Ќу и 
				√але соловь€ заслал....</EM></P>
		<P>13:51<BR>
			“ак. „то у нас должно быть в снапшот-диалоге? "ƒлина окна" не нужна. Ќо могут 
			понадобитьс€: номер реализации и кнопки перехода между ними (перва€, пред, 
			след, последн€€).  роме того, участок отображени€.... ѕопробуем.</P>
		<P>15:32<BR>
			—озданы диалог и класс вида.  онтрукторы получили доп. параметр - тип (и поток 
			- тоже). ƒобилс€ невылетаемости.</P>
		<P>17:43<BR>
			ƒаже присобачил к снапвью статусбар! –азрешаю закрывать первый при отсутствии 
			файла. Ќо! ¬опрос в том, что и у первого может оказатьс€ непервый номер.... “о 
			есть нужно иметь&nbsp; отдельно счетчик, и отдельно - нумера....</P>
		<P>18:01<BR>
			ƒл€ обоих видов заведена двойна€ бухгалтери€: отдельно считаю номера, отдельно 
			- количество... “ак помогает.</P>
		<P><EM>Ќиколай »ванович оторвал вопросом про старинный DAQ, после этого к программе уже 
				не вернулс€ - попереставл€л страницы в Sokal (дошел до 9 главы, в ней чего-то 
				напутал - и недоделал)</EM></P>
		<P>------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050531 вт</STRONG></P>
		<P><EM>Ќаписал письмо в ”ниверсалприбор: уже и май кончаетс€, а обещанного в марте 
				осциллографа так и нет... Ќо и ответа нет тоже. Ќемножко фотосайта, немножко 
				—окала: закончил главу 9 и сделал 10-11</EM></P>
		<P>12:56<BR>
			Ќужно инициализировать CSnapView - резервировать буфера. ѕо команде отрисовки 
			вид должен перекачать буфера к себе (полностью, чтобы можно было в любой момент 
			изменить отображение и референсинг, наверное лучше - с обратным декодированием 
			в Long)</P>
		<P>√де? Ёто пон€тно - там же, где инициализируетс€ файл, при начале ввода (по 
			нажатию кнопки Run). ¬ каком случае? “оже пон€тно - если есть хот€ бы один 
			SnapView. ќстаетс€ вопрос, в каких случа€х € должен принудительно создавать 
			новый SnapView, если ни одного нет. ѕо моей логиек получаетс€, что делать это 
			нужно:<BR>
			- если отрыт файл<BR>
			- если установлен триггерный режим ввода</P>
		<P>13:37<BR>
			  видам добавлен константый член m_nType, автозаполн€емый в соотв. дочерних 
			конструкторах</P>
		<P>13:45<BR>
			Ќовое сообщение
			<BR>
			WM_DIZ_SNAPINIT, (WPARAM)(&amp;m_arChanW), (LPARAM)(&amp;m_atrParams)</P>
		<P>14:43<BR>
			„тобы не путатьс€ в Init-функци€х (кроме моих - дл€ карты и файла существует 
			еще куча стандартных), переобозвал свои ф-ии. —оответственно - изменени€ во 
			многих файлах....</P>
		<P>15:43<BR>
			—лучайно подправил не то сообщение... ѕрома€лс€....<BR>
			„тобы не искать в разных местах, флаг "плюсового формата" помещаю в структуру 
			Pointer24</P>
		<P>16:35<BR>
			ѕока из рисовани€ - только зачистка территориии. ¬се бы ничего - но дл€ 
			взаимодействи€ с картами мне откуда-то нужно получать и использовать реальные 
			номера каналов!!!</P>
		<P>...—нова запуталс€ с номерами каналов... —ложна€ там истори€: нужно высесть 2, 
			сравнить с кол-вом пинканалов, и при &gt;= вычесть число пинов и добавить 256<BR>
			<FONT color="#000099">&nbsp; m_pnChanNums[chan] = 
				(*parChanW)[chan+1].GetChanNum()-2;
				<BR>
				&nbsp; if (m_pnChanNums[chan] &gt;= m_nPinChans)
				<BR>
				&nbsp;&nbsp;&nbsp; m_pnChanNums[chan] = m_pnChanNums[chan]- m_nPinChans + 256; </FONT>
		</P>
		<P>20:47<BR>
			¬первые!  артинка нарисовалась!!!</P>
		<P>21:37<BR>
			“ак, ладно.<BR>
			–исует - и даже картинка после остановки держитс€ :)<BR>
			«амечани€ и прочие <STRONG><FONT color="#cc0066"><FONT color="#000099">TODO<BR>
					</FONT><FONT color="#000099">- Ѕипол€ры<BR>
					</FONT><FONT color="#000099">- учет статусбара при определении размеров окна</FONT><BR>
					<FONT color="#000099">-  арты снэпшота не должны гаситьс€ при выключении!!! ќни 
						завис€т только от "файла".<BR>
						- отзовн изменени€ масштаба - тот же, что и при изменении карты<BR>
					</FONT><FONT color="#000099">- подключение фильтров<BR>
					</FONT><FONT color="#000099">- триггер<BR>
					</FONT><FONT color="#000099">- вывод имен каналов<BR>
					</FONT></FONT><FONT color="#000099">- проблемы с одновременной активацией 
					осцилла и снэпшота</FONT></STRONG></P>
		<P>--------------------------- домой -----------------------------</P>
		<P><STRONG>050601 ср</STRONG></P>
		<P>“ак... ¬ы€снилось, что в субботу нужно паковать посылку на ћЅ—. ¬споминаю, что 
			нужно... «аскочил в ƒикси, что-то купил....</P>
		<P>14:43<BR>
			ƒл€ правильного учета статусбара используетс€ ф-и€ UpdateBarsPosition(rc);</P>
		<P> арты снэпшотов и основна€ карта. ≈сли файл начат (есть хот€ бы одна запись) - 
			снэпшоты работают только с ней - и люба€ попытка изменени€ (а это может быть 
			только механическое изменение режима ввода) должно приводить к матюкам. ≈сли 
			файл не начат (то есть снэпшоты существуют, но реальных записей нет), матюков 
			может и не быть - но изменени€ основной карты перенос€тс€ в дочерние только при 
			попытке запуска!</P>
		<P>15:34<BR>
			Ќе так просто с этими картами. ѕередачу сообщени€ снэпшотам € заблокировал - но 
			остаютс€ проблемы со ссылкой на "основную карту". ѕолучаетс€, что у снэпшотов 
			она должна быть сво€ (одна на все) - ну и содержатьс€ она тогда должна в 
			файле....</P>
		<P>ѕередачу карты файлу € легко могу сделать по запуску (главна€ карта в любом 
			случае по запуску фиксируетс€). Ќу а что&nbsp;делать в случае, 
			если&nbsp;снэпшот был открыт - а никаких запусков еще не производилось? ”ж в 
			этом-то случае карта снэпшота должна повтор€ть&nbsp;главную... “огда, наверное, 
			так: при создании снэпшот ссылаетс€ на главную карту, а как только есть хоть 
			одна запись... Ќо снэпшотов может быть много... “огда так: файл имеет 
			собвственную ссылку, изначально устанавливаемую на главную карту.  ак только 
			происходит заполнение собственно файловой карты, ссылка переводитс€ на нее (и 
			на ней остаетс€). ј снэпшоты всегда ссылаютс€ на файловую карту (то есть - на 
			ту самую ссылку)</P>
		<P>&nbsp;16:37<BR>
			Ќет, указатель на файловую карту будем держать в главном окне - так проще.
			<BR>
			ѕолучилось.</P>
		<P>18:28<BR>
			ѕередача сообщени€ из EditUpdate дл€ перерисовки. Ќужно то же самое дл€ 
			бипол€ров и триггера.</P>
		<P>21:44<BR>
			¬роде бы вывел рисование линии в отдельную ф-ию (надо бы сделать ее вообще 
			общей дл€ всего), начал работать с бипол€рами - но там снова засада: мне же 
			нужно перейти от "условных" номеров к номерам в получаемом массиве... ј как? » 
			вообще нужно уже делать файл - и тогда с ним можно будет работать безо вс€ких 
			девайсов....</P>
		<P>---------------------------------------------------------------------------------------</P>
		<P><STRONG>050602 чт</STRONG></P>
		<P>13:50<BR>
			¬роде как выставил правильные бипол€рные каналы. Ќо вот что у мен€ с нижней 
			частью графика??? » что должно быть с цветами бипол€ров??? Ћадно, с цветами 
			поступлю просто: начну нумерацию заново...</P>
		<P>14:12<BR>
			“риггер тоже рисуем. Ќе желаем жить, если нет аналоговых каналов..</P>
		<P>14:18<BR>
			C рисованием без аналоговых каналов тоже справилс€ (h)</P>
		<P>14:35<BR>
			¬ывод имен каналов (как обычных, так и бипол€ров)</P>
		<P>¬ывод имен и карт ‘ј…Ћј порождает еще одну проблему: очень желательно и в случае 
			файла сохран€ть разбиение на модули (и выделение EXT в отдельную линейку). 
			¬идимо, дл€ осуществелни€ этого нужно записывать в файл не только имена каналов 
			(если таковые есть), но и их "номера" - например, в скобках после имени. »ли 
			наоборот: писать номер (так как он есть всегда), а в скобках - им€ (и тогда 
			пустые скобки будут означать отсутствие имени)</P>
		<P>15:30<BR>
			‘ильтры сделаны. ћне не нравитс€, что при LowPass only € получаю резкие взбрыки 
			в начале...<BR>
			¬ыход виден (и здесь он виден лучше) - при LP игреки нужно приравнивать не 
			нулю, а начальному значению... “о же сделаем и в осцилле.</P>
		<P>16:23<BR>
			— активацией проблем вроде бы нет... ≈сть проблемы с закрытием снэпшотов. » с 
			начальным выбором коэффициентов.</P>
		<P>16:26<BR>
			¬ыбор коэфф. при инициализации. Ќо нужно еще эту инициализацию провести! ќна же 
			у мен€ по запуску - а новый снэпшот может быть открыт на лету....</P>
		<P>16:29<BR>
			—делано - посылаем инит-сообщение при открытии нового вида. ¬роде бы ничему не 
			мешает...</P>
		<P>¬роде бы список TODO пройден. „екин. ќбедаем - и за файл....</P>
		<P>------------------------- чекин 
			---------------------------------------------------</P>
		<P>17:30<BR>
			—делана отдельна€ иконка дл€ снэпшота.</P>
		<P>19:30<BR>
			¬з€лс€ за файл - и завис на ровном месте. ¬идимо, это все-таки нездоровье... 
			—итуаци€-то проста€: заголовок должен быть динамическим - в том смысле, что в 
			нем содержитс€ 10 по-канальных полей (причем идут сначала пол€, а уже внутри 
			них - каналы). Ѕыло бы здорово вспомнить, как € нечто подобное сооружал... или 
			не нужно этого делать: дл€ реальной работы мне все равно понадобитьс€ 
			"числовой" заголовок, а не алфавитный? “огда достаточно будет уже сооруженной 
			структуры, из которой должно вытекать необходимое количество каналов - и сам 
			размер текстового буфера дл€ чтени€ всего заголовка. Ќу и дл€ записи - тоже....</P>
		<P>19:50<BR>
			ƒобавил к табам диалогов соотв. иконки, заодно и их помен€л - сделал темным 
			фон.</P>
		<P>20:04<BR>
			Ќо в то же врем€ € бы не хотел заниматьс€ заполнением этого текстового буфера в 
			тот момент, когда понадобитс€ его записывать....<BR>
			Ќаверное, нужна кака€-то комбинированна€ структура... „тобы там и числа были, и 
			алфавитный заполн€емый буфер....</P>
		<P>21:25<BR>
			ѕримерное решение найдено, и выгл€дит где-то так:<BR>
			&nbsp;&nbsp; char *pB = new char[400];
			<BR>
			&nbsp;&nbsp; int nChan = 5;
			<BR>
			&nbsp;&nbsp; char (*ppC)[80] = new(pB) char[nChan][80];
			<BR>
			ѕри этом "подстроки" оказываютс€ правильно распределены по массиву.... ¬от бы 
			еще со всеми ними скопом так же.....</P>
		<P>--------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050603 пт<BR>
			</STRONG>—нова встал с трудом. ќтправлис€ за птичками (благо солнце) - но 
			безуспешно: мое настроение оказалось сильнее окружающего, ничего не сн€л....</P>
		<P>16:20<BR>
			“ак чего же € хочу?  аким-то образом попроще да поавтоматичнее заполн€ть 
			текстовый заголовок - и столь же просто его читать. ќчень хотелось бы и в том, 
			и в другом случае дл€ этого использовать конструктор и перегрузку оператора 
			new. “о есть класс должен иметь в себе пул, если&nbsp;конструктор идет без 
			адреса, выдел€етс€ новый пул, обнул€етс€ - и все пол€ распредел€ютс€ по нему. 
			≈сли в конструкторе указываетс€ адрес - то это адрес прочитанного заголовка, 
			пул выставл€етс€ на него, и снова "раскидываютс€" все пол€...</P>
		<P>19:26<BR>
			Ќу-с, читать заголовок € научилс€ :) ј что € с этим должен сделать???? ћне 
			нужно:<BR>
			- построить список каналов<BR>
			- сложить куда-то имена каналов<BR>
			- определить канальные частоты<BR>
			- определить длину «јѕ»—» (как сумма длин всех каналов)<BR>
			- установить "базу" чтени€</P>
		<P>21:00<BR>
			ƒоделаны тулбар (под открытие-закрытие), нужно еще меню. ‘-и€ открыти€ 
			перенесена в файл, но пока она ничего не делает...</P>
		<P>---------</P>
		<P><STRONG>050606 пн<BR>
			</STRONG>Cуббота ушла на упаковку коробок дл€ ћЅ—, воскресенье - огород, 
			выкашивание травы под дождем. ќсело две мысли:<BR>
			- просто с переопределением new € могу и напортачить: место под сам класс мне 
			нужно<BR>
			- дл€ нормальной работы с проихвольными файлами CSnapView должен уметь работать 
			со сколь угодно разными каналами</P>
		<P>13:55<BR>
			ѕо первому пункту € беспокоилс€ напрасно - никаких new € и не переопредел€л, 
			буфер задаетс€ и используетс€ в конструкторе заголовка, и это именно буфер под 
			заголовок.</P>
		<P>¬торой же вопрос в очередной раз приводит к необходимости одинаковой длины всех 
			реферируемых каналов (и бипол€ров)! ¬ самом деле, € никак не могу складывать и 
			вычитать каналы, имеющие разную длину.... “ак что пока все останетс€ как 
			есть....</P>
		<P>14:53<BR>
			»так, после открыти€ файла € должен »« Ќ≈√ќ получить всю ту информацию, к-ую 
			обычно получал из своих установок. Ёто:<BR>
			- "главна€ карта" - пристутствующие каналы<BR>
			- параметры каналов (частота, длительность, длина, пре- и посттриг - ј ќ“ ”ƒј я 
			»’ ¬ќ«№ћ”???)<BR>
			---------<BR>
			ѕоехал в ”ниверсалприбор за осциллом. Ќашли ошибку в доверенности, развернули. 
			«ашел в ‘отоћагию, купил монопод с головкой.   работе больше не возвращалс€ :(</P>
		<P>------------------------------------------------------------------------------------</P>
		<P><STRONG>050607 вт<BR>
			</STRONG>¬роде и не хотел, но увидел солнышко - пошел опробовать монопод. 
			¬ремени было мало, так что толком ничего не дождалс€ - но один практически 
			резкий кадр получил. » это при выдержке 1/60 !!!</P>
		<P>14:53<BR>
			‘айлы с разной частотой дискретизации мне пока придетс€ отклон€ть - просто нет 
			информации дл€ прин€ти€ решени€ о том, что с ними делать.
			<BR>
			¬опрос с именами каналов: вид берет их из диалога, диалог - получает при 
			создании, в CMainFrame::OnSnapNew , путем вызова
			<BR>
			&nbsp; pNewDlg-&gt;SetMainMap(m_pFileMap, m_LeftDlg.GetChanNames());&nbsp;
			<BR>
			&nbsp; pNewDlg-&gt;SetNofChans(m_nChans,m_nExtChans);<BR>
			ѕолучаетс€, что все это (и имена, и кол-во каналов) мне нужно брать из 
			файла.... ј дл€ этого они должны в "файл" попасть - даже в случае создани€ 
			нового!!! ƒл€ этого придетс€ изменить ф-ию CDataFile::FillMap, она должна будет 
			получать количества каналов (основных и EXT), собственно карту - и адрес 
			массива имен....</P>
		<P>15:54<BR>
			ѕередачу имен организовал. ѕришлось отказатьс€ от константности указател€ на 
			имена (в итоге это все доходит до карты, в том числе - главной, а там указатель 
			уже не константый). ѕри тригвводе получил вылеты :((((</P>
		<P>18:01<BR>
			ѕосле отвлечени€ на ЋЅ-MatLab-EEGLAB (но еще до обеда): мо€ основна€ проблема 
			оказалась в том, что € попыталс€ брать длину из передаваемого "рабочего" 
			массива каналов напр€мую. ј там длина не та, там длина - "потреб€ема€", с 
			запасом... ¬от и получалось черт-те-что... “ем не менее, считать в виде считаю 
			неправильным. ћожно ли как-нибудь вз€ть из файла???</P>
		<P>ѕроверка показывает, что при инициализации CSnapView параметр 
			(CSimpleArray&lt;_ChanW&gt;*)wParam; используетс€ только дл€:<BR>
			- определени€ общего числа каналов<BR>
			- определени€ длин (через частоту)<BR>
			- определени€ номера канала<BR>
			Ќаверное, все это можно получить и из файлового списка...<BR>
			ќтправл€етс€ это сообщение всего из двух мест - OnRunGo() и OnSnapNew()</P>
		<P>21:43<BR>
			»справлени€ не доделал!!! “ак и не решил, что же мне нужно передавать в вид - 
			адрес файла или конкретно массива....</P>
		<P>----------------------------------------------------------------</P>
		<P><STRONG>050608 ср<BR>
			</STRONG>≈ле встал, еле доехал до работы - и все равно сонный.....</P>
		<P>ќднозначно: снэпшот должен быть св€зан прежде всего с файлом! » св€зан должен 
			быть настолько жестко, что "файл" можно указывать даже в конструкторе</P>
		<P>Ќикак не могу разобратьс€: у мен€ получаетс€ две "инициализирующие" функции 
			файла : OnFileInit и FillMap. ѕричем обе они вызываютс€ из OnRunGo() - но в 
			разных местах оной. » по-разному между ними вклиниваютс€ ф-ии инициализации 
			снэпшота. Ќадо с этим что-то делать.... »так:<BR>
			- FillMap только устанавливает количества каналов и заполн€ет карту<BR>
			- создание нового снэпа (если ни одного не было)<BR>
			- CSnapDlg::SetNrOfChannels<BR>
			- FileInit собственно формирует массивы (исход€ из полученного списка "рабочих" 
			каналов")<BR>
			- SnapInit<BR>
		</P>
		<P>21:13<BR>
			Ќет, € все-таки совсем запуталс€ с нумерацией каналов.
			<BR>
			- ¬ "рабочем" списке хран€тс€ "номера" (реально - смещени€) в ѕќЋ”„ј≈ћќћ потоке 
			(0 или 1 дл€ триггера, 2 - дл€ нулевого канала - и так далее, включа€ EXT)<BR>
			- дл€ карты нужно каналы, имеющие номера со 2 по кол-во пинов сделать -2, дл€ 
			бќльших - -nPins + 256<BR>
			- хранить нужно то же, что дл€ карты!!!</P>
		<P>21:52<BR>
			¬ыкрутилс€ путем сохранени€ в рабочем массиве не только "номера-смещени€", но и 
			основного номера канала ("карточного", с -1 дл€ триггера). ћожно бы и 
			дальше.... Ќо поздно уже -
			<BR>
			------------------------------------------------- чекин 
			--------------------------------------------</P>
		<P><STRONG>050609 чт</STRONG></P>
		<P>14:32<BR>
			—обственно, мне уже параметр (LPARAM)(&amp;m_atrParams) в сообщении 
			WM_DIZ_SHAPINIT и не нужен. Ёто хорошо, SnapView у мен€ становитс€ независимым 
			от главного окна - берет все параметры из файла. Ќо! ƒл€ диалога тоже что-то 
			такое нужно...</P>
		<P>15:30<BR>
			ѕродолжаем упрощать. ¬ файле (и CSnapView) количества пин- и экст-каналов мне 
			не нужны!!!</P>
		<P>15:37<BR>
			¬ообще-то у мен€ в классе _ChanW место под им€ канала отведено (32 байта) - но 
			никак не используетс€!!! ј если все-таки пользовать? ћожет быть легче будет???<BR>
			¬ заголовке под метку канала отведено 16 байт. —оответственно, мне должно 
			хватить 24 дл€ того, чтобы можно было сохранить как "номер" (A1-A32, EXT1-EXT8 
			etc), так и "метку". Ќо дл€ того мне нужно отследить всю "траекторию" 
			использовани€ этих имен и меток...</P>
		<P>16:44<BR>
			“ак, в списке имена присутствуют... ј дальше?<BR>
			- CSnapVeiw берет имена из pDispMap<BR>
			- там она устанавливаетс€ ф-ией CDlgView::SetMainMap(m_pFileMap, 
			m_File.GetChanNames());</P>
		<P>21:24<BR>
			ƒелаю перенос имен в файловый массив из списка. Ќе срабатывает дл€ EXT. » вновь 
			пошли какие-то перекосы с отображением вновь всключаемых экстов....</P>
		<P>21:45<BR>
			¬ общем, вроде бы как-то механизм передачи, “ќЋ№ ќ через список работает, Ќќ!
			<BR>
			1) Ќепон€тно, чтоможно передавать, если не прошла инициализаци€ файла (а она - 
			только при запуске)<BR>
			2) ѕри этом никак не отзваниваетс€ изменение смещений (нужно его передавать и в 
			файл тоже!!!)</P>
		<P>“огда получаетс€, что ‘айл имеет свою карту только при чтении. ѕри вводе он 
			должен ссылатьс€ на главную карту приложени€!!!!</P>
		<P>---------------------------------------------------</P>
		<P><STRONG>050610 пт<BR>
			</STRONG>Ќет, со снэповскими картами нужно по-другому! —сылка на главную - 
			бессмысленна. Ћучше уж насчитывать среднее смещение за потребленное врем€<BR>
			» еще - нужно обзавестись отдельным цветом дл€ "отсутствующих данных" (в 
			главной карте - до включени€ аппарата, в файловой - до прихода первого фрейма).</P>
		<P>14:58<BR>
			ƒл€ осуществлени€ вышесказанного (номер 2 - включенна€ карта при отс. данных) 
			все карты мен€ют тип с UCHAR на char - массовые изменени€....</P>
		<P>15:15<BR>
			«аведен доп. цвет _Settings::m_colorOffsetNone, возвращаемый при -1<BR>
			ѕри включении кажда€ клетка получает -1</P>
		<P>16:50<BR>
			 ак-то сделал, есть ощущение "не того". Ќо оно св€зано и с поведением программы 
			при отсутствии сигнала от девайса... —ейчас € "скидываю и запрещаю" главную 
			карту. ј нужно было бы - ставить еЄ в -1. » не зпрещать кол-во модулей и 
			тачпруфов....</P>
		<P>18:27<BR>
			—делал "синенькие" - включа€ переход в "не-режим" при выключении девайса. Ќужно<BR>
			- изменение этого цвета в диалоге<BR>
			- не то со снэпдиалогом</P>
		<P><BR>
			-------------------------------------------------------------------</P>
		<P><STRONG>050611 сб</STRONG></P>
		<P>15:52<BR>
			ѕерва€ проблема (не та карта в снэпшоте) объ€сн€лась тем, что при начальной 
			инициализации не устанавливалась мэйнфреймовска€ переменна€ m_pFileMap. втора€ 
			(вылеты при повторном создании любого дочернего окна после уничтожени€ всех) - 
			введением иконок: € при закрытии последнего окна уничтожал m_tabbedChildWindow, 
			а снова его не создавал...</P>
		<P>—ейчас видны следующие проблемы:<BR>
			- не уничтожаетс€ один из списков меток<BR>
			- проблемы при закрытии не-первого осцилла</P>
		<P>16:42<BR>
			Ќе уничтожалс€ список меток файла. ѕроблемы с закрытием осцилла отловить не 
			удаетс€ :( ј "ошибки" в распределении пам€ти - артефакт расстановки соотв. 
			меток....</P>
		<P>16:48<BR>
			изменени€ в основной карте нужно обозначать и в снэпшотовых - ежели таковые 
			произошли....</P>
		<P>” мен€ что-то не то с подсчетом каналов в снэпвью.</P>
		<P>17:55
			<BR>
			ƒолго не мог пон€ть, что у мен€ происходит с цветами каналов снэпшота. ¬ы€снил: 
			в нЄм € решил идти циклом по¬—≈ћ каналам (как отображаемым, так и нет) - чтобы 
			конкретный цвет осталс€ зафиксированным за каналом... ¬от и получилось....</P>
		<P>18:26<BR>
			–едактирование и использование цветов дл€ недоступных и выключенных каналов, 
			отс. данных.</P>
		<P>19:03<BR>
			—делал неотключаемыми контролы харддиалога (чтобы можно было устанавливать 
			желаемое при отсутствии харда или его выключенности). Ќепр€тна€ новость: рваный 
			вывод при высоких частотах дискртизации. ѕричем и в релиз-сборке (старой, той 
			что послана) - тоже :(((</P>
		<P>19:22<BR>
			ѕерезагрузилс€, проверил - все то же самое... Ќо! “акого эффекта нет, если 
			включить децимацию. Ergo - эффект отображалки.... ѕошел...</P>
		<P>---------------------------------</P>
		<P><STRONG>050614 вт<BR>
			</STRONG>»так, нужно решить, что именно в каких режимах оторажать. я про карту 
			устройства-файловую карту. ћне кажетс€, что при открытом файле вместо HardDlg 
			следует отображать информацию об этом файле - и, соответственно, его карту (без 
			возможности редактировать). ¬ключение аппарата при этом никак не отображаетс€ 
			(ну или еще один "диодик"). »нформаци€ о файле - это его им€, кол-во записей и, 
			возможно, начальна€ информаци€ из "локальных описаний". ѕри этом им€ файла 
			должно добавл€тьс€ к имени главного окна программы!!!</P>
		<P>Ќо сразу попробуем решить и еще одну проблему: собственно образование из 
			открытого файла нужных дл€ дальнейшей работы структур....</P>
		<P>14:08<BR>
			¬се же не выдержал - вернулс€ к субботней проблеме с рваным рисованием. 
			¬озникша€ за выходные мысль: оно может быть вызвано большим временем, 
			проводимым "рисовательным" фрагментов с закрытой битмэп-секцией - ну и 
			"таймерна€" просто не получает доступа к рисованию. «ахотел попробовать - но 
			обнаружил, что из таймерной слишком много точек выхода (кажда€ - с 
			освобождением крит. секции). ћодифицировал, поставив вместо возврата взведение 
			исключени€. ѕробуем.</P>
		<P>14:14<BR>
			ѕопробовал. Ќе помогает. ѕохоже, что множество исключений выбрасываетс€. Ѕудем 
			исследовать.</P>
		<P>----------------------------------------</P>
		<P><STRONG>050615 ср</STRONG></P>
		<P>ћожно так сказать, что сутки над проблемой просидел... Ќу и что??? —ущность 
			проблемы €сна: при высокой частоте дискретизации поток слишком много времени 
			проводит в построении линий - и на отрисовку его просто не хватает... ќтсюда - 
			и рваность вывода<BR>
			ѕопробовал вернутьс€ к мультимедийному таймеру дл€ осцилла - не получилось 
			совсем ничего: €вный уход в дедлоки... ƒа и в принципе это ничего дать не 
			может: ¬—≈ мультимедийные таймеры живут в ќƒЌќћ потоке, так что кроме мешанины 
			€ ничего не получу... "ѕромежуточный" вариант (пересылка сообщени€ от 
			ћћ-таймера граф. потоку) тоже не помогает :((( “ак что приходитс€ возвращатьс€ 
			к старому-доброму WM_TIMER. ≈динственное, что € здесь сделал - это заместил его 
			на WM_DIZ_WTIMER в надежде, что таковое сообщение отвергатьс€ потоком уже не 
			будет. Ќо и это несущественно. ѕокамест помогла только усиленна€ оптимизаци€ 
			данной функции - вроде бы с ней (с оптимизацией) и в релиз-сборке дерганий не 
			наблюдаетс€....<BR>
			<BR>
			16:13<BR>
			Ќо зато наблюдаютс€:<BR>
			<FONT color="#990000"><STRONG><FONT color="#000099">- перекосы окна при 
						включении-выключении отображени€ тригканала</FONT><BR>
					<FONT color="#000099">- не создаетс€ (а точнее - тут же удал€етс€) осцилл, вновь 
						создаваемый в процессе ввода.....</FONT></STRONG></FONT></P>
		<P>Ѕудем разбиратьс€</P>
		<P>16:16<BR>
			— первым все вроде бы просто: € почему-то не посылал осциллам сообщением 
			WM_DIZ_MAPCHANGED. Ќо!!! ѕри повторных включени€х-выключени€х - тот же самый 
			"вылет" (самозакрытие окна). „ерт, откуда оно может вз€тьс€???</P>
		<P>17:42<BR>
			–азобралс€. —ообщение, конечно же, посылать не нужно. ј переосы возникают из-за 
			того, что при отсутствии тригзоны не инкрементировалс€ счетчик тригканала - ну 
			и, соответственно, после включени€ он оказывалс€ неизвестно где....</P>
		<P>17:50<BR>
			C вылетами осцилла тоже пон€тно: ему не устанавливалась частота... ј вот 
			почему??? я ведь вроде эту проблему уже решал....<BR>
			ѕравильно!!! –аньше работало, потому что по умолчанию m_nFrq = 2048 - вот 
			только при этой частоте и работало....</P>
		<P>21:00<BR>
			јктивно проведенный вечер:<BR>
			- изменени€ в CHardDlg:<BR>
			&nbsp; - ≈сли нет драйверов, ничего не отображаем, кроме соотв надписи<BR>
			&nbsp; - Ќова€ кнопка - сигнал о включении-выключении питани€
			<BR>
			&nbsp; - кнопковидное окошко с информацией о файле, перекрывающей все остальное 
			(кроме индикатора питани€)</P>
		<P>- изменени€ в CDataFile::Open - первые попытки чтени€ реальных параметров, ф-ии 
			экспорта этих данных</P>
		<P>-----------------------------------------------------------------------------</P>
		<P><STRONG>050616 чт</STRONG></P>
		<P>13:40<BR>
			»зменени€ в алогритме считывани€ параметров: текстовые пол€ могут не иметь 
			нулевых окочаний (т.е. могут смыкатьс€), поэтому необходимо принудительное 
			преобразование в CString</P>
		<P>14:40<BR>
			≈сли драйверов нет, то после закрыти€ файла основные контролы диалога не 
			показываютс€.</P>
		<P>//отошел от дел: зан€лс€ записью своих фотографий. ѕодготовил и скинул все 
			старые (с 2001 года начина€) - плюс кэноновские за декабрь 2004- €нварь 2005, 
			то есть первый диск. » больше ничего...</P>
		<P>-------------------------------------------------------</P>
		<P><STRONG>050617 пт<BR>
			</STRONG>¬се то же самое: продолжил обработку фотографий. ¬торой диск - 
			февраль-апрель 2005 года. —ейчас пишетс€ второй экземпл€р, а первый в это врем€ 
			провер€ю на чтение.</P>
		<P>15:55<BR>
			ѕри открытом на чтение файле мне нужно запретить кнопки "новый осц", "Run", 
			"Pause". Ѕолее того, при открытии файла все текущие окна должны быть закрыты!!! 
			¬идимо, дл€ этого "файл" должен возвращать некий код (не только есть файл или 
			нет - но и открыт ли он на запись или чтение).</P>
		<P>19:16<BR>
			- «аведены переменна€ и функци€ кода файла
			<BR>
			- закрытие всех окон перед открытием файла, при закрытии файла<BR>
			- подправлена логика разрешени€ команд<BR>
			- закрытие всех окон реализовано через RemoveOsc()<BR>
			- ѕеред закрытием программы закрываем файл</P>
		<P>19:20<BR>
			ѕри открытии файла главна€ карта запрещаетс€ Ќо!!! ќна и ссылатьс€ должна на 
			файловую карту - а € таковую даже не строю пока...</P>
		<P>¬ечером зан€лс€... ”же не помню, чем :) ƒа, видимо стал разбиратьс€ с видимостью 
			"левых диалогов" - ведь получаетс€, что при чтении файла (и вообще в случае 
			отсутстви€ драйверов) они мне и не нужны... » тогда посетила мысль: а нельз€ ли 
			задействовать дл€ индикации состо€ни€ питани€ (ну и батарей с CMS заодно) 
			статус бар??? ѕосле чего отвлекс€ на пришедшее от Ќади письмо - ну и забросил 
			это дело (сначала письмо раскодировал, потом на него отвечал). ƒома продолжил 
			отвечать - но после все же вернулс€ к проблеме: первые попытки показали, что со 
			статус-баром управл€тьс€ можно...</P>
		<P>-------------------------------------------------------------------------------------------------------------------------------</P>
		<P><STRONG>050618 сб<BR>
			</STRONG>”тром в очередной раз поснимал воробьев у ћосковской. ¬роде бы и 
			удачно (застал очень подход€щую семейку, и на хорошем месте) - но по-насто€щему 
			удачного кадра нет: все не те ракурсы. Ѕольше нужно было снимать, больше....</P>
		<P>13:00<BR>
			Ќа работе вплоную зан€лс€ статусбаром. —качал чью-то программку, в нем элементы 
			мен€ющую, но ей пользоватьс€ не стал. —начала игралс€ с "исходным" 
			CMultiPaneStatusBarCtrl, потом произвел от него свой класс, потом - уже совсем 
			насто€щий класс
			<BR>
			class CDizStatusBar : public CMultiPaneStatusBarCtrlImpl<BR>
			ѕолучалось все далеко не сразу, но наконец...</P>
		<P>17:00<BR>
			ћой статус-бар работает - и отображает все, что нужно. “ак что теперь нужно<BR>
			- убрать кнопку "питание" из харддиалога<BR>
			- убирать все левые диалоги при отсутствии драйверов или открытии файла на 
			чтение<BR>
			- при открытии файла на чтение подставл€ть вместо них окошко с информацией о 
			файле.</P>
		<P>17:26<BR>
			»ндикаторы Power иFile&nbsp; из хард-диалога убраны. “еперь мне нужно решить, 
			что и каким образом сажать на место левых диалогов при отсутствии драйверов - и 
			при чтении файла. ѕожалуй, € попробую поступить следующим образом: создам одну 
			на всЄ инфо-панель с единственным текстовым полем - а уж заполн€тьс€ оно будет 
			как-нибудь потом...</P>
		<P>18:03<BR>
			Ќовый класс CInfoPanel создан, панель в нем заполн€етс€ (сейчас - также, как 
			вчера делал в харддиалоге), по умолчанию она сообщает об отсутствии драйвров. 
			“еперь мне нужно пон€ть, как поступить с показом этой панели в случае 
			отсутстви€ драйверов (и что делать при закрытии файла).</P>
		<P>18;14<BR>
			»нфо-панель действительно сделана - и ведет себ€ именно так, как мне хотелось. 
			ј вот с разрешением кнопок - оп€ть проблемы: почему-то при отсутствии драйверов 
			оказываютс€ разрешены запуск и создание новых окон...</P>
		<P>18:47<BR>
			Ћогику разрешени€ команд тоже подправил.</P>
		<CDIZSTATUSBAR>
			<P>19:56<BR>
				ѕервые шаги по расшифровке имен каналов. ¬роде бы карту получаю адекватную. ј 
				имена мне все равно брать неоткуда :)</P>
			<P>Ћадно, наверное таки на этом - завершим....</P>
			<P>---------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050620 пн<BR>
				</STRONG>¬ ходе воскресного окучивани€ картошки пон€л, чего € хочу: избавитьс€ 
				от разделени€ левой части и от CLeftDlg вообще: сделать "основную карту" частью 
				CHardDlg, сделать последний resisable - и поместить итоговый диалог на таб. ѕри 
				этом в ту же зону (но на другие табы) будут помещатьс€ окно с информацией о 
				файле и списко записей. ¬идимо,на последних двух придетс€ сделать уменьшенную 
				(и read-only) версию карты - дл€ сохранени€ услови€ посто€нного наблюдени€ за 
				качеством каналов.</P>
			<P>12:30<BR>
				ѕервое достаточно успешное перемещение карты в CHardDlg, отмена CLeftDlg</P>
			<P>13:16<BR>
				”странено разбиение левой панели. “еперь нужно сделать табы....</P>
			<P>15:05<BR>
				”фф, вроде бы и карта из файла считываетс€ нормально....</P>
			<P>15:35<BR>
				”же полчаса борюсь с двум€ проблемами харддиалога:<BR>
				- изменине кол-ва модулей при выключенном харде приводит к позеленению кнопочек<BR>
				- первое выключение тачпруфов при выклчюенном харде дизеблит их.</P>
			<P><STRONG>---- + 050621 вт</STRONG></P>
			<P>¬ ходе разборок навы€сн€лось много интересного...
				<BR>
			</P>
			<P>ƒл€ начала - озаботалис€ "бр€канием" программы при запуске. ќдин из его 
				источников - некорректна€ обработка сообщений статусбаром (вызываемые 
				обработчиками функции на самом деле посылали те же самые сообщени€, что в итоге 
				приводило к переполнению стека). ƒругой... ƒругой вообще оказалс€ скрыт в 
				недрах взаимодействи€ системы с матрасовскими средствами восстановлени€ 
				положени€ окон: такой бр€к по€вл€етс€ у любой программы с составным статусбаром 
				и вызываетс€ тем, что в какой -то момент такой статусбар в ответ на GetParts 
				(SB_GETPARTS) возвращает 0... Ѕыло "вылечено" самосто€тельным восстановлением 
				положени€ окна (SetWindowPlacement/GetWindowPlacement). Ќо при этом, похоже, не 
				вполне корректно отрабатываетс€ "статус" окна (то есть было ли оно 
				максимизировано или нормально)</P>
			<P>------------------------------------------------------------------------------------------------------<BR>
				<STRONG>050622 ср<BR>
				</STRONG>Ќо это было еще не всЄ... ѕопутно вы€снилось, что<BR>
				- при отсутствии конфигов программа на ввод запускатьс€ не хочет<BR>
				- при большом количестве открытых дочерних окон, если некторые из них наход€тс€ 
				за пределами основного, программа виснет и при закрытии... ќх и муторные 
				разборки :(((</P>
			<P>15:20<BR>
				Ќекорректность при запуске вызывалась неинициализированными переменными 
				m_nDisp&nbsp;и&nbsp;m_nRef в CDlgView - при запуске ранее не запускавшейс€ 
				программы они имели отрицательные значени€, ну и пам€ть, естественно, не 
				выдел€лась</P>
			<P>16:00<BR>
				ѕродолжаем борьбу со статусбаром: все же стандартный текст выводить тоже 
				хочетс€.... «адача решена расширением обработки сообщени€ SB_SETSIMPLE: при 
				переходе в "простой" режим (дл€ вывода сообщени€-подсказки) пр€чутс€ все 
				дочерние окна...</P>
			<P>18:00<BR>
				—ама€ непроста€ из перечисленных - проблема с закрытием окошек... ¬роде бы все 
				делаетс€ честно - но.... ¬ итоге чисто эксппериментальным путем установлено, 
				что наиболее стабильно работает такой механизм:<BR>
				&nbsp;&nbsp;&nbsp; int N = m_arpDialog.GetSize();
				<BR>
				<FONT color="#3300cc">&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; N; i++)&nbsp;<BR>
					&nbsp;&nbsp;&nbsp;{
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveOsc(0);
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sleep(200);
					<BR>
					&nbsp;&nbsp;&nbsp; }<BR>
				</FONT>’от€&nbsp;почему лучше работает именно он (и будет ли он работать 
				всегда) € не знаю :(((</P>
			<P>&nbsp;19:10<BR>
				јналонгично нужно поступать и в других местах, где закрываютс€ все окна (перед 
				открытием файла, при закрытии файла)<BR>
				<STRONG><FONT color="#000099">ѕри открытом файле получаю "пустые" снэп-диалоги (нулевое 
						кол-во каналов). ѕочему???<BR>
						«акрыть файл не удаетс€...</FONT></STRONG></P>
			<P>»щем дальше....</P>
			<P>20:10<BR>
				ѕервое очень похоже на недоработку (отвлекс€ на тулбар, переделку левой 
				панели)???? ¬роде исправлено. ј закрытие файла - очень смахивает на то же, что 
				наблюдалось ранее... ѕричем иногда закртыие таки происходит - спуст€ немалое 
				врем€....</P>
			<P>20:40<BR>
				Ѕоролс€ с утечками пам€ти - недотирал образованные хедеры....</P>
			<P>20:50<BR>
				ќткрытие снэпов - просто мрак: первые еще кое-как, второй&nbsp; - уже никак 
				(при открытом на чтение файле)....</P>
			<P>21:00<BR>
				“аак.... я теперь вообще не понимаю, как у мен€ происходит создание снэпов: вид 
				просто не успеват создатьс€ - а уже хочет диалог...</P>
			<P>21:45<BR>
				ѕроблема, как всегда, оказалась в не тех переменных: при открытии файла € не 
				инициализировал переменные m_nChLen и m_nTrLen, в итоге получал требование на 
				выделение пам€ти безмерной длины (под гиг) - вот второй снэп и не создавалс€. 
				ѕодправил. —оздаютс€. Ќо голова - уже вообще никака€... ѕошел...</P>
			<P>-----------------------------------------------------------<BR>
				<STRONG>050623 чт</STRONG></P>
			<P>„тобы избавитьс€ от проблем с запрещением закрыти€ первого снэпа, разрешу их 
				открывать только при открытом файле (а открытие или создание файла само будет 
				созадвать первый снэп). ѕри попытке закрыти€ первого снэпа будем спрашивать, 
				закрыать ли файл.</P>
			<P>21:50<BR>
				—делал - и снова напоролс€... –ассказывать долго - допишу дома...</P>
			<P>---------------------------------------------------------------------------------<BR>
				<STRONG>050624 пт<BR>
				</STRONG>ƒома не поулчилось :) ѕишу на работе.<BR>
				Ќапопролс€, в очередной раз, на незакрытие дочернего окна: диалог посылает 
				граф. потоку сообщение WM_QUIT - но поток его не ловит... √де только не 
				смотрел, с чем только не игралс€ - всЄ одно... ¬ итоге точно вы€снил, что 
				прблема возникает “ќЋ№ ќ если закрытие вызваетс€ кнопкой в окошке вида (и не 
				возникает при нажатии аналогичной кнопке диалога либо команде закрыти€ файла). 
				ѕри включении отладочных трейс-сообщений в соотв. ф-ии (<FONT color="#000099">CActDView::OnNcLButtonDown</FONT>) 
				проблема исчезала - но только в режиме отладки. ¬ итоге обошелс€ установкой 
				разнообразных задержек - но не нравитс€ мне это: может оказатьс€ специфичным по 
				отношению к компьютеру, системам - и еще бог знает чему....</P>
			<P>13:20<BR>
				јльтернативный метод: в вышеупом€нутой ф-ии <FONT color="#000099">CActDView::OnNcLButtonDown</FONT>
				сам анализирую на флаг <FONT color="#000099">HTCLOSE</FONT> и делаю то, что 
				нужно - <FONT color="#000099">::PostMessage(m_hFrame,WM_DIZ_VIEW_CLOSE,0,(DWORD)this);</FONT>
				ѕохоже, что так срабатывает безо вс€ких задержек...</P>
			<P>13:25<BR>
				ƒа, в таком варианте задержки станов€тс€ не нужны даже в "главной функции"!!!!</P>
			<P>15:27<BR>
				ѕреотвращени€ ненужных отрисовок снэпшота при отсутствующих данных. «аливка 
				дефолтовым цветом</P>
			<P>18:45<BR>
				ѕосле долгих-долгих мытарств - перва€ отрисовка данных из прочитанного файла!!!</P>
			<P>19:15<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">¬ BDF-файлах триггер идет последним, а 
							не первым!!!<BR>
						</FONT><FONT color="#000099"> оэффициенты не переустанавливаютс€....<BR>
						</FONT></FONT><FONT color="#000099">≈сли открыто более одного снэпшота, файл не 
						закрываетс€...</FONT></STRONG></P>
			<P>19:20<BR>
				Ќеотклик на коэффициенты был об€зан тому, что мейнфрейм не возвращал файловую 
				частоту.</P>
			<P>19:44<BR>
				ѕопытка более интеллектуальной передачи номеров каналов виду... “еперь вроде бы 
				все правильно - но проверить можно будет только в реале...</P>
			<P>20:10<BR>
				“ааак... ” мен€ же теперь все не-первые окна не закрываютс€ :((((<BR>
				ѕришлось снова поставить Sleep(200) - теперь закрыаютс€....<BR>
				≈ще одна проблема - что делать с "дублированными" каналами (ActiView может 
				записывать один канал несколько раз, и с ¬ар€гиной именно это и получилось)</P>
			<P>20:25<BR>
				ќтсекаю дублирующиес€ каналы при открытии файла. Ќо, видимо, мне нужно и 
				первоначальное число хранить - и сообщать....</P>
			<P>20:31<BR>
				—охранение и возвращение разного кол-ва каналов (записанных и уникальных)</P>
			<P>“еперь нужно:<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- ѕередать кол-во записей диалогу<BR>
							- в диалоге обрабатывать изменение текущей записи<BR>
						</FONT></FONT><FONT color="#000099">- список записей (пока - простой)&nbsp; 
						//050701</FONT></STRONG></P>
			<P>попробуем... Ќо уже не сегодн€....</P>
			<P>------------------------------------------------------------------------------</P>
			<P><STRONG>050625 сб</STRONG></P>
			<P>14:18<BR>
				ѕосле долгой борьбы с константностью (фреймы и файлы - константные указатели, а 
				не указатели на константы!!!) таки добилс€ переключени€ записей в диалоге. 
				“еперь нужно:<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- отображать в виде номер текущей 
							записи<BR>
						</FONT></FONT><FONT color="#000099">- переиначить ф-ию чтени€ (лучше, если она 
						сходу будет считывать в вызывающий буфер, и без перекоса основных указателей)<BR>
					</FONT><FONT color="#000099">- обрабатывать ручное изменение едит-бокса<BR>
					</FONT></STRONG>перекур</P>
			<P>14:55<BR>
				ќбработка ручного ввода номера записи</P>
			<P>15:18<BR>
				ќбработка клавиш дл€ перехода между запис€ми.</P>
			<P>15:24<BR>
				ƒополнительное поле в указателе - номер записи. ќтображение номера записи.</P>
			<P>17:26<BR>
				Ѕездну времени провел - никак ничего не рисовалось :((( ѕохоже, что проблема 
				вчерашн€€: триггер идет не первым, а последним в списке файловых каналов. Ќо 
				как же тогда € рисовал вчера вечером-сегодн€ утром?????</P>
			<P>--------------------------------------------------------------------------------------------</P>
			<P><STRONG>050627 пн</STRONG></P>
			<P>Ћадно, почему работало - дело все-таки дес€тое. Ќе должно было. ¬ любом случае 
				там ошибка - и более того, непонимание. ¬едь в CSnapView € хочу список (и 
				количество) отображаемых јЌјЋќ√ќ¬џ’ каналов - а файл предоставл€ет мне ќЅў»… 
				—ѕ»—ќ , в котором на ЋёЅќћ месте могут оказатьс€ триггер, аннотации - и вообще 
				черт в ступе....</P>
			<P>&nbsp;¬о-первых, CSnapView::m_nChanNum - должен содержать кол-во јЌјЋќ√ќ¬џ’ 
				каналов заполн€етс€ в<BR>
				- CSnapView::OnSnapInit() - m_nChanNum = m_pFile-&gt;GetNumOfChans() - 1; 
				//нуждаетс€ в замене, тк может быть отнюдь не -1...<BR>
				  счастью, это - единственное место, где это кол-во определ€етс€. Ќо, видимо, 
				ему в дополнение нужно и общее кол-во записанных (записываемых) каналов...<BR>
				- —ама CSnapView::OnSnapInit() вызываетс€ в путем отправки соотв. сообщений из 
				OnRunGo OnSnapNew (обе- в CMainFrame)</P>
			<P>13:51<BR>
				ƒл€ "более общего варианта" мне нужен будет преобразователь номеров каналов - 
				по аналогии с уже имеющимс€ m_pnChanNums - дл€ того, чтобы аналогвые циклы (так 
				же как и тригканал) брать "пр€мо" из входного буфера.</P>
			<P>14:45<BR>
				‘айлова€ ф-и€ уже возвращает два разных числа:<BR>
				int GetNumOfChans(bool bReal = true) const
				<BR>
				{
				<BR>
				&nbsp;&nbsp; return (bReal) ? m_nChanNum:m_nRecordedChans;
				<BR>
				}<BR>
				¬опрос в том, что же там такое m_nChanNum???</P>
			<P>Ѕеретс€ она в ф-ии FileInit как m_nChanNum = parChanW-&gt;GetSize(); и при 
				открытии файла - как число неповтор€емых каналов. Ќо возникает вопрос: 
				включаетс€ ли сюда триггер??? ѕопробуем... ƒа, получаетс€ что включает...</P>
			<P>15:17<BR>
				» в файле, и в виде соотв. "файловые" списки переимнованы в m_pFChans<BR>
				¬ самом деле: зачем мне держать в файле триггерный канал вместе со всеми 
				остальными??? ћожет быть, выделить его отдельно? ¬едь он же - отдельный....</P>
			<P>17:09<BR>
				¬ообще-то что-то непон€тное было с частотами: при записи нового файла как 
				"основна€" почему-то запоминалась триггерна€ частота - если € ничего не 
				путаю.... Ќужно быть готовым к неожиданност€м.</P>
			<P>18:30<BR>
				ќсложнил задачу: выделил в файле триггер в отдельный канал (отделил его от 
				аналоговых). Ќо это оказалось неудобно при записи: там-то € иду напропалую по 
				всем каналам... » без такового выделелни€ индексы просто совпадали - а 
				теперь... » что теперь делать???</P>
			<P>19:30<BR>
				ƒолго анализировал ситуацию... ¬роде бы получаетс€ так, что € могу "засунуть" 
				блок, начинающий новый буфер, внутрь триггерного ифа (все равно таковое решение 
				может быть прин€то лишь на основании анализа тригканала).</P>
			<P>21:14<BR>
				Ќу вот, как-то это дело вроде преобразовал. Ќо похоже, что на чтении с 
				тригканалом не то... Ќадо провер€ть....</P>
			<P>21:30<BR>
				ѕодправил (неправильно записывалось смещение). Ќу вот ,теперь можно было бы 
				обобщить - и тестировать. Ќо не сегодн€....</P>
			<P>---------------------------------------------------------------------------------------</P>
			<P><STRONG>050628 вт</STRONG></P>
			<P>14:00<BR>
				Ѕольше часа на работе - и ни одной мысли в голове... ’от€ все просто: мне 
				наконец нужно сформировать заголовок своего файла - и пробовать писать, после 
				чего - читать свои и "фирменные" файлы</P>
			<P>15:42<BR>
				—делана заготовка "заголовочного диалога". ѕокамест ничего не обрабатываетс€ и 
				не мен€етс€. Ќе знаю, как присвоимть "дейтпикеру" английский €зык....</P>
			<P>17:48<BR>
				ѕервое формирование самого главного заголовка. —оздание файла.</P>
			<P>19:04<BR>
				ѕолный заголовок буду формировать в FileInit - вызываетс€ она только при 
				запуске с новым файлом</P>
			<P>20:42<BR>
				ѕосле создани€ нового файла - вылеты: €вно лезу куда-то не в ту пам€ть. Ќо:
				<BR>
				- “олько в случае создани€ вида<BR>
				- “олько если ƒќ “ќ√ќ не было открыти€ файла на чтение.<BR>
				Ergo- что-то не инициализирую в файле....</P>
			<P>21:47<BR>
				„то-то победил - но далеко не... ѕроблема с переданной файлу картой остаетс€: 
				что делать, если файл создан до включени€ - и после этого пошло изменение 
				основной карты??? » с прочими пам€тными вопросами нелегко....</P>
			<P>-------------------------------------------------------------------------------------------</P>
			<P><STRONG>050629 ср</STRONG></P>
			<P>ƒомашние эксперименты показали, что вылеты при изменении карты (при выключенном 
				девайсе) объ€сн€ютс€ кривым поведением () при нулевом количестве каналов. 
				ќтсюда следует два вывода:<BR>
				- ¬се же € хочу, чтобы при выключенном девайсе количество каналов в дочерних 
				диалогах и видах было не нулевым - а соответствовало заданному в харддиалоге<BR>
				- ¬о-вторых (но решать этот вопрос нужно первым) программа все же должна 
				работать и при нулевом кол-ве аналоговых каналов (возможно - с 
				предупреждением): мало ли кто захочет пользовать только триггер....</P>
			<P>ƒома в итоге изменил принцип формировани€ списка фаловых каналов - вместо 
				"пр€мого массива" m_pFChans сделал CSimpleArray&lt;&gt; m_arFChans, это 
				позвол€ет заполн€ть массив без предварительного вы€снени€ того, сколько же в 
				нем будет каналов. » вот тут-то и нарвалс€ на ошибку при выделении пам€ти на 
				массив из одного инта... —ейчас проверил в отдельной программульке - вроде как 
				така€ операци€ спокойно проходит.. «начит, дело не в этом...</P>
			<P>15:43<BR>
				¬ы€снил: неполадки с вызовом оператора new начинаютс€ после использовани€ 
				SetChanType()!!!</P>
			<P>17:34<BR>
				Ёффект, конечно, потр€сающий (видеть, как оператор new возвращает 0 - непон€тно 
				почему....) - но источник прост: в заголовке поле Reserved имеет длину 32 
				символа, а в ф-ии копировани€ € засовывал в него 80... ѕосле исправлени€ вроде 
				как всЄ OB.</P>
			<P>17:40<BR>
				ѕопытки записи без включенных каналов:<BR>
				- у осцилла рваный вывод - до изменени€ длины. √де-то что-то не передаетс€....<BR>
				- ѕризнаков записи нет....</P>
			<P>18:15<BR>
				— рваным выводом разобралс€: диалог показывал уже после запуска таймера - и он 
				задерживал его обработку... ѕроверка и диалог перенесены в самое начало.</P>
			<P>19:05<BR>
				ќтсутствие записи - это сложнее... я же теперь насчитываю CDataFile::m_nChanNum 
				как кол-во јЌјЋќ√ќ¬џ’ каналов - а в алгоритмах ввода оно считаетс€ как ¬¬ќƒ»ћџ’ 
				- то есть с учетом и триггера тоже... ¬от и отлетаю - по разнице между 
				полученными и имеющимис€....</P>
			<P>19:21<BR>
				ѕеревел все соотв циклы на записываеме каналы - все равно ничего.... »скал 
				долго: оказалось, € в карте вида сообщение WM_DIZ_SHAPNEW закомментировал :)) 
				”брал комментарий - первый вью рисуетс€. Ќо - только первый....</P>
			<P>19:43<BR>
				Ќет, не только первый - нарисовалось 6 штук. » - в глухой завис :(</P>
			<P>20:43<BR>
				ѕока нашел только одну ошибку: попытку выделени€ пам€ти до должной 
				инициализации (в снэпвью, при отрицательной тригдлине).  акие там потоки 
				"кончают с собой" - соверешнно непон€тно. “ак же как и то, каким образом € 
				дохожу до...</P>
			<P>21:10<BR>
				—тало чуть легче: € обнул€л счетчики не по всем каналам (все та же разница в 
				двойном наименовании). Ѕолее того, в отладочных цел€х поставил выделение пам€ти 
				под 50 :) ’орошо, что на бќльшем количестве не попробовал ≈:)) Ќо все равно - 
				какие-то два потока прекращаютс€.... ’от€ это, вроде бы, ничему не мешает...</P>
			<P>21:30<BR>
				ѕри очередной попытке вроде почти все прошло удачно.<BR>
				«апуск без аналоговых каналов: тоже идет, но SnapView ничего не отображает - и 
				при выходе информаци€ о двух утечках нулевой длины.<BR>
				--------------------------------- завершаем 
				--------------------------------------</P>
			<P><STRONG>050630 чт</STRONG></P>
			<P>14:24<BR>
				«аписи в файл пока нет - однако команда "закрыть файл" не выполн€етс€ :((( 
				Ѕоюсь - все по той же причине....</P>
			<P>14:50<BR>
				ѕри открытии файла на чтение закрытие идет нормально. Ѕыли неполадки с 
				указателем на главное окно (CDataFile::m_pMainFrm) - но устранены, причем с 
				запасом:<BR>
				- инициализаци€ в конструкторе<BR>
				- инициализирующа€ функци€</P>
			<P>16:02<BR>
				ќчередное решение наболевшей проблемы: диалог перед тем, как закрывать вид, 
				принудительно назначем ему родителем главное окно. —делано из-за наблюдени€: 
				зависы происход€т (только с первым снэпом) только в случае, когда он 
				"свободен"....</P>
			<P>16:56<BR>
				ѕосле сн€ти€ в CSnapView двух проверок стало возможным отображение ввода без 
				аналоговых каналов.<BR>
				<STRONG><FONT color="#000099">Ѕлижайшее TODO - правильна€ расстановка кнопок при 
						запуске (чтобы не было изначального разрешени€).</FONT></STRONG></P>
			<P>17:40<BR>
				<STRONG><FONT color="#cc0066">ќднако заметил: у мен€ все равно "пропадает" несколько 
						областей нулевой длины. Ќадо бы ликвидировать...</FONT></STRONG></P>
			<P><FONT color="#000000">18:05<BR>
					ѕри запуске ¬—≈√ƒј выключаю мануальный ввод, а при гейт-режиме - ставлю паузу.<BR>
					–азрешено закрытие нулевого снэпшота при отсутствующем файле (дл€ теста 
					триггеров).<BR>
					–азрешить создание снэпшотов при текущем вводе в тригрежиме.</FONT></P>
			<P>18:08<BR>
				”гу. ¬ернемс€ к вопросу о картах: при создании снэпшота на лету получаетс€ 
				пуста€...</P>
			<P>19:55<BR>
				–азобралс€ - при инициализации файла в нем не насчитывались соотв. количества 
				каналов, а при создании снэпшота ему не передавалась файлова€ карта. —ейчас 
				передаетс€. —ледующие задачи:<BR>
				<FONT color="#cc0066"><STRONG><FONT color="#000099">- Ќенулевые карты при выключенно 
							девайсе (возможность предварительного заполнени€)<BR>
						</FONT><FONT color="#000099">- насчет смещений в файле<BR>
						</FONT><FONT color="#000099">- странна€ отрисовка в файле (что-то не то с нул€ми на 
							коцне при тригвводе с претригом)</FONT></STRONG></FONT></P>
			<P>20:12<BR>
				¬роде бы с картами разобралс€....</P>
			<P>20:37<BR>
				—о смещени€ми получаетс€ не так просто: если € хочу, чтобы в снэповых картах 
				отображались средние смещени€ по текущей записи - то и цвета должны братьс€ не 
				из главной карты - а индивидуально. Ќо при этом главную карту € отмен€ть не 
				могу :((( ѕолучаетс€, что придетс€ делать еще одно ветвление в самом классе 
				карт - откуда брать цвета....</P>
			<P>21:22<BR>
				ѕерерасчет карт сделан!!! “еперь действительно считаю пр€мо в фрейме - и 
				отзваниваю в своем диалоге!!!</P>
			<P>Ќа сегодн€ - хватит....</P>
			<P>-----------------------------------------------------------------------------------------</P>
			<P><STRONG>050701-home (00:40)</STRONG></P>
			<P>ќдна небольша€ косметичсеска€ добавка:&nbsp;в CSnapDlg введен CUpDownCtrl дл€ 
				смены&nbsp;записей (невидимый); изменены и кнопки: на пред. реализацию смещают 
				кнопки влево и вверх, на следующую - вправо и вниз,&nbsp;PAGE_UP (VK_PRIOR) 
				теперь смещает на 8 записей назад, аPAGE_DOWN (VK_NEXT) - на 8&nbsp;записей 
				вперед (если когда-нибудь будут многозаписные виды - будут смещать на длину 
				экрана)</P>
			<P>050701 -&nbsp;фин</P>
			<P>11:53<BR>
				Ѕлижайшие задачи:<BR>
				<STRONG><FONT color="#cc0066">-<FONT color="#000099"> реальна€ запись в файл<BR>
						</FONT><FONT color="#000099">- список<BR>
						</FONT></FONT><FONT color="#000099">- Locked &amp; Unlocked snapshots</FONT></STRONG></P>
			<P>13:22<BR>
				ѕосле долгих мытарств&nbsp;что-то в файл записалось - и он даже открылс€... Ќо 
				внутри все совсем не то :(((</P>
			<P>15:16<BR>
				јга, ошибка была в вычислении размеров записи (и смещений) при инициализации 
				файла. —мещени€ и размеры считаютс€ в <STRONG><FONT color="#000099">int24</FONT></STRONG>!!! 
				Ёто означает, что "плюсовое" смещение равно <FONT color="#000099"><STRONG>64</STRONG></FONT>
				(а <STRONG><FONT color="#cc0066">не 64*3</FONT></STRONG> - вот источник 
				неполадок в конце), а&nbsp;писать нужно <STRONG><FONT color="#000099">m_nRecSize*3</FONT></STRONG>
				(там это в байтах).
			</P>
			<P>‘айл записалс€ и читаетс€!!!
				<BR>
				<STRONG><FONT color="#000099">ѕри чтении не отображаютс€ данные реализации...</FONT></STRONG></P>
			<P>15:22<BR>
				ѕоследн€€ проблема тоже решена - просто при чтении реализации нужно 
				в&nbsp;полученном принудительно устанавливать файловый флаг m_bPlus</P>
			<P>15:30<BR>
				»з старых воспоминаний: запрещение карты в CFInfoPanel....<BR>
				Ќачинаю создавать список....</P>
			<P>17:39<BR>
				ѕростой список формируетс€, на изменени€ реагирует, отрисовку во всех видах 
				производит....</P>
			<P>18:20<BR>
				«авис на разборе аннтоаций - а тут и вспомнил, что формируютс€ они у мен€ до 
				сих пор не по-правилам, а по-правилам в них должны быть непечатные и нулевые 
				символы... ј при наличии таковых уже и алгоритмы копировани€ должны быть 
				другими.... ¬ частности, вообще непон€тно - как мне формировать и копировать 
				строку, содержащую нули...</P>
			<P>19:40<BR>
				јга, формирую вроде бы теперь то... Ѕудем учитьс€ разбирать сформированное....</P>
			<P>20:09<BR>
				–азбор при отображении фрейма (в виде) - простой:<BR>
				<FONT color="#000099">&nbsp;&nbsp; char *cp = (char*)pPointer-&gt;pBuf;&nbsp;<BR>
					&nbsp;&nbsp;&nbsp;while (*cp)
					<BR>
					&nbsp;&nbsp; {
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str += cp;
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str += " | ";
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cp += strlen(cp);
					<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cp++;&nbsp;<BR>
					&nbsp;&nbsp;&nbsp;&nbsp;}
					<BR>
					&nbsp;&nbsp;&nbsp; str.Replace("\024"," ");
					<BR>
					&nbsp;&nbsp;&nbsp; str.Replace("\025"," "); </FONT>
			</P>
			<P>ƒл€ разбора списка нужно более сложное: “ипом может быть как&nbsp;второе 
				значение первого пол€ - так и второе значение второго (в первом случае 
				-&nbsp;New/cnt, во втором - тип триггера)</P>
			<P>20:39<BR>
				“аак, что-то такое сгородил.... Ќо куда это годитс€ - просто&nbsp;не знаю... 
				:((( ќднако, работает - и&nbsp;списки &nbsp;формирует... “огда - пусть так оно 
				и будет...
				<BR>
				<BR>
				¬озможно, успею еще и с локами/анлоками разобратьс€....</P>
			<P>21:12<BR>
				 нопка пока без вс€кой картинки, список посылает сообщени€ всем залоченным. „то 
				нужно?<BR>
				- ≈сли текущий вид - снэпшот, и он анлочен - только ему<BR>
				- ѕри смене в текущем залоченном виде - сообщени€ всем</P>
			<P>21:20<BR>
				–азборки в мейнфрейме прописал - а вот с диалогом сложнее: там 
				придетс€&nbsp;завести еще одну, внутреннюю и к тому же промежуточную ф-ию: она 
				должна будет либо вызвать ту самую GoToRec(), которую пользует и мейнфрейм - 
				либо&nbsp;отправл€ть сообщение последнему</P>
			<P>21:33<BR>
				—делал. »знутри диалога проходит, из списка - нет :(((
			</P>
			<P>Ќо разбиратьс€ буду или дома - или завтра. „екин.</P>
			<P>-----------------------------------------------------------------------<BR>
				<STRONG>050702</STRONG> дома 00:49<BR>
				- не назначалс€ m_pCurrView при смене снэпшотов - и не обеспечивлас€ досрочных 
				выход из ф-ии смены записи. »справлено. ѕри этом программа снова перестала 
				закрыватьс€ :((</P>
			<P>13:18 (на работе)<BR>
				ƒа, закрытие снова не проходит - причем на работе не проходит и закрытие файла 
				:((( - и только в том случае, если второй вид находитс€ в окне, а первый - 
				вынесен... ≈сли при этом вынесен третий вид - закрываетс€... ≈сли второй и 
				третий в окне, а первый вне - нет.</P>
			<P>14:00<BR>
				Ќу вот, пока пыталс€ в очередной раз подумать о причинах зависа - они и исчезли 
				:((( ѕричем проверил по коду - код тот самый, совпадающий. ј зависов нет... 
				ѕолучаетс€, что дело все-таки где-то глубоко в потрохах: дедлок между потоками 
				вида и главного окна... Ќо где???? ѕообедал, протестировал еще раз (в том числе 
				и релиз-сборку) - ничего :(((</P>
			<P>14:30<BR>
				јвтоселекци€ текущей записи в списке - пока без переключени€ при переключении 
				видов (и не работает с анлоченным - так как он не посылает соотв. сообщени€)</P>
			<P>14:33<BR>
				≈сли вид ¬—≈√ƒј мен€ет текущую запись не сам, а обраща€сь к главному окну - то 
				все рабоает.</P>
			<P>14:42<BR>
				ѕереключение текущей записи в списке при смене вида.
				<BR>
				Ќужно: при создании нового вида он получает номер текущей линкованной записи. 
				ƒл€ этого разумно в главном окне этот самый номер хранить...</P>
			<P>15:05<BR>
				—делано: вновь создаваемый снэпшот получает номер "линкованного"...</P>
			<P>15:42<BR>
				ѕримитивные картинки дл€ Lock-Unlock</P>
			<P>16:01<BR>
				≈ще раз попыталс€ записать с ActiView - никакой синхронности записи с триггером 
				не наблюдаю. :((( Ѕуду готовитьс€ к записи со своей программой....</P>
			<P>16:33<BR>
				—нова вспоминаю, как же оно там формируетс€....<BR>
				бит 8&nbsp; (256)&nbsp;&nbsp; -257<BR>
				бит 9 (512)&nbsp;&nbsp;&nbsp; -513</P>
			<P>18:13<BR>
				ѕервые тесты записи:<BR>
				- что-то умудр€етс€ писть по финальному брыку<BR>
				- € не пишу реальные номера каналов!!! ¬от мне их и брать неоткуда :(((</P>
			<P>19:00<BR>
				¬ общем, вс€ческих сбоев у мен€ хвататет...<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- что делать, когда никаких номеров 
							каналов и меток нет<BR>
							- где на самом деле хранить номера<BR>
							- что делать с прочитанными метками<BR>
						</FONT></FONT><FONT color="#000099">- не задаетс€ задержка триггера (сейчас 
						поставил 200 мс)</FONT></STRONG></P>
			<P>Ќу а так - вводит... ј € - домой....</P>
			<P>---------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050704 пн<BR>
				</STRONG><EM>¬оскресенье начал с воспоминаний про физиологию (надо же сочинить 
					тезисы в конференции) - ћјћј, регрессии... ¬роде бы все уже делал - но когда, 
					где???? „то-то прикинул - но ничего толком. Ќа огороде обкосил по второму разу 
					смородину, подв€зал ее и полил</EM></P>
			<P>—егодн€ забрал заказанные билеты, к часу пришел на работу - и к трем написал 
				таки тезисы!!! „есть мне и хвала :))))</P>
			<P>18:00<BR>
				—делана защита от достпа последующими экземпл€рами приложени€ хардовой 
				библиотеки - на основе мьютекса. “екс в инфо-панели подправл€етс€ 
				соответственно. Ќо, увы, этот метод не проходит дл€ многопользовательского 
				режима :((((</P>
			<P>18:18<BR>
				ƒл€ обхода этой проблемы им€ создаваемого мьютекса должно начинатьс€ с Global\ 
				- тогда он будет распростран€тьс€ на все сессии....</P>
			<P><EM>//поехал к Ќ—<BR>
				</EM>// ƒома попробовал поразвлекатьс€ с проблемой закрыти€ окон - и ничего 
				путного не выходит :((( Ќо все равно - сравнить нужно....</P>
			<P>---------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050705 вт<BR>
				</STRONG><EM>”тром получил в озоне кукиновские фильтры, через ¬асилеостровскую - 
					цветы дл€ ћаши, ну а там - —‘, ћалинина, ёл€, все вперемешку... ¬ итоге семь 
					вечера - а € даже не проврил, что же собственно "наработал" дома...</EM></P>
			<P>ѕроверил - наработки в основе своей прошли.</P>
			<P>ѕопробовал внести изменени€: вернулс€&nbsp; к старому. ѕри закрытии всех файлов 
				- делать
				<BR>
				PostMessage(WM_DIZ_VIEW_CLOSE) ¬се равно ничего не получаетс€...</P>
			<P>---------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050706 ср<BR>
				</STRONG>ѕричина "не получаетс€" проста - € должен передавать в сообщении не 
				хэндл окна, а адрес класса вида. ѕосле смены заработало - но с тем же 
				результатом (50% незакрытие последнего окна)</P>
			<P>Ќочные размышлени€ и тесты на работе позвол€ют предположить, что дело именно в 
				закрытии последнего окошка: там €вно требуетс€ взаимна€ перерисовка окошка и 
				клиента, а клиентска€ область перерисована быть не может, так как главный поток 
				находитс€ как раз в той самой ф-ии закрыти€ всего... ѕопробовал варинат:
				<BR>
				&nbsp;- в цикле постить сообщение на закрытие всем видам, кроме последнего<BR>
				&nbsp;- пауза (300 мс)<BR>
				&nbsp;- закрытие последнего вида<BR>
				”дивительно, но этот вариант - проходит....</P>
			<P><EM>Ќа этом превал себ€ - поехал в ѕолюс за доверенностью, в переехавший на 
					¬асильевский ”ниверсалприбор - за осциллографом. Ќаконец-то получил....</EM></P>
			<P>ѕо возвращении подергал программу еще - вроде работает... Ќо сил ни на что нет - 
				пойду...</P>
			<P>--------------------------------------------------</P>
			<P><STRONG>050707 чт<BR>
				</STRONG>Ќа программу и не посмотрел: утром забежал в —ивму, увидел искомую 
				головку 329 - но облюбованного штатива 190PROB там не было. “огда заехал в 
				‘отомагию - там не было головки :) Ќо штатив вз€л (3200). Ќа работе на мен€ с 
				разговорами обрушилась —‘ (не даватьс€ ћалининой). ѕопил кофе, зашел в яћ на 
				Ѕольшом ѕетроградской, посмотрел на 410 голову - всего один уровень и 5900 руб 
				:( . ƒошел до ѕетроградской, снова пришел в —ивму, купил головку (3270) и 
				кокиновскую бленду (175). Ќа работе получил зарплату, прин€лс€ разбиратьс€ с 
				головкой - а там одной пружинки не хватает. ’орошо, —орокин под рукой оказалс€. 
				ѕотом Ќ—, запись дисков, потом как-то сразу стало уже поздно, так что чуток 
				полазал в пабмеде и отправилс€ снимать на —реднюю рогатку.</P>
			<P>----------------------------------------------------------</P>
			<P><STRONG>050708 пт<BR>
				</STRONG>ѕоставленный на 5:03 будильник слышал - но не встал. Ќо проснулс€ в 
				5:45!!! ’отел было повернутьс€ на другой бок, но.... Ќо таки подн€лс€, выпил 
				кофе и поехал. ƒовольно долго прождал автобуса, но у пруда был в 6:35 - так что 
				поснимать удалось. ”вы, без записи о фильтрах, так что оп€ть придетс€ 
				гадать.... ƒомой, еще кофе, но на работу - пораньше (а что дома сидеть?).  офе, 
				зеленый чай, ёлин диплом, статьи... ¬ общем, уже первый час и вроде как уже 
				минут 20 как должна была прийти ћалинина - а € снова за программу еще не бралс€ 
				:(((</P>
			<P>TODO<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- отработка запоминани€ и чтени€ имен 
							каналов<BR>
						</FONT></FONT><FONT color="#000099">- заполнение списка и навигаци€ по списку в 
						процессе ввода<BR>
					</FONT><FONT color="#000099">- файловые имена каналов (отображение в карте и 
						графиках)</FONT></STRONG></P>
			<P>1310
				<BR>
				Ќомер канала буду записывать в поле Transducer, как <STRONG>Active Electrode #A32#<BR>
				</STRONG>
			</P>
			<P>1321
				<BR>
				¬ерсию пишу как <STRONG>24BIT BDF+D</STRONG></P>
			<P>1325<BR>
				флаг плюсовости устанавливаю по результату поиска в строке версии подстроки <STRONG>
					BDF+</STRONG></P>
			<P>1546<BR>
				”же после встречи с ћалининой и забега в отдел кадров:<BR>
				- что-то написал - но пока метки нигде не храню и ни на чем не могу проверить 
				правильность считывани€ меток (не номеров) каналов из старых файлов - просто у 
				мен€ здесь таковых нет...</P>
			<P>1808<BR>
				јга, записать - записал (и их файл, и свой). Ќо! »мена-то € пока никуда не 
				читаю - и даже не помню, куда должен читать....</P>
			<P>1817<BR>
				”становил - в формируемый буфер m_pChanNames[8*TOTCHANS] - по 8 байт на 
				канал!!!! “еперь данные ActiView читаютс€, мои метки - почему-то не хот€т :(((</P>
			<P>18:22<BR>
				–азобралс€ и со своими: во-первых "тип" имеет длину 80 символов (а € читал 
				только 16), а во-вторых, метка начинаетс€ с EEG_ - то есть копировать нужно 
				начина€ с 4 символа.</P>
			<P>--------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050709 сб<BR>
				</STRONG>”тром заехал на «вездную, купил жилетку. ƒовольно долго сидел на ‘—.</P>
			<P>1420<BR>
				<STRONG><FONT color="#000099">- ѕри создании нового файла - бредовое количество 
						модулей!<BR>
						- —писок при создании нового файла вообще не создаетс€!</FONT></STRONG></P>
			<P>1424<BR>
				— количством модулей €сно: при инициализации файла сравнивал номер канала по 
				chan &gt; 256, а нужно &gt;=</P>
			<P>1427<BR>
				ƒобавл€ю список. »нфо-панель пока не буду. Ќо список еще не заполн€етс€....</P>
			<P>14:45<BR>
				ѕри получении нового фрейма главному окну посылаетс€ сообщение
				<BR>
				WM_DIZ_SNAPPLOT,(WPARAM)(&amp;m_Pointers[nBuf]),(LPARAM)m_arFChans.GetData()<BR>
				- но такое же сообщение идет и от снэпдиалогов, и от листа... Ќќ!!! LPARAM в 
				этом сообщении никак не используетс€ - поэтому € могу его задействовать под 
				различение "нового фрейма" и переключени€ между существующими.   тому же доп. 
				анализ (необходимость дополнени€) можно сделать по неотрицательному номеру 
				полученного фрейма (чтобы избежать занесени€ в список незаписываемых записей)</P>
			<P>14:49<BR>
				Ќет, даже еще проще: при чтении старых € использую другое сообщение - 
				READFRAME!!! “ак что в LPARAM € как раз могу передавать флаг записываемости 
				(чтобы в главном окне его не вытаскивать)</P>
			<P>14:56<BR>
				— добавлением к списку проходит. Ќо работать это дело пока не работает....</P>
			<P>17:47<BR>
				ѕообедал. ∆арко. — трудом вожусь, отвлека€сь на интернетовские поиски вс€кой 
				чуши....<BR>
				” мен€ почему-то не проходит чтение - получаю ноль прочитанных байт ????</P>
			<P>17:58<BR>
				— не-чтением разобралс€: файл нужно открывать с сочетанием флагов 
				GENERIC_READ|GENERIC_WRITE. Ќо остаетс€ два вопроса:<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- по-видимому, € и после начала записи 
							файла сохран€ю возможность переписать заголовок - из-за этого при вылючении 
							бокса в заголовок пишетс€ не то, что нужно<BR>
						</FONT></FONT><FONT color="#000099">- что-то у мен€ записываемые по триггеру 
						картинки сильно отличаютс€ от "свободных" записей.  ак это???</FONT></STRONG></P>
			<P>18:22<BR>
				ќтменена повторна€ инициализаци€ файла, запись в который уже начата; введена 
				проверка на кол-во каналов; окошко харддиалога после начала записи в файл 
				остаетс€ запрещенным</P>
			<P>18:42<BR>
				ѕроверки на кол-во каналов и частоту при начатом файле. = ќтказ от записи</P>
			<P>ѕочему-то изменение режима перестало отображатьс€ в главной карте :(((</P>
			<P>-----------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050712 вт<BR>
				</STRONG>(в воскресенье вспоминал про virtual-sound программы дл€ гранта 
				ћалининой + огород, понедельник - отмечание яј, так что два дн€ - без подхода к 
				программе....)</P>
			<P>1501<BR>
				¬осстановлено изменение главной карты при изменении режима</P>
			<P>1517<BR>
				‘айл запоминает режим ввода, при изменении режима и непустом файле - 
				предупреждение о невозможности продолжени€ с предложением вернутьс€ на страый 
				режим или закрыть файл.</P>
			<P>1638<BR>
				"ќбщие" параметры программы перенесены из секции Colors в секциб General</P>
			<P>2035<BR>
				¬ыбор и создание каталога и подкаталогов, создание имени файла при его 
				создании.</P>
			<P>---------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050713 ср<BR>
				</STRONG>”тром сходили с мамой на выставку Ўагала. ’орошо.</P>
			<P>1400<BR>
				«апрос на создание несуществующего каталога при создании нового файла.</P>
			<P>1425<BR>
				–азрешение/запрещение контролов в зависимости от флага использовани€ 
				фиксированного фолдера.</P>
			<P>1503<BR>
				ќбслуживание кнопки Browse в установках хранилища данных</P>
			<P>1551<BR>
				ѕосле долгих мучений запретил скрытие пропертей при установленном флаге 
				использовани€ фолдера и пустой строке (нужно пользовать GetResult()). Ќо 
				переходу на другие страницы это не мешает....</P>
			<P>1600<BR>
				“еперь отслеживаю и переходы между страницами плюс запрос на создание каталога 
				при выходе...</P>
			<P>1605<BR>
				«апрет перехода со страницы при невозможности создать указанный каталог</P>
			<P>1956<BR>
				по результатам наблюдений, сделанных в 1625<BR>
				<STRONG><FONT color="#cc0066">-<FONT color="#000099"> в заголовке файла - нули про частоту 
							и длительность<BR>
						</FONT></FONT><FONT color="#000099">- с триггерными реализа€ми сильное не то</FONT></STRONG></P>
			<P>2052<BR>
				— нулевой длительность пон€тно: sprintf(,,,"%8.8d") давал строчку из 8 символов 
				- и нулевой в конце, а у мен€ всего 8. «амена на 7 помогла...</P>
			<P>2104<BR>
				Ќеполадки с перекосом тригканала были вызваны не тем кол-вом каналов в цикле - 
				нужно <STRONG>m_nRecordedChans</STRONG> !!!<BR>
				<STRONG><FONT color="#000099">—нова не€сности с включением паузы в тригрежиме при 
						повторном запуске.<BR>
					</FONT><FONT color="#000099">Ќе записываетс€ StartTime</FONT></STRONG></P>
			<P>2118<BR>
				ѕишу StartTime. “олько все эти пол€ у мен€ пока никак не отзваниваютс€....</P>
			<P>2121<BR>
				— паузой тоже пон€тно - € не снимал флаг m_bNeedPause/<BR>
				<STRONG><FONT color="#000099">ј вот "пустные данные" в снэпшоте у мен€ все одно 
						пытаютс€ отрисоватьс€ :((((<BR>
					</FONT><FONT color="#000099">» свежий фрейм передаетс€ и анлочным снэпам - хот€ 
						навигаци€ худо-бедно есть<BR>
						Ќомер нового фрейма в списке и снэпдиалоге не отзваниваетс€....</FONT></STRONG></P>
			<P>2136<BR>
				¬несение в список свежих фреймов и навигаци€ работают как задумано<BR>
				<STRONG><FONT color="#000099">“ипы записпей не отзваниваютс€!!!!</FONT></STRONG></P>
			<P>поливать цветы -и домой.....</P>
			<P>--------------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050714 чт<BR>
				</STRONG>—нова жара.  упил вентил€тор...</P>
			<P>1404<BR>
				¬несение времени и типа новой записи в список - дл€ этого модифицирована 
				извлекающа€ ф-и€ в файле: теперь таковых две, перва€ принимает номер записи, 
				втора€ - уже готовый буфер. ѕерва€ вызывает вторую.</P>
			<P>1430-1750<BR>
				ќбнаружил солидные утечки пам€ти при закрытии программы. ¬ычислил источник: при 
				закрытии вызываетс€ RemoveAllViews(), котора€ работает через PostMessage - а до 
				обработки этих посланий дело уже не доходит :((( ќстановилс€ на попытке 
				перепостить то же сообщение - но все-равно что-то течет. » мои мозги текут тоже 
				- температура в комнате уже под 30 подбираетс€ :(((</P>
			<P>1752<BR>
				≈сли просто наоткрывать разных видов - утечек нет. ≈сли еще и ввод запустить (и 
				ввести) - утекает 37056 байт. ≈сли ничего не записывать - столько же. » если 
				создать файл и записать в него - тоже столько же!!!!</P>
			<P>1802<BR>
				ќдин источник утечек обнаружен - не уничтожалс€ CSnapView::m_pReadBuf24 при 
				повторной инициализации вида. ѕосле исправлени€ нет утечек и в случае 
				нормальной записи в файл.</P>
			<P>1923<BR>
				—делал обработку запрета записи - но с большими "не вдруг" - вплоть до полных 
				зависов (не ту переменную в кач-ве номера буфера брал). Ќо в итоге все равно 
				непон€тно: при запрете записи и при переходе по команде в виде нормально 
				отображаетс€ статус записанной реализации, а при отображении новой триггерной 
				вс€ информаци€ о триггере тер€тес€ (но - только если пишем). Ќе понимаю... » 
				вр€д ли пойму при актульных +30. “ак что закрываюсь - и домой. “о есть на 
				огород - поливать...</P>
			<P>--------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050715 пт</STRONG></P>
			<P>1226<BR>
				ѕроверил - и в самом деле получаетс€, что при отрисовке нового фрейма € не 
				получаю сточку с описанием триггера и проч....<BR>
			</P>
			<P>1248<BR>
				ѕолучаетс€, что у мен€ при первом входе (нова€ реализаци€) в конце каждого тага 
				стоит два нул€, а при втором - то, что нужно....</P>
			<P>1258<BR>
				Ёто у мен€ ф-и€ CDataFile::GetRecTypeAndTime(char* pStr, char* pType, char* 
				pTime) занималась модификацией аннотаций (мен€ла служебные символы на нули). 
				«аставил ее делать то же самое с копией - тогда вроде бы все получаетс€. Ќо!!! 
				” мен€ каким-то образом в триггере проскакивает €вно не-триггерное значение 
				oxFFFF - а такого вроде бы совсем не может быть ????</P>
			<P>1304<BR>
				“оже пон€тно - € сначала брал точку, а потом делал Reverse(1) - а нужно 
				наоборот: сначала на точку откатитьс€, а потом уже ее брать (в противном случае 
				€ беру не первую точку триггера - тут-то и возможна промашка).</P>
			<P>1407<BR>
				¬вел управление плюсовостью формата. ѕытаюсь заставить фирменный ридер читать 
				мои файлы. ќказалось - не пишу -1 в начале: пришлось насильно. ƒалее: фирменный 
				ридер хочет, чтобы триггер шел в конце :(((( ј как мне это сделать????</P>
			<P>1510<BR>
				¬роде бы добилс€ записи триггера в конец и чтени€ "не-плюсовых" файлов 
				фирменным ридером. Ќо!!! “олько при длительности 1 секунда!!!<BR>
				<FONT color="#cc0066"><STRONG><FONT color="#000099">- запретить изменение формата при 
							открытом файле<BR>
						</FONT><FONT color="#000099">- почему не работают системные клавиши в проперт€х????</FONT></STRONG></FONT></P>
			<P>1637<BR>
				Ѕорьба с переходом по табам оказалась суровой - она изначально не работает в 
				немодальных диалогах!!! ќбойти же ее через PreTranslateMessage() - не вдруг.... 
				“о есть в итоге обошел - но оказалось, что все перехватываетс€ уже первой 
				страницей, а не активной....</P>
			<P>1646<BR>
				 ак-то избавилс€, производ€ регистрацию (и отмену оной) при 
				активации/деактивации страницы. Ќо это, конечно же, полный бред - на самом деле 
				мне нужно не писать всю эту ернунду в каждом классе, а заводить свой класс 
				страницы (да и немодального диалога вообще)<BR>
				<STRONG><FONT color="#000099">  тому же у мен€ теперь окошко триггера показываетс€ 
						как-то неправильно....</FONT></STRONG></P>
			<P>1721<BR>
				 ак вы€снилось, на показ триггера фатально сказываетс€ разрешение первой кнопке 
				режима флага TABSTOP - она начинает непрерывно нажиматьс€ :((((</P>
			<P>1823<BR>
				«апрещение полей "плюсововсть" и "длина записи" при непустом новом файле - 
				реализовано через _Settings.m_nFileMode, который при первой записи становитс€ 
				равен трем.</P>
			<P><STRONG><FONT color="#000099">ќп€ть большие проблемы с закрытием программы :((((<BR>
						Ѕолее того, при попытке пуска —–ј«” после включени€ питани€ - тоже уходим в 
						завис :(((</FONT></STRONG></P>
			<P>2144<BR>
				Ќа этот раз мне показалось (и были к тому основани€), что один из корней 
				проблемы - в сложност€х активации видов и диалогов: уж больно долго 
				перемигвались два окошка, возинкающих при запуске программы на пустом месте... 
				» в самом деле: активаци€ вида приводит к активации диалога, и диалога - 
				вида....<BR>
				»збавилс€ от этого введением переменной CActiView::m_bHere - она 
				устанавливаетс€ внутри ф-ии OnSetActive (вызываемой при активации из диалога) - 
				и не дает выполн€тс€ обработчику OnActivate. ѕри этом исчезли перемигивани€ - и 
				вроде бы даже проблемы с закрытием программы (там €вно были какие-то зав€зки на 
				то же самое)</P>
			<P>≈ще парочка проблем обнаружилась на запуске: если попытатьс€ запустить программу 
				тут же после разрешени€ кнопки - она висла... ¬идимо, из-за того, что 
				разрешение (по флагу режима) давалось ранее, чем происходили все прочие 
				обраотки... »збавилс€, завед€ флаг CMainFrame::m_bReady - он устанавливаетс€ в 
				самом конце таймерного обработчка и сбрасываетс€ в нем же по любым исключени€м, 
				в том числе - и по смене режима. “аким образом, вроде решил и эту задачку.</P>
			<P>—хожий вопрос: при таком запуске (и с одновременным созданием двух новых окон) у 
				мен€ начиналс€ рваный вывод на осцилл. ѕодумал - это из-за пор€дка создани€, и 
				переместил создание новго осцилла ближе к концу. “ак вроде бы рвани не 
				возникает...</P>
			<P>ƒл€ ёли снова времени не оказалось - поставил туда ƒжину и обнаружил, что у мен€ 
				снова на трое ушей - всего один переходник :((( ј ведь были же!!! Ќаписал эти 
				слова - и нашел: у себ€ в красном конце-переходнике :))) ќдной проблемкой 
				меньше :))))
			</P>
			<P>2153 - поливать цветы и к дому....</P>
			<P>-------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050716 сб<BR>
				</STRONG>я хочу:<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- добависть к cnt-реализаци€м врем€ 
							начала реалзицаии относительно New<BR>
						</FONT><FONT color="#000099">- ќбрабатывать разрешение записи при текущем вводе как 
							переход на New (чтобы не получать cnt с разрывами)<BR>
						</FONT></FONT><FONT color="#000099">- рисовать метки времени на SnapShot</FONT></STRONG></P>
			<P>1250<BR>
				¬ файле заведен флаг m_bSkipped, который позвол€ет переводить cnt записи в New</P>
			<P>1300<BR>
				≈ще одна переменна€ - CDataFile::m_flNewTime - врем€ начала непрерывной записи, 
				дл€ возможности пометки относительного времени в непрерывной.</P>
			<P>1310<BR>
				–азмышлени€ на тему временных меток в снэпшотах:<BR>
				- New - начинаем с нул€<BR>
				- cnt - целые секунды "базового" времени<BR>
				- Tr - за ноль принимаетс€ врем€ триггера</P>
			<P>1330<BR>
				¬се бы ничего, но по-хорошему&nbsp;мне дл€ расстановки временных меток нужно бы 
				знать длину окна в мс - а она нигде не формируетс€... Ќужно посмотреть, где это 
				можно сделать...</P>
			<P>1450<BR>
				“ака€ переменна€ есть!!! “олько дл€ COscView она - в секундах, а здесь сразу 
				будет в миллисекундах....</P>
			<P>1500<BR>
				Ќулевую линию нарисовал. “еперь нужно бы остальные - и еще бы врем€чко....</P>
			<P>1531<BR>
				ѕообедал. ¬роде бы рисую все возможные метки. ¬опрос с отображением чисел....</P>
			<P>1647<BR>
				Ќемножечко косовато, но сделал: в начале всегда рисутес€ лини€ и обозначаетс€ 
				базовое врем€ с двум€ знаками после зап€той, далее - линии через 1 с....</P>
			<P>1729<BR>
				  триггерной панели добавлена установка "мертвого времени" триггера (Idle Time) 
				- с сохранением в соотв. структуре. ќдновременно к диалогу добавлена обработка 
				клавиши ¬¬ќƒ, чуточку усовершенствована логика обрабочтиков (бќльша€ часть 
				работы перенесена в EditUpdate). √лавна€ ф-и€ не хранит врем€ в себе, берет из 
				установок. ѕроверил - работает.</P>
			<P>1736<BR>
				ѕри вызове пропертей главной окно запрещаетс€, при их закрытии - разрешаетс€.</P>
			<P>--------------------------- сохранение и чекин ----------------------</P>
			<P>1746<BR>
				¬озвращаюсь к диалогу формировани€ заголовка файла. ’очу:<BR>
				<FONT color="#cc0066"><STRONG><FONT color="#000099">- заменить дейт-тайм пикер на отдельные 
							контролы с возможностью установки нулей ("не задано")<BR>
							- в комбобоксах провер€ть введенную строку на совпадение с уже существующими, 
							при совпадении новые не формировать<BR>
						</FONT><FONT color="#000099">- сохран€ть все накопленные в комбобоксах значени€<BR>
							- при выборе испытуемого из существующих подставл€ть его данные</FONT></STRONG></FONT></P>
			<P>1829<BR>
				–еализован свободный выбор даты</P>
			<P>1849<BR>
				— кодами пациентов тоже потихоньку разбираюсь - сделал код нечувствительным к 
				регистру (и поиск по началу) - но проблемы еще ожидают... ѕоливать цветы - и 
				бежать!!!</P>
			<P>--------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050718 пн<BR>
				</STRONG>1354<BR>
				¬чера (в воскресенье) дома чуток повозилс€ с возможной сортировкой 
				комбо-боксов. ≈сть два варианта: либо переписывать сортировочную ф-ию, либо 
				вручную переставл€ть строчки. ѕерый способ вроде и более хорош - но:<BR>
				- требует создани€ своего класса<BR>
				- этот класс будет сильно прив€зан к данным как таковым</P>
			<P>¬ то же врем€ если просто переставл€ть строчки - то каждый раз будут 
				переписыватьс€ все пол€ в ини-файле (и испытуемые получат другие номера). ћожет 
				быть это и не страшно - но каким образом € буду выбирать "прочие данные" 
				испытуемых при выборе уже существующего???</P>
			<P>јльтернативный подход: каждый испытуемый - структура, в к-й помимо информативных 
				полей есть и "номер" - место в списке. Ќо тогда при каждой смене текущего 
				испытуемого должны измен€тьс€ и номера у всех остальных....&nbsp; “ак...  акие 
				еще есть варианты????</P>
			<P>2020<BR>
				ƒень прошел - а не то что ничего не написал - но ничего и не придумал: жарко и 
				душно, никаких мыслей и в помине нет :(((</P>
			<P>---------------------------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050719 вт<BR>
				</STRONG>¬ общем, единственное что надумал:<BR>
				- испытыуемые хран€тс€ по номеру (в пор€дке добавлени€)<BR>
				- в списке data - номер испытуемого<BR>
				- при переносе испытуемого наверх нужно перенести и его номер<BR>
				- отдельно хранитс€ список "очередности" - и при считывании конфигурации 
				испытуемые помещаютс€ в комбобокс согласно ему<BR>
				- то же самое и дл€ остальных комбобоксов</P>
			<P>1626<BR>
				¬опрос еще и в том, что € на самом деле не хочу лишний раз переписывать в 
				ини-файле оставшихс€ неизменными испытуемых. ј дл€ этого € должен держать на 
				них флаги - изменилс€ или нет.... ѕричем массив должен быть динамическим....</P>
			<P>1750<BR>
				¬ообще-то нет. ќдним из возможных вариантов использовани€ может быть занесение 
				нескольких испытуемых за один заход - тогда и апдейт будет делатьс€ 
				инидивидуально, то есть достаточно одного флага.</P>
			<P>1924<BR>
				—делана смена параметров испытуемого при выборе другого - пока только при 
				смене.... ќсталось - такую же смену при выходе (то есть вынесение в отд. фию) и 
				запоминание пор€дка (чтение вроде как уже есть).</P>
			<P>2111<BR>
				Ќет, все же какие-то расстыковки продолжаютс€.... Ќужно попробовать полить 
				цветы и дойти до дому - может легче станет???</P>
			<P>0047<BR>
				» в самом деле, дома удалось довести до ума (к тому же и кол-во реков за 
				"июльское утро" достигло 45 - положительна€ эмоци€!!!) сохранение, 
				восстановление и добавление испытуемых. ƒолго не мог справитьс€ с 
				восстановлением правильных ItemData - но таки сообразил: нужно было сн€ть флаг 
				сортировки!!!</P>
			<P><STRONG><FONT color="#000099">“еперь нужно обобщить поведение этого комбобокса (но без 
						излишеств "доп. полей") на остальные - тип эксперимента, экспериментататора, 
						оборудование....</FONT></STRONG></P>
			<P>------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050721 чт<BR>
				</STRONG>¬чера на работу не пошел - весь день пробродил по лесам, настрел€л 
				почти гиг птах. “ак что и сегодн€, прид€ на работу, два часа их распихивал по 
				местам... Ќо - к делу</P>
			<P>1340<BR>
				 акого поведени€ € хочу от "прочих комбобоксов"?<BR>
				- ввод нового значени€ по Enter и KillFocus<BR>
				- помещение выбранного значени€ на нулевую строку<BR>
				- запоминание пор€дка (MRU-style)<BR>
				¬ какой момент должна производитьс€ модификаци€ ини-файла?<BR>
				- ƒобавление нового значени€ (с увеличением счетчика) - при записи нового 
				значени€<BR>
				- «апись пор€дка - при выходе из диалога</P>
			<P>¬озможен и другой вариант: при добавлении "по ходу" измен€ютс€ внутренние списки 
				строк. ѕри правильном выходе из диалога производитс€ запись добавленных строк. 
				Ётот вариант потребует<BR>
				- списка на каждый комбобокс<BR>
				- количества исходных значений<BR>
				(результирующее кол-во можно опустить - его можно брать из основного списка)</P>
			<P>¬роде бы второй варинат выгл€дит лучше - но с ним будут несклады при добавлении 
				в будущем&nbsp; (и, веро€тно, скором) кнопок, позвол€ющих удалить каждое 
				значение. “аковое удаление проще производить пр€мо в ини-файле....</P>
			<P>1534<BR>
				ѕрописана обща€ ф-и€ заглатывани€ списков (если длина списка не совпадает - 
				заполн€етс€ номерами). ѕрописаны фрагменты чтени€ списков (типов эксперимента, 
				исследовател€ и оборудовани€) из ини-файла. «апись не прописана.</P>
			<P>1545<BR>
				ƒобавление новых строк проходит. »зменение сортировки при выбре существующих - 
				нет :(</P>
			<P>1623<BR>
				я просто не подключил мессаджи по KillFocus. ѕосле доавлений в карту 
				перестановка работает - но только при смене фокуса. “еперь нужно переставл€ть 
				собственно при выборе....</P>
			<P>1801 (после перерыва на редактирование очередной фотографии дл€ ‘—)<BR>
				в карте последовательность из 4 входов<BR>
				//COMMAND_HANDLER(IDC_PATCODE, CBN_KILLFOCUS, OnCbnKillfocus)
				<BR>
				//COMMAND_HANDLER(IDC_INVCODE, CBN_KILLFOCUS, OnCbnKillfocus)
				<BR>
				//COMMAND_HANDLER(IDC_RESEARCHER, CBN_KILLFOCUS, OnCbnKillfocus)
				<BR>
				//COMMAND_HANDLER(IDC_EQUIPMENT, CBN_KILLFOCUS, OnCbnKillfocus)
				<BR>
				заменена на единственное вхождение<BR>
				//COMMAND_CODE_HANDLER(CBN_KILLFOCUS, OnCbnKillfocus)
				<BR>
				- и все работает!!!</P>
			<P>1815<BR>
				ѕопытка обойтись таким же образом с SelEndOk (спецкод дл€ пациента, вызов 
				ComboString дл€ остальных) успехом не увенчалась: ComboString берет текущую 
				строку, а она еще не установлена.....</P>
			<P>1821<BR>
				¬ ComboString() введен доп. параметр, позвол€ющий брать либо текущую строку (по 
				умолчанию), либо свежевыбранную строку (при доп. параметре bSelected = true). 
				“ак работает. ќсталось все это дело сохран€ть при выходе....</P>
			<P>1838<BR>
				ѕрописалось - но не прочиталось. я просто не пишу кол-во ("NumberOf") и 
				пор€док.</P>
			<P>1845<BR>
				ѕор€док обхода диалога. —н€тие сортировки</P>
			<P>1946<BR>
				ќбща€ дл€ всех комбобоксов ф-и€ сохранени€ пор€дка. ѕо всей видимости - 
				работает... ћожно успокоитьс€ :)))<BR>
				Ќужно сделать отображение этих полей в инфо-панели.</P>
			<P>2007<BR>
				—делал примитивное отображение полей. ƒальше нужно будет их "разбросать" в 
				соотвествии со спецификацией.</P>
			<P>----------------------------- сохранение. чекин 
				------------------------------------------------</P>
			<P>2035<BR>
				«аписал некое подобие тестового файла. «амечено: не слишком-то релевантные 
				изменени€ в тригканале привод€т к сбросу режимов "пауза" и "принудительна€ 
				запись".... Ќужно будет посмотреть!!!</P>
			<P>-----------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050722 пт</STRONG></P>
			<P>—нова какой-то в€лый день. ¬ыставил на ‘— второю фотографию с рогатки...</P>
			<P>ƒорабатоал заголовочный диалог: проверка всех полей на валидность символов, 
				недопущение пустых строк. ѕроверил поведение триггеров: единственное, что мен€ 
				может не устраивать - в тригрежиме принудительна€ запись при поступлении 
				триггера сбрасываетс€ даже в режиме "пауза".</P>
			<P>----------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050725 пн</STRONG></P>
			<P>¬ыходные провел дома (Ћента, птички, огород)....  акие-то размышлени€ были - и 
				даже в EEGLAB загл€нул. —формулированы основные вопросы-пожелани€:<BR>
				<STRONG><FONT color="#cc0066"><FONT color="#000099">- поведение ручных кнопок и хардовых 
							триггеров - логика обработки<BR>
						</FONT><FONT color="#000099">- «апуск с созданием двух окошек: почему приводит к 
							дергающемус€ отображению<BR>
						</FONT></FONT><FONT color="#000099">- матлаб-экспорт</FONT></STRONG></P>
			<P>1211 - поехали...</P>
			<P>1331<BR>
				— дрыганьем при старте разобралс€ кардинально: не обрабатываю первую получку 
				после перезапуска системы (ту, в которой 64 точки). ¬роде бы помогает... <FONT color="#000099">
					<STRONG>Ќо!!! —нова престал закрыватьс€ снэпшот (полученный без файла)....</STRONG></FONT></P>
			<P>1904<BR>
				» снова весь день прошел в поисках решени€ проблемы незакрывающихс€ окошек - то 
				есть не-окончани€ граф. потока. » это уже который день!!! √осподи, как мне эта 
				проблема надоела!!!!!<BR>
				ѕереносил вызов установки родител€ в поток (в вид) - стало еще хуже. ѕон€тно: в 
				моих интересах, чтобы как раз это место было отработано в основном потоке... 
				«аметил, что зависа нет, если окошко (внешнее) сначала активировать, попробовал 
				встроить ф-ию активации - снова плохо: не отрабатывает. » никакие задержки не 
				помогают :((( ¬ общем, часов до шести - и без малейших подвижек: если не 
				зависает с внешними - виснет при закрытии дочерних. »ли наоборот, причем сейчас 
				уже точно и сказать не могу, когда что мешает.</P>
			<P>Ќе выдержал - вернулс€ к идее принудительной терминации потока. ќна-то проходит 
				- но в пам€ти остаетс€ мусор. Ќемного - 4 байта (то есть одно какое-то 
				значение) - но кто знает, в какой момент этот мусор может стать фатальным :(((</P>
			<P>–азмышлени€ показали: эти 4 байта - переменна€ CMessageLoop theLoop. ќна же 
				объ€влена локальной в ф-ии Run, а при принудительном завершении выхода из этой 
				ф-ии не происходит!!! —делал ее переменной класса - и все работает!!! ѕравда, 
				теперь пришлось отменить регистрацию цикла в модуле (удал€ть цикл в деструкторе 
				€ не могу: такое удаление производитс€ по идентификатору текущего потока, а 
				деструктор работает в главном потоке). ¬роде бы работает.... » мусора не 
				остаетс€...</P>
			<P><STRONG><FONT color="#000099">ѕосле отказа от ввода первых 64 значений € получаю 
						разнообразный мусор (то есть куда-то они все-таки ввод€тс€) - в том числе и на 
						тригканале: это приводит к паразитному вводу реализации.</FONT></STRONG></P>
			<P>2045<BR>
				ќтказалс€ от предыдущей задумки (с выбрасыванием первых значений). ¬ернулс€ к 
				перезапуску таймера. ј там вернулась и мысль о возможности его переустановки - 
				сначала забазировалс€ на переменную в _Settings, потом ввел ее во вторую панель 
				установок (в пределах 50-500 мс).  ак ни странно, все работает. » даже без 
				дерганий (во всем диапазоне изменений). Ќу и беспоко€щие дергани€ тоже ушли....</P>
			<P><STRONG><FONT color="#000099">Ќо!!! “еперь у мен€ снэпшоты при открытии сразу что-то 
						отрисовывают... ќткуда бы???</FONT></STRONG></P>
			<P>2123<BR>
				ƒоработана логика кнопок и гейтов:<BR>
				- кнопки на тулбаре показывают не только текущее, но и желаемое состо€ние 
				(чтобы не вводить пользовател€ в заблуждение) - то есть если пауза еще не 
				установлена, но попросили - показываем паузу, если находимс€ в режиме паузы но 
				попросили ее закончить- показываем что нет, и с WrManual также<BR>
				- устранено выклчюение мануального ввода в тригрежиме при паузе</P>
			<P> аким-то образром это решило и проблему с отрисовкой новых снэпшотов???? Ќет - 
				только в дебаг-версии. ¬ релизе - чтой-то рисуем.... <STRONG><FONT color="#000099">Ќайти 
						неинициализированную переменную!!!!</FONT></STRONG></P>
			<P>2200<BR>
				Ќашел - ошибка в SnapInit: € не учел, что снэпшот может создаватьс€ без файла - 
				и рисовал, даже если файле не было...
			</P>
			<P>------------------------------------------- ”фф.. 
				---------------------------------------</P>
			<P><STRONG>050726 вт<BR>
				</STRONG>”тром пробежалс€ по магазинам - загл€нул в ѕетра ¬еликого (пустота), в 
				ƒоме  ниги купил маме две книжки јйрис ћердок.</P>
			<P>ќсновное туду на сегодн€ - матлаб-экспорт. ¬опросы:<BR>
				<FONT color="#cc0066"><FONT color="#000099">- услови€ разрешени€ кнопки (наличие 
						непустого файла)<BR>
					</FONT><FONT color="#000099">- отдельный каталог (отдельна€ переменнна€ в 
						установках, пока - без специального режима установки: просто запоминаем)<BR>
					</FONT><FONT color="#000099">- экспортируем всЄ, тригканал - отдельно, аннотации - 
						отдельно (как текствую переменную)<BR>
					</FONT></FONT><FONT color="#000099">- масшабирование при записи (с вопросом дл€ 
					тригканала)<BR>
				</FONT><FONT color="#000099">- ориентаци€ массива (хотелось бы сделать так, чтобы 
					не накапливать весь в пам€ти - слишком много может получитьс€. “огда нужно 
					смотреть - как его располагать, чтобы можно было писать по реализаци€м)</FONT></P>
			<P>1335<BR>
				ћатлаб-кнопка и логика ее включени€</P>
			<P>1501<BR>
				ƒл€ запоминани€ каталога пришлось создать свой класс: из фирменного каталога не 
				получить, так как он выдаетс€ лишь посылкой сообщени€ окну, а после закрыти€ 
				диалога окна уже нет :((((</P>
			<P>1509<BR>
				‘айл создаетс€. ќсталось немного - записать в него :))))</P>
			<P>1648<BR>
				ѕишу основные переменные и имена каналов.</P>
			<P>1745<BR>
				ѕишу аннотации (и письмо)</P>
			<P>1807<BR>
				ѕишу тригканал. ‘ормат в EEGLAB&nbsp;<BR>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
				Channels * Time * Records<BR>
				отбросив каналы (если пишем их отдельно), получаем<BR>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Time*Records<BR>
				- вот и триггер пишу в таком формате.....</P>
			<P>Ќу а как быть с самими данными??? «аводить и заполн€ть буфер на всЄ сразу... 
				ћ€гко говор€, опасно (может получитьс€ сильно много-гиговым). ѕопробую-ка 
				писать по отдельным запис€м (порожда€ кучу переменных - и массив с их именами)</P>
			<P>≈сли писать по запис€м, формат должен быть<BR>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Channels*Time</P>
			<P>1847<BR>
				”гу, пишу по запис€м.  ороткий скрипт собирает их воедино:<BR>
				<FONT color="#000099"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for r = 
						1:NumberOfRecords,
						<BR>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A(:,:,r) = 
						eval(RecNames(r,:));
						<BR>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end</STRONG></FONT></P>
			<P>ќсталось сделать масшатбы..... » собственно перевод аннотаций в типы реализаций.</P>
			<P><BR>
				&nbsp;2126<BR>
				Ќа делании масштабов подзавис: обнаружил, что EEGLAB их не читает :((( ¬ы€снил: 
				он их берет как строку, а у мен€ она заполнена нул€ми (в ActiView - проблеами) 
				- вот и результат... ѕринудительно добавил нулей - вроде бы помогает....</P>
			<P>Ќа самом деле масштабы нужно читать при открытии файла (а не при экспорте) - и 
				насчитанные значени€ использовать!!!
			</P>
			<P>Ќо все это - уже не сегодн€....</P>
			<P>----------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>040728 чт<BR>
				</STRONG>—реда прошла в поездке на  азанское кладбище - годовщина д. “оли... 
				–азобралс€ с расчетом поправочных коэффициентов. Ќо!!! ” мен€ в насто€щий 
				момент все эти коэффициенты нигде и никак не учитываютс€... » еще нужно 
				подправить ф-ии заполнени€ полей заголовка - чтобы остатки полей заполн€лись 
				пробелами, а не нул€ми....</P>
			<P>1220<BR>
				ћодифицированна€ ф-и€ strncpySP - с добиванием остатков пробелами. Ќо!!! ќна не 
				работает с основным заголовком....</P>
			<P>1300<BR>
				»так, определенные вчера уравнени€ выгл€д€т так:<BR>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cal = (PhMax - PhMin) / 
				(DgMax - DgMin)<BR>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Off = PhMin - DgMin*Cal<BR>
				ƒл€ совместимости неплохо было бы привести считанные из файла коэффициенты к 
				"оригинальным". ѕоследний ("оригинальный") составл€ет 
				(262143+262144)/(8388607+8388608) = 1/32. “о есть считав коффициенты, € должен 
				их умножить на 32.... “ак. Ќу а что в таком случае со смещением????</P>
			<P>≈сли подумать (ну или попытатьс€...), то получаетс€, что у мен€ дефолтова€ 
				‘»«»„≈— јя ≈ƒ»Ќ»÷ј равна 1/32 мкв. “о есть мне достаточно ѕќ—Ћ≈ вычислени€ и 
				то, и другое (коэфф и смещение) умножить на 32</P>
			<P>Ќе забыть учесть единицу измерени€ - и в случае ЋёЅќ√ќ отката ставить дефолтовые 
				коэффициенты. ѕоэтому лучше - в отдельной ф-ии...<BR>
				1328 - пошел на Ѕотанику, к –остовой....</P>
			<P>1650<BR>
				—ходил к –остовой, поговорил с Ўестопаловой.<BR>
				–асчет делаетс€ - только пока без учета единиц измерени€.</P>
			<P>1819<BR>
				–асчет коэффициентов долго сбоил - пока не сделал внутренние переменные 
				статическими... Ѕред.... ј может и нет....</P>
			<P>1927<BR>
				¬идоизменил запись: тригслово пишу и дл€ New и cnt - но похоже, что пишу не 
				всегда то :(((</P>
			<P>1956<BR>
				¬о избежание пишу всегда то самое слово, которое вызвало "срабатываение" 
				триггера (дл€ этого модифицирована и ф-и€ WritePre) - тогда вроде как пишетс€ 
				то.... ¬ылеты при попытке экспорта свежезаписанных данных!!!!</P>
			<P>2000<BR>
				”становлена причина вылета: m_PntRead.pBuf неинициализирован....</P>
			<P>2010<BR>
				¬ этом случае (при экспорте свежезаписанных) создаем новый временный буфер, и 
				указатель приравниваем к нему. ѕотом не забываем буфер уничтожить, а указатель 
				- обнулить...</P>
			<P>2027<BR>
				‘-и€ экспорта сама формирует командную строку дл€ объединени€ данных - и диалог 
				с объ€снением.</P>
			<P>050729<BR>
				1318<BR>
				ƒобавлена облигатна€ запись тригслова и его вывод в списке</P>
			<P>1417<BR>
				‘-и€ чтени€ типов сама расчитывает "базовое врем€".</P>
			<P>1439<BR>
				Ёкспорт латентностей, типов и тригслов</P>
			<P>1508<BR>
				Ёкспорт индивидуальных временных осей</P>
			<P>1527<BR>
				ѕроста€ ось замещаетс€ первой встреченной триггерной.<BR>
				<STRONG><FONT color="#000099">«агрузить EEGLAB и посмотреть, какие еще нужны 
						переменные.....</FONT></STRONG></P>
			<P>1536<BR>
				ѕишем частоты дискретизации</P>
			<P>1555<BR>
				ѕри приходе буфера удал€ю все недописанные буфера свободных реализаций<BR>
				<STRONG><FONT color="#000099">- ѕишетс€ не то врем€ дл€ свободных<BR>
						- ¬ свежезаписанном - что-то не то с отображением в списке тригреализаций</FONT></STRONG></P>
			<P>1705<BR>
				ќшибки были вызваны неаккуратным обращением с вновь введенным полем в 
				m_Pointers: € в нескольких местах использовал не тот индекс - вот и писал 
				непон€тно куда :((((</P>
			<P>1715<BR>
				“ригслово при записи новой реализации<BR>
				” мен€ при NEW пишетс€ не то слово!!!!</P>
			<P>1727<BR>
				ƒа нет, в файле - то слово! Ёто читаю € его неверно....
			</P>
			<P>1730<BR>
				ƒело было в лишних пробелах, которые € не пропускал...<BR>
				<STRONG><FONT color="#000099">ѕеренести конфиги!!!</FONT></STRONG></P>
			<P>1800<BR>
				ќказалось, нужно не только перенести - но и подправить работу: у мен€ не 
				срабатывал выход с некоторых страниц....</P>
			<P>1830<BR>
				<STRONG><FONT color="#cc0066">- <FONT color="#000099">“еперь не отображаетс€ триггерных код<BR>
						</FONT></FONT><FONT color="#000099">- ѕодрпавить значени€ фильтров!!!</FONT></STRONG></P>
			<P>1852<BR>
				ѕодправлено чтение тригслова дл€ тригреализаций<BR>
				<FONT color="#000099"><FONT color="#cc0066"><STRONG></FONT><FONT color="#000099">ќтображать 
						им€ файла в заголовке главного окна и всех дочерних!!!!</FONT></STRONG></FONT>
			</P>
			<P>1900<BR>
				"правильные" значени€ фильтров</P>
			<P>1915<BR>
				»м€ файла в заголовке главного окна и снэпшотов (дл€ осциллов не стал - там 
				может быть и без, и непон€тно как переименовывать...)</P>
			<P>2000<BR>
				ќбнаружены вылеты:<BR>
				<STRONG><FONT style="BACKGROUND-COLOR: #99ff99" color="#cc0066">- при записи файла - 
						при поптыке создани€ нового снэпшота "на лету"<BR>
						<FONT color="#000099">- при закрытии осцилла на лету</FONT></FONT></STRONG></P>
			<P>2015<BR>
				¬ылет при закрытии осцилла на лету: недобиваю таймер. –ешение - принудительное 
				убиение (с введением пустой виртуальной ф-ии в родителе)</P>
			<P>2020<BR>
				¬ылеты при создании снэпа на лету - попытка перерисовать еще не существующее 
				окно (соотв. иф был - просто его раскомментировал) - и какие-то непон€тнки, 
				свойственные только плюс-формату....</P>
			<P>2035<BR>
				¬ылеты при создании снэпшота вылечились объ€влением промежуточных текстовых 
				буферов статическми....</P>
			<P>2102<BR>
				Ќеполадки с активацией диалогов.</P>
			<P>2115<BR>
				ѕришлось вернуть обращение к главной ф-ии OnActivate из SetAvtive</P>
			<P>2120<BR>
				Ќеполдки с перь€ми - убрал penOld из CSnapShot::PolyLine.</P>
			<P>2125<BR>
				Ѕольше не могу... „то есть - то и посылаю....</P>
			<P>----------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050731вс - дома<BR>
				</STRONG>–азумеетс€, € был неправ. Ќужно было еще подумать, выдержать, 
				доработать - и программу, и документ. Ќо не было сил - и слишком сильна 
				уверенность (да, уже она), что никому это самое письмо и прочие мои старани€ не 
				нужны, неинтересны... Ќо тем не менее, продолжать придетс€ - чтобы потом 
				породить из всего этого какой-никакой, но документ....</P>
			<P>»так, в воскресенье:<BR>
				- вывод имен каналов соотв. цветами<BR>
				- модифицирован алгоритм вывода (чтобы "наложение" было возможно при любом 
				цвете фона - в прежнем варианте "проходило" только дл€ черного)<BR>
				- при изменении цветов диалог посылает главному окну WM_DIZ_MAPCHANGED - 
				немедленна€ смена цветов во всех дочерних окнах</P>
			<P>----------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050801 пн</STRONG></P>
			<P>1120-1356<BR>
				ѕродолжил борьбу с цветами... ¬роде бы така€ ернунда - а столько маеты: и 
				сообщение грозит многое порушить, и в осцилле с цветами совсем не то, и 
				отрисовка тоже непон€тна€... ¬роде бы чего-то добилс€ (рисует, не вылетает) - 
				так и оставлю...</P>
			<P>1400<BR>
				<STRONG><FONT color="#000099">ѕосле п€тничных изменений (вновь разрешенна€ активаци€) - 
						снова проблемы с перемигиванием :((((</FONT></STRONG></P>
			<P>1441<BR>
				¬роде бы очередна€ победа над взаимной активацией....</P>
			<P>1533<BR>
				»справлена ошибка: не писал стартовое врем€ при не-плюс-формате</P>
			<P>---------------------------- 1546 - чекин, займусь конфигами 
				---------------------------------</P>
			<P>1910<BR>
				ѕростейший менеджмент конфигов - второй чекин.</P>
			<P>------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050802</STRONG></P>
			<P>ѕроведен первый полномасштабный тестовый эксперимент: с 32 электродами, 
				реальными стимулами и метками. ƒве серии - перва€ с Sennheiser HD265, втора€ - 
				с Etymotic ER-2.
				<BR>
				¬ принципе все нормально, за исключением каких-то проблем с тачпруфами: при 
				сохранении смещени€ вместо сигнала начинает идти шум....</P>
			<P>¬озникшие "по ходу" замечани€:<BR>
				<FONT color="#cc0066"><STRONG><FONT color="#000099">- включение бипол€ров (чекбоксом) в 
							диалоге не вызвает сообщени€ WM_DIZ_MAPCHANGED</FONT>
						<BR>
						<FONT color="#000099">- похоже, что дл€ бипол€ров нужен отдельный масштаб 
							(окулограмма может сильно перекрывать ЁЁ√)<BR>
						</FONT><FONT color="#000099">- после каких-то процедур пропадает заполнение списка 
							доп. пол€ми при вводе<BR>
						</FONT><FONT color="#000099">- в создаваемой матлаб-строке нужно обеспечить 
							предварительное резервирование массива<BR>
						</FONT>-<FONT color="#000099"> StartDate и StartTime в инфо-панели<BR>
						</FONT><FONT color="#99ff33">- возможно, там же предусмотреть cellstring(TWORD) - 
							дл€ облегчени€ дальнейшего поиска меток<BR>
						</FONT><FONT color="#000099">- при создании нового файла не мен€ютс€ имена уже 
							существующих дочерних окон<BR>
						</FONT></STRONG></FONT>
			</P>
			<P>2033<BR>
				«амена имени существующих окон при создании файла</P>
			<P>2038<BR>
				ѕосылка WM_DIZ_MAPCHANGED почему-то была просто закомментирована
			</P>
			<P>2048<BR>
				ѕредвыделение пам€ти в матлабоскаой строке CommanString</P>
			<P>2113<BR>
				StartDate и StartTime в инфо-панели<BR>
				ƒва оставшихс€ замечани€ - на завтра....</P>
			<P>---------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050804 чт<BR>
				</STRONG>—реда - похороны ‘атюхина, на которые мы не попали (опоздали на 
				автобус). ѕопали только на поминки. —егодн€ - освобождал ѕерфильевский 
				компьютер, разбиралс€ с Ўестопаловой с переводом данных в EEGLAB и вел с ней 
				прочие разговоры. “ак что что-то околорабочее - только после восьми...</P>
			<P>2020<BR>
				Ћиквидировано дублирование колонок списка при повторном открытии файла.</P>
			<P>2051<BR>
				ќкружил запись и чтение файла крит. секци€ми - от неполадок со списком не 
				помогает :((((</P>
			<P>2116<BR>
				¬се дело в том, что, пока в списке нажата мышина€ клавиша, добавление в него не 
				проходит... » как этого избежать - непон€тно :(((</P>
			<P>2138<BR>
				Ќет, € не понимаю, как можно этого избежать: как только клавиша в списке 
				нажимаетс€, запощенные сообщени€ перестают доходить до MainFrame&nbsp; - и 
				просто куда-то деваютс€ :((((</P>
			<P>---------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050805 пт</STRONG></P>
			<P>1320<BR>
				¬се утро расследовал попведение списка - даже думал, что придетс€ плюнуть.... 
				Ќо вроде бы победил:<BR>
				// ћне пришлось завести свой класс списка, так как обычный майкрософтовский // 
				контрол при нажатии на мышиную кнопку (как левую, так и правую) входил в 
				модальный цикл // глотающий все сообщени€ - вплоть до отпускани€ кнопки. 
				ƒобавленна€ ф-и€ PreTranslateMessage // собственно делает только одно - 
				помещает сразу же за сообщением о нажатии кнопки сообщение о ее // подн€тии. 
				¬роде бы это помогает....
			</P>
			<P>1420<BR>
				ѕрописаны незавимые масштабы дл€ бипол€ров. ¬сего за час!!! ‘антастика... 
				ќсталось их сохран€ть....</P>
			<P>1426<BR>
				јга - и сохранение бипол€ров тоже работает...
			</P>
			<P>1441<BR>
				ѕишу в аннотации установленные и сн€тые биты. Ќужно их проэкспортировать в 
				матлаб.</P>
			<P>1451<BR>
				ƒефолтова€ длина&nbsp;записи 1000 мс</P>
			<P>1513<BR>
				Ёкспорт побитовых данных тоже проходит (TSET и TCLR)</P>
			<P>2130<BR>
				Ќаписал очередной документ, подправил about-box.</P>
			<P>======================================================================================</P>
			<P><STRONG>050812 -</STRONG>
				<BR>
				проведены тесты на правильность децимации. ѕохоже, что промахиваюсь на точку 
				при непрерывной записи</P>
			<P><STRONG><EM><U>050815-050917<BR>
							отпуск на ќстрове</U></EM></STRONG></P>
			<P>======================================================================================</P>
			<P><STRONG>050920 вт</STRONG></P>
			<P>ѕервое знакомство с HTMLhelp и его присобачиванием к программе</P>
			<P>---------------------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>050921 ср</STRONG></P>
			<P>ѕродолжаю возитьс€ с присобачиванием хелпа. ѕостигаю, какие там нужны сообщени€ 
				- и какие флаги в проперти-шитах и страницах.</P>
			<P>„тобы не лезло лишнего, во врем€ работы с установками хелп из основного окна 
				вызыватьс€ не должен!!! ќтслеживаю по запрещению основгого окна (установки-то 
				немодальны).</P>
			<P>ѕопутно вы€снилось, что при закрытии окна установок кнопкой SC_CLOSE € не 
				разрешал главное окно программы.</P>
			<P>======================================================================================</P>
			<P><STRONG>051031</STRONG></P>
			<P>¬веден глобальный флаг TRIAL, цель - производство "пробной" версии с 
				ограничением на число вводимых каналов (16 пинов и 8 тачпруфов)</P>
			<P>======================================================================================</P>
			<P><STRONG>051115 вт</STRONG></P>
			<P>ћассированные изменени€, св€занные с совместимостью с Mk2-системой (увеличенное 
				количество каналов etc). ѕопутно пришлось пересмотреть и поведение в режиме 0 
				(€ его практически запрещал - а это, тем не менее, практически рабочий режим). 
				ѕрограмма выложена на diz-vara.narod.ru</P>
			<P>=========================================================================================</P>
			<P><STRONG>051128 пн</STRONG></P>
			<P>ѕри открытии файла параметры триггера (его длина в отсчетах) брались из канала 
				номер 1, а не из текущенго, что привело к неправильному рисованию тригканала в 
				ситуации с децимацией аналогвых и не-децимацией триггерного.</P>
			<P>ќстаетс€ вопрос с перекосом первой точки реализации - вроде бы наблюдаетс€ лишь 
				при децимации.</P>
			<P>===========================================================================================</P>
			<P><STRONG>051206 вт</STRONG></P>
			<P>- исправлена ситуаци€ с запоминанием кодов экспериментаторов (использовалось не 
				то число - m_nInvNum вместо m_nResNum)</P>
			<P>18:58<BR>
				ѕопытки найти "смешение каналов" (перва€ точка - из предыдущего канала). 
				ѕолучаетс€, что € не рано начинаю (беру пред. канал). я поздно кончаю - и 
				именно в случае с недецимацией тригканала.<BR>
				&nbsp; —итуаци€ следующа€. я провер€ю - по окончании канального (и вложенного в 
				него децимационного) цикла только счетчик тригканала. ≈сли оного, скажем, в 4 
				раза больше - то может возникнуть ситуаци€, когда тригканал еще не дописалс€ 
				(осталось, скажем, 2 или 3 точки) - а данные-то уже все!!! —оответственно, при 
				следующем заходе € попытаюсь записать данные... Ќо вот с какой стати они 
				попадут именно туда, куда надо???????<BR>
				я не рано начинаю - € поздно кончаю...<BR>
				‘лаг начала анализируетс€ ¬Ќ”“–» деццикла - то есть действительно есть 
				возможность... Ќо возможность чего????
				<BR>
				ƒа: получаетс€, что € начну с точки, соотв. началу деццикла - и тогда попытаюсь 
				записать на точку больше (в данных). Ќу а чего € хочу??? „то Ќј —јћќћ ƒ≈Ћ≈ 
				нужно делать в такой ситуации???<BR>
				“ем более, что ситуаций может быть две:
				<BR>
				- окончание одиночной реализации - кончить и все тут<BR>
				- продолжающа€с€ запись - € должен переключитьс€ на след. буфер...</P>
			<P>ERGO<BR>
				ѕровер€ть € должен внутри деццикла!!! Ќќ???? ѕровер€ть € при том должен “ќЋ№ ќ 
				тригканал!!! ≈сли же € буду провер€ть любой канал - то могу получить ситуацию с 
				парой недостающих точек на тригканале с заполненными данными. ¬озможны ли 
				подводные камни в случае с проверкой только тригканала???&nbsp; ¬озможные 
				ситуации:
				<BR>
				- € начинаю с тригканала. ѕерва€ точка ввелась. ¬тора€ хочет ппереключени€ 
				буфера. ѕравильно ли это??? ƒј! ѕо всему получаетс€, что это правильно - так 
				как данные при этом уже заполнены.<BR>
				- € начинаю с тригканала. ¬велись ¬—≈ децточки (скажем, четыре при соотв. 
				коэффициенте). » тут наступил конец буфера. я переключусь. Ќќ!!!!!!!!!!!!!!!!! 
				ƒанные € при этом тоже переключу на новый буфер - а на самом деле делать этого 
				не нужно....</P>
			<P>Ќо така€ ситуаци€ возникает только если провер€ть на границу буфера ѕќ—Ћ≈ 
				положени€ очередной точки ююю ј если до???? “огда € буду провер€ть... ј что € 
				буду провер€ть...
			</P>
			<P>=====================================================================================</P>
			<P><STRONG>051207 ср</STRONG></P>
			<P>ѕопробовал перенести ф-ию переключени€ на новый буфер вовнутрь - но прокололс€ 
				(там - слишком много зав€зок). ѕеренес ее наружу, но вперед - все те же самые 
				проблемы....</P>
			<P>21:32 ЌјЎ≈Ћ!!!!<BR>
				я после анализа пыталс€ писать ¬ ЋёЅќћ случае - то есть и тогда, когда буфер 
				закончилс€, и больше писать не нужно.... —ейчас скидываю флаг m_bWriting - но 
				нужно еще посмотреть, как было раньше....</P>
			<P>========================================================================================</P>
			<P><STRONG>051212 пн</STRONG></P>
			<P>ѕо итогам очередного (п€тничного) эксперимента исправлено следующее:</P>
			<P><BR>
				<STRONG><FONT color="#000099">- непогашение тултипов в диалогах - просто пр€чу 
						тултиповые окна (CStatMap::OnMouseMove)<BR>
						- при любом открытом дочернем окне не по€вл€лись тултипы в основном тулбаре - 
						из-за перехвата ф-ией CDlgView::PreTranslateMessage() сообщени€ WM_TIMER - 
						исправлено фильтрацией сообщений по хэндлу окна (если не свое - то не обращаем 
						внимани€)<BR>
						- путаница с контролами в SnapDlg - исправлено наполовину вручную (приводила к 
						перемещению надписи Scroll и не-перемещению единиц измерени€ бипол€ров)<BR>
						- ¬ меню введено File-&gt;Close</FONT></STRONG></P>
			<P><STRONG><FONT color="#000099">ќсталось - отключение скринсейвера<BR>
						19:13 - отключение сделано, с доп. флагом. –аботает или нет - не провер€л. 
						¬ыпущен релиз alpha0.06</FONT></STRONG></P>
			<P>==============================================================================//</P>
			<P><STRONG>051216 пт</STRONG></P>
			<P>1150 - кнопка As Previous в CHeaderDlg - приводит диалог в состо€ние "как 
				предыдущий".</P>
			<P>1217 - добавлен комбобокс с кодами стимулов.</P>
			<P>=========================================================================<BR>
				=========================================================================<BR>
				=========================================================================</P>
			<P><STRONG><EM><U><FONT style="BACKGROUND-COLOR: #ff0066">2006</FONT></U></EM></STRONG></P>
			<P>=========================================================================</P>
			<P><STRONG>060123 пн</STRONG></P>
			<P>ѕо результатам п€тничного эксперимента отмечены следующие баги:<BR>
				<STRONG><FONT color="#cc0066">- вылетаю при смене конфигураций<BR>
						- отлов лишних меток (??? непон€тно - дело это в воспринимающей или же 
						стимулирующей программе???)<BR>
					</FONT><FONT color="#000099">- по€вление первой же перекрывающейс€ реализации 
						приводит к неправильному вводу всех дальнейших реализаций<BR>
					</FONT><FONT color="#000099">- в листе не отображаютс€ смещени€ электродов!!!</FONT></STRONG></P>
			<P>1513<BR>
				CListPanel::m_Map - при вводе нового файла перерисовываетс€ также, как и в 
				хардовой панели.</P>
			<P>1710<BR>
				Ћокализовано: проблема присутствует в версии от 051207, но ее еще нет в версии 
				от 051229</P>
			<P>--------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>060125 ср</STRONG></P>
			<P>”вы, но ни в понедельник вечером, ни во вторник не то чтобы поразмышл€ть - 
				просто подумать над проблемой не пришлось: нас ждала ограбленна€ квартира 
				(пострадала, собственно, одна ћарина) - и св€занные с этим хлопоты (мен€л 
				замок)</P>
			<P>—егодн€, к шести часам вечера, вроде бы пон€л, что проблема заключаетс€ во флаге <STRONG>
					m_bWriting</STRONG>. “ак получаетс€, что € его снимаю при окончании первого 
				же из перекрывающихс€ буферов - а вновь он ставитс€ лишь когда приходит новый 
				триггер. Ќужно мен€ь логику. ѕосмотрим, как он использовалс€ в старой (рабочей) 
				версии:</P>
			<P>//// внутри цикла по каналам-повторам<BR>
				- <EM>провер€лс€ </EM>при приходе мануального старта (если стоит, новый пуск не 
				происходит)<BR>
				- <EM>устанавливалс€</EM> после вызова WritePre (triggered)<BR>
				- <EM>провер€лс€</EM> после провеки флагов if (bNeedNew &amp;&amp; !m_bWriting) 
				//пришел свежий гейт - а запись не ведетс€<BR>
				&nbsp;&nbsp; дл€ преотвращени€ начала новой гейт-записи при наличии текущей<BR>
				- <EM>устанавливалс€</EM> при начале новой гейт-записи<BR>
				- <EM>провер€лс€</EM> перед собственно занесением данных в буфер</P>
			<P>///// после цикла по каналам-повторам - но в цикле по точкам<BR>
				- <EM>обнул€лс€</EM> перед проверкой всех буферов<BR>
				- <EM>выставл€лс€</EM>, если велась запись хот€ бы в один из буферов</P>
			<P>/// после цикла по отсчетам - провер€лс€ перед записью на диск</P>
			<P>&nbsp;</P>
			<P>1922<BR>
				<STRONG><FONT color="#000099">ѕоборол</FONT></STRONG>!!! Ќужно было:<BR>
				- не провер€ть флаг перед проверкой буферов (она должна вестись лишь по 
				буферным флагам)<BR>
				- если буфер недописан, поднимать флаг!</P>
			<P>-----------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>060130 пн</STRONG></P>
			<P>ѕо результатам п€тничного эксперимента: ошибка в определении частоты прочитанной 
				из файла. ¬озникала в случае некруглой длительности из-за того, что в файле 
				собственно частота не кодировалась - только длительность записи и кол-во 
				отсчетов на канал, в итоге частота получалась делением, и могла быть не 
				круглой; после отбрасывани€ дробной части € получал 511 √ц (а мог бы и 513) - 
				из-за чего не срабатыали все фильтры. »справлено заменой целочисленных расчетов 
				на плавающие с правильным округлением.</P>
			<P>----------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>060202 чт</STRONG></P>
			<P>1710<BR>
				»нициализаци€ каталогов коффайлов из существующего имени.</P>
			<P>1738<BR>
				Ѕаг с подкрашиванием индикаторов в CHardDlg после смены конфигурации:<BR>
				ѕричина - повторный принудительный вызов инициализации диалога, а уже там:<BR>
				- заново создавал кисти (что могло быть нехорошо)<BR>
				- инициализировал обе кисти красным</P>
			<P>»справлено правильной инициализацией всех переменных (и недопущением повторной 
				инициализации)</P>
			<P>1800<BR>
				«апоминание не только полного пути к файлу конфигурации, но и его имени. 
				ќтображение конфигурации в тайтлбаре главного окна (при отсутствии открытых 
				файлов).</P>
			<P>1805<BR>
				“от же тайтл будет отзваниватьс€ и в заголовках диалогов чтени€ и сохранени€ 
				кофигураций.</P>
			<P><BR>
				-------------------------------------------------------------------------------------------------------------------------------------</P>
			<P><STRONG>060210 пт</STRONG></P>
			<P>ѕродолжаю борьбу с вылетами при смене конфигураций:<BR>
				- заключил чтение конфигурации в крит. секцию таймера (чтобы не было набегов)<BR>
				-&nbsp;делаю m_nActChans = -1; -&nbsp;дл€&nbsp;гарантированной повторной 
				инициализации</P>
			<P>1257 -&nbsp;не помогает. ѕосле какого-то кол-ва триггерных (,???) записей при 
				переключении все равно вылетаем - причем можем и сразу....</P>
			<P>ƒобавил закрытие драйвера&nbsp;и устанвку m_dwMode в нецензурное состо€ние.<BR>
				¬роде бы помогает - хот€ не уверен :((((</P>
			<P><STRONG><FONT color="#cc0066">” мен€ проблемы с отображением коротких тригсигналов при 
						большой длительности развертки!!!</FONT></STRONG></P>
			<P>.</P>
			<P>&nbsp;</P>
	</BODY>
</HTML>
